<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”§ ë¡œê·¸ì•„ì›ƒ ë¬¸ì œ ì™„ì „ í•´ê²°</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .header p {
            color: #7f8c8d;
            font-size: 1.1rem;
        }
        .section {
            margin-bottom: 25px;
            padding: 20px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            background: #f8f9fa;
        }
        .section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }
        .danger {
            background: linear-gradient(135deg, #dc3545 0%, #e74c3c 100%);
        }
        .warning {
            background: linear-gradient(135deg, #ffc107 0%, #f39c12 100%);
            color: #2c3e50;
        }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: 500;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }
        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 2px solid #ffeaa7;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 2px solid #bee5eb;
        }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            border: 1px solid #e9ecef;
            font-size: 0.9rem;
        }
        .test-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #dee2e6;
            margin: 15px 0;
        }
        .function-test {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”§ ë¡œê·¸ì•„ì›ƒ ë¬¸ì œ ì™„ì „ í•´ê²°</h1>
            <p>ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥ì„ í™•ì‹¤íˆ ì‘ë™í•˜ë„ë¡ ìˆ˜ì •í•©ë‹ˆë‹¤</p>
        </div>

        <div class="section">
            <h3>ğŸš¨ í˜„ì¬ ë¬¸ì œ ì§„ë‹¨</h3>
            <button onclick="diagnoseLogoutIssue()">ë¡œê·¸ì•„ì›ƒ ë¬¸ì œ ì§„ë‹¨</button>
            <div id="diagnosisResults"></div>
        </div>

        <div class="section">
            <h3>ğŸ› ï¸ ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜ ìˆ˜ì •</h3>
            <button onclick="fixLogoutFunction()" class="success">ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜ ìˆ˜ì •</button>
            <button onclick="forceLogout()" class="danger">ê°•ì œ ë¡œê·¸ì•„ì›ƒ ì‹¤í–‰</button>
            <div id="fixResults"></div>
        </div>

        <div class="section">
            <h3>ğŸ§ª ë¡œê·¸ì•„ì›ƒ í…ŒìŠ¤íŠ¸</h3>
            <div class="test-section">
                <h4>í˜„ì¬ ìƒíƒœ:</h4>
                <div id="currentStatus"></div>
                
                <h4>í•¨ìˆ˜ í…ŒìŠ¤íŠ¸:</h4>
                <div class="function-test">
                    <button onclick="testLogoutFunction()" class="warning">ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜ í…ŒìŠ¤íŠ¸</button>
                    <button onclick="testUserManager()" class="warning">UserManager í…ŒìŠ¤íŠ¸</button>
                    <button onclick="testGlobalFunctions()" class="warning">ì „ì—­ í•¨ìˆ˜ í…ŒìŠ¤íŠ¸</button>
                </div>
                
                <div id="testResults"></div>
            </div>
        </div>

        <div class="section">
            <h3>ğŸ”§ ìŠ¤í¬ë¦½íŠ¸ ì§ì ‘ ìˆ˜ì •</h3>
            <button onclick="injectLogoutFix()" class="success">ë¡œê·¸ì•„ì›ƒ ìˆ˜ì • ì½”ë“œ ì£¼ì…</button>
            <button onclick="clearAllData()" class="danger">ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™”</button>
            <div id="injectionResults"></div>
        </div>

        <div class="section">
            <h3>ğŸ  ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™</h3>
            <button onclick="goToMain()">ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™</button>
        </div>
    </div>

    <script>
        // UserManager í´ë˜ìŠ¤ ì •ì˜
        class UserManager {
            constructor() {
                this.currentUser = null;
                this.loadCurrentUser();
            }

            loadUsers() {
                const users = localStorage.getItem('users');
                return users ? JSON.parse(users) : {
                    'admin@crestedgecko.com': {
                        email: 'admin@crestedgecko.com',
                        password: 'Admin2024!',
                        name: 'ì‹œìŠ¤í…œ ê´€ë¦¬ì',
                        plan: 'admin',
                        role: 'admin',
                        createdAt: new Date().toISOString()
                    }
                };
            }

            saveUsers(users) {
                localStorage.setItem('users', JSON.stringify(users));
            }

            getCurrentUser() {
                if (!this.currentUser) {
                    const savedUser = localStorage.getItem('currentUser');
                    if (savedUser) {
                        this.currentUser = JSON.parse(savedUser);
                    }
                }
                return this.currentUser;
            }

            loadCurrentUser() {
                const savedUser = localStorage.getItem('currentUser');
                if (savedUser) {
                    this.currentUser = JSON.parse(savedUser);
                }
            }

            logout() {
                console.log('UserManager.logout() í˜¸ì¶œë¨');
                this.currentUser = null;
                localStorage.removeItem('currentUser');
                console.log('ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ, ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™');
                window.location.href = 'login.html';
            }
        }

        // ì „ì—­ í•¨ìˆ˜ë“¤ ì •ì˜
        function logout() {
            console.log('ì „ì—­ logout() í•¨ìˆ˜ í˜¸ì¶œë¨');
            if (window.userManager) {
                window.userManager.logout();
            } else {
                // UserManagerê°€ ì—†ìœ¼ë©´ ì§ì ‘ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
                localStorage.removeItem('currentUser');
                console.log('ì§ì ‘ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ ì™„ë£Œ');
                window.location.href = 'login.html';
            }
        }

        function displayUserInfo() {
            console.log('displayUserInfo() í•¨ìˆ˜ í˜¸ì¶œë¨');
            const currentUser = window.userManager ? window.userManager.getCurrentUser() : null;
            if (currentUser) {
                console.log('ì‚¬ìš©ì ì •ë³´ í‘œì‹œ:', currentUser.name);
            } else {
                console.log('ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ì—†ìŒ');
            }
        }

        // ì „ì—­ ê°ì²´ì— ë“±ë¡
        window.userManager = new UserManager();
        window.logout = logout;
        window.displayUserInfo = displayUserInfo;

        function diagnoseLogoutIssue() {
            const results = document.getElementById('diagnosisResults');
            let html = '<h4>ğŸ” ë¡œê·¸ì•„ì›ƒ ë¬¸ì œ ì§„ë‹¨:</h4>';
            
            try {
                // 1. UserManager í™•ì¸
                if (window.userManager) {
                    html += '<div class="status success">âœ… UserManager ê°ì²´ ì¡´ì¬</div>';
                } else {
                    html += '<div class="status error">âŒ UserManager ê°ì²´ ì—†ìŒ</div>';
                }

                // 2. logout í•¨ìˆ˜ í™•ì¸
                if (typeof window.logout === 'function') {
                    html += '<div class="status success">âœ… logout í•¨ìˆ˜ ì¡´ì¬</div>';
                } else {
                    html += '<div class="status error">âŒ logout í•¨ìˆ˜ ì—†ìŒ</div>';
                }

                // 3. displayUserInfo í•¨ìˆ˜ í™•ì¸
                if (typeof window.displayUserInfo === 'function') {
                    html += '<div class="status success">âœ… displayUserInfo í•¨ìˆ˜ ì¡´ì¬</div>';
                } else {
                    html += '<div class="status error">âŒ displayUserInfo í•¨ìˆ˜ ì—†ìŒ</div>';
                }

                // 4. í˜„ì¬ ì‚¬ìš©ì ìƒíƒœ í™•ì¸
                const currentUser = localStorage.getItem('currentUser');
                if (currentUser) {
                    html += '<div class="status info">âœ… ë¡œê·¸ì¸ ì„¸ì…˜ ì¡´ì¬</div>';
                } else {
                    html += '<div class="status warning">âš ï¸ ë¡œê·¸ì¸ ì„¸ì…˜ ì—†ìŒ</div>';
                }

                // 5. ì½˜ì†” ì˜¤ë¥˜ í™•ì¸
                html += '<div class="status info">ğŸ“‹ ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ ì˜¤ë¥˜ ë©”ì‹œì§€ í™•ì¸ ì¤‘...</div>';

            } catch (error) {
                html += `<div class="status error">âŒ ì§„ë‹¨ ì¤‘ ì˜¤ë¥˜: ${error.message}</div>`;
            }
            
            results.innerHTML = html;
        }

        function fixLogoutFunction() {
            const results = document.getElementById('fixResults');
            let html = '<h4>ğŸ› ï¸ ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜ ìˆ˜ì •:</h4>';
            
            try {
                // 1. UserManager ì¬ì •ì˜
                window.userManager = new UserManager();
                html += '<div class="status success">âœ… UserManager ì¬ì •ì˜ ì™„ë£Œ</div>';

                // 2. logout í•¨ìˆ˜ ì¬ì •ì˜
                window.logout = function() {
                    console.log('ìˆ˜ì •ëœ logout() í•¨ìˆ˜ í˜¸ì¶œë¨');
                    if (window.userManager) {
                        window.userManager.logout();
                    } else {
                        localStorage.removeItem('currentUser');
                        window.location.href = 'login.html';
                    }
                };
                html += '<div class="status success">âœ… logout í•¨ìˆ˜ ì¬ì •ì˜ ì™„ë£Œ</div>';

                // 3. displayUserInfo í•¨ìˆ˜ ì¬ì •ì˜
                window.displayUserInfo = function() {
                    console.log('ìˆ˜ì •ëœ displayUserInfo() í•¨ìˆ˜ í˜¸ì¶œë¨');
                    const currentUser = window.userManager ? window.userManager.getCurrentUser() : null;
                    if (currentUser) {
                        console.log('ì‚¬ìš©ì ì •ë³´:', currentUser.name);
                    }
                };
                html += '<div class="status success">âœ… displayUserInfo í•¨ìˆ˜ ì¬ì •ì˜ ì™„ë£Œ</div>';

                // 4. ì „ì—­ í•¨ìˆ˜ ë“±ë¡ í™•ì¸
                html += '<div class="status success">âœ… ëª¨ë“  ì „ì—­ í•¨ìˆ˜ ë“±ë¡ ì™„ë£Œ</div>';
                
                html += '<div class="status success"><strong>ğŸ‰ ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜ ìˆ˜ì • ì™„ë£Œ!</strong></div>';

            } catch (error) {
                html += `<div class="status error">âŒ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜: ${error.message}</div>`;
            }
            
            results.innerHTML = html;
        }

        function forceLogout() {
            if (confirm('ì •ë§ë¡œ ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                console.log('ê°•ì œ ë¡œê·¸ì•„ì›ƒ ì‹¤í–‰');
                localStorage.removeItem('currentUser');
                sessionStorage.clear();
                alert('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
                window.location.href = 'login.html';
            }
        }

        function testLogoutFunction() {
            const results = document.getElementById('testResults');
            let html = '<h4>ğŸ§ª ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜ í…ŒìŠ¤íŠ¸:</h4>';
            
            try {
                // logout í•¨ìˆ˜ ì¡´ì¬ í™•ì¸
                if (typeof window.logout === 'function') {
                    html += '<div class="status success">âœ… logout í•¨ìˆ˜ ì¡´ì¬</div>';
                    
                    // í•¨ìˆ˜ ì‹¤í–‰ í…ŒìŠ¤íŠ¸ (ì‹¤ì œ ë¡œê·¸ì•„ì›ƒì€ í•˜ì§€ ì•ŠìŒ)
                    console.log('logout í•¨ìˆ˜ í…ŒìŠ¤íŠ¸ ì‹¤í–‰');
                    html += '<div class="status info">ğŸ“‹ ì½˜ì†”ì—ì„œ í•¨ìˆ˜ ì‹¤í–‰ ë¡œê·¸ í™•ì¸</div>';
                } else {
                    html += '<div class="status error">âŒ logout í•¨ìˆ˜ ì—†ìŒ</div>';
                }

                // UserManager í…ŒìŠ¤íŠ¸
                if (window.userManager && typeof window.userManager.logout === 'function') {
                    html += '<div class="status success">âœ… UserManager.logout() í•¨ìˆ˜ ì¡´ì¬</div>';
                } else {
                    html += '<div class="status error">âŒ UserManager.logout() í•¨ìˆ˜ ì—†ìŒ</div>';
                }

            } catch (error) {
                html += `<div class="status error">âŒ í…ŒìŠ¤íŠ¸ ì¤‘ ì˜¤ë¥˜: ${error.message}</div>`;
            }
            
            results.innerHTML = html;
        }

        function testUserManager() {
            const results = document.getElementById('testResults');
            let html = '<h4>ğŸ§ª UserManager í…ŒìŠ¤íŠ¸:</h4>';
            
            try {
                if (window.userManager) {
                    html += '<div class="status success">âœ… UserManager ê°ì²´ ì¡´ì¬</div>';
                    
                    const currentUser = window.userManager.getCurrentUser();
                    if (currentUser) {
                        html += `<div class="status info">ğŸ“‹ í˜„ì¬ ì‚¬ìš©ì: ${currentUser.name}</div>`;
                    } else {
                        html += '<div class="status warning">âš ï¸ ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ì—†ìŒ</div>';
                    }
                } else {
                    html += '<div class="status error">âŒ UserManager ê°ì²´ ì—†ìŒ</div>';
                }

            } catch (error) {
                html += `<div class="status error">âŒ í…ŒìŠ¤íŠ¸ ì¤‘ ì˜¤ë¥˜: ${error.message}</div>`;
            }
            
            results.innerHTML = html;
        }

        function testGlobalFunctions() {
            const results = document.getElementById('testResults');
            let html = '<h4>ğŸ§ª ì „ì—­ í•¨ìˆ˜ í…ŒìŠ¤íŠ¸:</h4>';
            
            const functions = ['logout', 'displayUserInfo', 'userManager'];
            functions.forEach(funcName => {
                if (window[funcName]) {
                    html += `<div class="status success">âœ… ${funcName} ì¡´ì¬</div>`;
                } else {
                    html += `<div class="status error">âŒ ${funcName} ì—†ìŒ</div>`;
                }
            });
            
            results.innerHTML = html;
        }

        function injectLogoutFix() {
            const results = document.getElementById('injectionResults');
            let html = '<h4>ğŸ”§ ìŠ¤í¬ë¦½íŠ¸ ìˆ˜ì • ì£¼ì…:</h4>';
            
            try {
                // ìŠ¤í¬ë¦½íŠ¸ íƒœê·¸ ìƒì„±í•˜ì—¬ ìˆ˜ì • ì½”ë“œ ì£¼ì…
                const script = document.createElement('script');
                script.textContent = `
                    // ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜ ê°•ì œ ì¬ì •ì˜
                    window.logout = function() {
                        console.log('ì£¼ì…ëœ logout() í•¨ìˆ˜ í˜¸ì¶œë¨');
                        localStorage.removeItem('currentUser');
                        sessionStorage.clear();
                        alert('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.');
                        window.location.href = 'login.html';
                    };
                    
                    // UserManager ê°•ì œ ì¬ì •ì˜
                    window.userManager = {
                        logout: function() {
                            console.log('ì£¼ì…ëœ UserManager.logout() í˜¸ì¶œë¨');
                            localStorage.removeItem('currentUser');
                            sessionStorage.clear();
                            window.location.href = 'login.html';
                        },
                        getCurrentUser: function() {
                            const savedUser = localStorage.getItem('currentUser');
                            return savedUser ? JSON.parse(savedUser) : null;
                        }
                    };
                    
                    // displayUserInfo í•¨ìˆ˜ ì¬ì •ì˜
                    window.displayUserInfo = function() {
                        console.log('ì£¼ì…ëœ displayUserInfo() í•¨ìˆ˜ í˜¸ì¶œë¨');
                        const currentUser = window.userManager.getCurrentUser();
                        if (currentUser) {
                            console.log('ì‚¬ìš©ì ì •ë³´:', currentUser.name);
                        }
                    };
                    
                    console.log('ë¡œê·¸ì•„ì›ƒ ìˆ˜ì • ì½”ë“œ ì£¼ì… ì™„ë£Œ');
                `;
                
                document.head.appendChild(script);
                html += '<div class="status success">âœ… ìˆ˜ì • ì½”ë“œ ì£¼ì… ì™„ë£Œ</div>';
                html += '<div class="status info">ğŸ“‹ ì½˜ì†”ì—ì„œ ì£¼ì… ì™„ë£Œ ë©”ì‹œì§€ í™•ì¸</div>';

            } catch (error) {
                html += `<div class="status error">âŒ ì£¼ì… ì¤‘ ì˜¤ë¥˜: ${error.message}</div>`;
            }
            
            results.innerHTML = html;
        }

        function clearAllData() {
            if (confirm('ì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                localStorage.clear();
                sessionStorage.clear();
                alert('ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.');
                location.reload();
            }
        }

        function goToMain() {
            window.location.href = 'index.html';
        }

        // í˜„ì¬ ìƒíƒœ í‘œì‹œ
        function updateCurrentStatus() {
            const status = document.getElementById('currentStatus');
            let html = '';
            
            const currentUser = localStorage.getItem('currentUser');
            if (currentUser) {
                try {
                    const user = JSON.parse(currentUser);
                    html += `<div class="status success">âœ… ë¡œê·¸ì¸ë¨: ${user.name} (${user.plan})</div>`;
                } catch (e) {
                    html += '<div class="status warning">âš ï¸ ì‚¬ìš©ì ë°ì´í„° ì˜¤ë¥˜</div>';
                }
            } else {
                html += '<div class="status warning">âš ï¸ ë¡œê·¸ì¸ë˜ì§€ ì•ŠìŒ</div>';
            }
            
            if (typeof window.logout === 'function') {
                html += '<div class="status success">âœ… logout í•¨ìˆ˜ ì¡´ì¬</div>';
            } else {
                html += '<div class="status error">âŒ logout í•¨ìˆ˜ ì—†ìŒ</div>';
            }
            
            if (window.userManager) {
                html += '<div class="status success">âœ… UserManager ì¡´ì¬</div>';
            } else {
                html += '<div class="status error">âŒ UserManager ì—†ìŒ</div>';
            }
            
            status.innerHTML = html;
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.onload = function() {
            updateCurrentStatus();
            diagnoseLogoutIssue();
        };
    </script>
</body>
</html> 