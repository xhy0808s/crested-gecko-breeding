<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¦ í¬ë ˆìŠ¤í‹°ë“œ ê²Œì½” ë¸Œë¦¬ë”© ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-4px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
  </style>
</head>
<body class="bg-gradient-to-br from-green-50 to-blue-50 min-h-screen">
    <!-- í—¤ë” -->
    <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-dragon text-2xl text-green-600"></i>
                    <h1 class="text-xl font-bold text-gray-900">í¬ë ˆìŠ¤í‹°ë“œ ê²Œì½” ë¸Œë¦¬ë”© ì‹œìŠ¤í…œ</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <div id="userInfo">
                        <!-- ì‚¬ìš©ì ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                    <div id="syncStatus" class="text-sm">
                        <span class="text-gray-600">
                            â³ ë™ê¸°í™” ì¤€ë¹„ì¤‘
                        </span>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="manualSync()" class="px-3 py-1 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700">
                            <i class="fas fa-sync mr-1"></i>ë™ê¸°í™”
                        </button>
                        <div class="relative">
                            <button onclick="toggleUserMenu()" class="px-3 py-1 bg-gray-600 text-white text-sm rounded-lg hover:bg-gray-700">
                                <i class="fas fa-user mr-1"></i>ì„¤ì •
                            </button>
                            <div id="userMenu" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-50">
                                <button onclick="window.userAuth.changeUser()" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                    <i class="fas fa-user-switch mr-2"></i>ì‚¬ìš©ì ë³€ê²½
                                </button>
                                <button onclick="window.userAuth.logout()" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                    <i class="fas fa-sign-out-alt mr-2"></i>ë¡œê·¸ì•„ì›ƒ
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- í†µê³„ ì¹´ë“œ -->
        <div class="grid grid-cols-2 md:grid-cols-7 gap-4 mb-8">
            <div class="bg-white rounded-lg shadow-md p-4 text-center">
                <i class="fas fa-dragon text-2xl text-green-600 mb-2"></i>
                <h3 class="text-lg font-semibold text-gray-900">ì´ ê°œì²´</h3>
                <p class="text-2xl font-bold text-green-600" id="totalAnimals">0</p>
            </div>
            <div class="bg-white rounded-lg shadow-md p-4 text-center">
                <i class="fas fa-seedling text-2xl text-blue-600 mb-2"></i>
                <h3 class="text-lg font-semibold text-gray-900">F1 ì„¸ëŒ€</h3>
                <p class="text-2xl font-bold text-blue-600" id="f1Count">0</p>
            </div>
            <div class="bg-white rounded-lg shadow-md p-4 text-center">
                <i class="fas fa-leaf text-2xl text-yellow-600 mb-2"></i>
                <h3 class="text-lg font-semibold text-gray-900">F2 ì„¸ëŒ€</h3>
                <p class="text-2xl font-bold text-yellow-600" id="f2Count">0</p>
            </div>
            <div class="bg-white rounded-lg shadow-md p-4 text-center">
                <i class="fas fa-tree text-2xl text-purple-600 mb-2"></i>
                <h3 class="text-lg font-semibold text-gray-900">F3 ì„¸ëŒ€</h3>
                <p class="text-2xl font-bold text-purple-600" id="f3Count">0</p>
            </div>
            <div class="bg-white rounded-lg shadow-md p-4 text-center">
                <i class="fas fa-seedling text-2xl text-indigo-600 mb-2"></i>
                <h3 class="text-lg font-semibold text-gray-900">F4+ ì„¸ëŒ€</h3>
                <p class="text-2xl font-bold text-indigo-600" id="f4PlusCount">0</p>
            </div>
            <div class="bg-white rounded-lg shadow-md p-4 text-center">
                <i class="fas fa-baby text-2xl text-pink-600 mb-2"></i>
                <h3 class="text-lg font-semibold text-gray-900">ë² ì´ë¹„</h3>
                <p class="text-2xl font-bold text-pink-600" id="babyCount">0</p>
            </div>
            <div class="bg-white rounded-lg shadow-md p-4 text-center">
                <i class="fas fa-handshake text-2xl text-blue-600 mb-2"></i>
                <h3 class="text-lg font-semibold text-gray-900">ë¶„ì–‘ ì™„ë£Œ</h3>
                <p class="text-2xl font-bold text-blue-600" id="soldCount">0</p>
            </div>
        </div>

        <!-- ë©”ì¸ ê¸°ëŠ¥ ë²„íŠ¼ë“¤ -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-6 mb-8">
            <button onclick="showAnimalRegistrationModal()" class="card-hover bg-white rounded-xl shadow-lg p-6 text-center border border-gray-200">
                <i class="fas fa-plus-circle text-4xl text-green-600 mb-4"></i>
                <h3 class="text-lg font-semibold text-gray-900 mb-2">ê°œì²´ ë“±ë¡</h3>
                <p class="text-sm text-gray-600">ìƒˆë¡œìš´ ê°œì²´ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤</p>
            </button>
            
            <button onclick="showAnimalListModal()" class="card-hover bg-white rounded-xl shadow-lg p-6 text-center border border-gray-200">
                <i class="fas fa-list text-4xl text-blue-600 mb-4"></i>
                <h3 class="text-lg font-semibold text-gray-900 mb-2">ê°œì²´ ëª©ë¡</h3>
                <p class="text-sm text-gray-600">ë“±ë¡ëœ ê°œì²´ë“¤ì„ í™•ì¸í•©ë‹ˆë‹¤</p>
            </button>
            
            <button onclick="showBabyModal()" class="card-hover bg-white rounded-xl shadow-lg p-6 text-center border border-gray-200">
                <i class="fas fa-baby text-4xl text-pink-600 mb-4"></i>
                <h3 class="text-lg font-semibold text-gray-900 mb-2">ë² ì´ë¹„ ë“±ë¡</h3>
                <p class="text-sm text-gray-600">ìƒˆë¡œ íƒœì–´ë‚œ ë² ì´ë¹„ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤</p>
            </button>
            
            <button onclick="showBabyListModal()" class="card-hover bg-white rounded-xl shadow-lg p-6 text-center border border-gray-200">
                <i class="fas fa-heart text-4xl text-red-600 mb-4"></i>
                <h3 class="text-lg font-semibold text-gray-900 mb-2">ë² ì´ë¹„ ëª©ë¡</h3>
                <p class="text-sm text-gray-600">ë² ì´ë¹„ë“¤ì„ í™•ì¸í•©ë‹ˆë‹¤</p>
            </button>
            
            <button onclick="showSoldListModal()" class="card-hover bg-white rounded-xl shadow-lg p-6 text-center border border-gray-200">
                <i class="fas fa-handshake text-4xl text-blue-600 mb-4"></i>
                <h3 class="text-lg font-semibold text-gray-900 mb-2">ë¶„ì–‘ ì™„ë£Œ</h3>
                <p class="text-sm text-gray-600">ë¶„ì–‘ ì™„ë£Œëœ ê°œì²´ë“¤ì„ í™•ì¸í•©ë‹ˆë‹¤</p>
            </button>
            
            <button onclick="showBulkImportModal()" class="card-hover bg-white rounded-xl shadow-lg p-6 text-center border border-gray-200">
                <i class="fas fa-file-import text-4xl text-purple-600 mb-4"></i>
                <h3 class="text-lg font-semibold text-gray-900 mb-2">ëŒ€ëŸ‰ ê°€ì ¸ì˜¤ê¸°</h3>
                <p class="text-sm text-gray-600">Excel/CSV íŒŒì¼ë¡œ í•œë²ˆì— ë§ì€ ê°œì²´ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤</p>
            </button>
        </div>

        <!-- ì¶”ê°€ ê¸°ëŠ¥ ë²„íŠ¼ë“¤ -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <button onclick="showMorphCalculatorModal()" class="card-hover bg-white rounded-xl shadow-lg p-6 text-center border border-gray-200">
                <i class="fas fa-calculator text-4xl text-purple-600 mb-4"></i>
                <h3 class="text-lg font-semibold text-gray-900 mb-2">ëª¨í”„ ê³„ì‚°ê¸°</h3>
                <p class="text-sm text-gray-600">ëª¨í”„ ì¡°í•©ì„ ê³„ì‚°í•©ë‹ˆë‹¤</p>
            </button>
            
            <button onclick="showFamilyTreeModal()" class="card-hover bg-white rounded-xl shadow-lg p-6 text-center border border-gray-200">
                <i class="fas fa-sitemap text-4xl text-teal-600 mb-4"></i>
                <h3 class="text-lg font-semibold text-gray-900 mb-2">í˜ˆí†µ íŠ¸ë¦¬</h3>
                <p class="text-sm text-gray-600">í˜ˆí†µ ê´€ê³„ë¥¼ í™•ì¸í•©ë‹ˆë‹¤</p>
            </button>
        </div>
    </main>

    <!-- ëª¨ë‹¬ ì˜¤ë²„ë ˆì´ -->
    <div id="modalOverlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50" onclick="closeModal()">
        <div class="flex items-center justify-center min-h-screen p-4" onclick="event.stopPropagation()">
            <div id="modalContent" class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                <!-- ëª¨ë‹¬ ë‚´ìš©ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>

    <script type="module" src="firebaseConfig.js"></script>
    <script src="user-auth.js"></script>
    <script src="firebase-sync.js"></script>
    <script src="bulk-import.js"></script>
    <script src="script.js"></script>
    
    <script>
        // ëª¨ë‹¬ í•¨ìˆ˜ë“¤
        function showAnimalRegistrationModal() {
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-gray-900"><i class="fas fa-plus-circle mr-2"></i>ê°œì²´ ë“±ë¡</h2>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <form class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ê°œì²´ ì´ë¦„ *</label>
                            <input type="text" id="animalName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ì„±ë³„ *</label>
                            <select id="animalGender" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" required>
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="ìˆ˜ì»·">ìˆ˜ì»·</option>
                                <option value="ì•”ì»·">ì•”ì»·</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ì„¸ëŒ€ *</label>
                            <select id="animalGeneration" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" required>
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="F1">F1</option>
                                <option value="F2">F2</option>
                                <option value="F3">F3</option>
                                <option value="F4">F4</option>
                                <option value="F5">F5</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ëª¨í”„</label>
                            <div class="relative">
                                <input type="text" id="animalMorphSearch" placeholder="ëª¨í”„ ê²€ìƒ‰ ë˜ëŠ” ì„ íƒ..." 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                       autocomplete="off">
                                <div id="animalMorphDropdown" class="absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto hidden">
                                    <div class="p-2 border-b border-gray-200">
                                        <div class="text-xs font-semibold text-gray-500 mb-2">ì¸ê¸° ëª¨í”„</div>
                                        <div class="grid grid-cols-2 gap-1">
                                            <button type="button" class="morph-option px-2 py-1 text-xs bg-gray-100 hover:bg-green-100 rounded" data-value="ë…¸ë©€">ë…¸ë©€</button>
                                            <button type="button" class="morph-option px-2 py-1 text-xs bg-gray-100 hover:bg-green-100 rounded" data-value="ë¦´ë¦¬í™”ì´íŠ¸">ë¦´ë¦¬í™”ì´íŠ¸</button>
                                            <button type="button" class="morph-option px-2 py-1 text-xs bg-gray-100 hover:bg-green-100 rounded" data-value="ë‹¬ë§ˆì‹œì•ˆ">ë‹¬ë§ˆì‹œì•ˆ</button>
                                            <button type="button" class="morph-option px-2 py-1 text-xs bg-gray-100 hover:bg-green-100 rounded" data-value="í• ë¦¬í€¸">í• ë¦¬í€¸</button>
                                        </div>
                                    </div>
                                    <div class="max-h-48 overflow-y-auto">
                                        <div class="morph-group">
                                            <div class="px-3 py-2 text-xs font-semibold text-gray-600 bg-gray-50">ë² ì´ìŠ¤ ëª¨í”„</div>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="ë…¸ë©€">ë…¸ë©€</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="ë£¨ì•„">ë£¨ì•„</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="ë¶€í•­">ë¶€í•­</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="ë¦´ë¦¬í™”ì´íŠ¸">ë¦´ë¦¬í™”ì´íŠ¸</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="í—·ì•„ì§">í—·ì•„ì§</button>
                                        </div>
                                        <div class="morph-group">
                                            <div class="px-3 py-2 text-xs font-semibold text-gray-600 bg-gray-50">íŒ¨í„´ ëª¨í”„</div>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="ì„¸ì´ë¸”">ì„¸ì´ë¸”</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="ì•„ì”í‹±">ì•„ì”í‹±</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="ì´ˆì´ˆ">ì´ˆì´ˆ</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="ì¹´í‘¸ì¹˜ë…¸">ì¹´í‘¸ì¹˜ë…¸</button>
                                        </div>
                                        <div class="morph-group">
                                            <div class="px-3 py-2 text-xs font-semibold text-gray-600 bg-gray-50">ì¡°í•© ëª¨í”„</div>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="ë‹¬ë§ˆì‹œì•ˆ">ë‹¬ë§ˆì‹œì•ˆ</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="ìŠˆí¼ë‹¬ë§ˆì‹œì•ˆ">ìŠˆí¼ë‹¬ë§ˆì‹œì•ˆ</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="ë¸Œë§ë“¤">ë¸Œë§ë“¤</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="ì†”ë¦¬ë“œë°±">ì†”ë¦¬ë“œë°±</button>
                                        </div>
                                        <div class="morph-group">
                                            <div class="px-3 py-2 text-xs font-semibold text-gray-600 bg-gray-50">ê³ ê¸‰ ëª¨í”„</div>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="í• ë¦¬í€¸">í• ë¦¬í€¸</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="íŒ¬í…€">íŒ¬í…€</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="í•€ìŠ¤íŠ¸ë¼ì´í”„">í•€ìŠ¤íŠ¸ë¼ì´í”„</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="í™”ì´íŠ¸ì‡">í™”ì´íŠ¸ì‡</button>
                                        </div>
                                        <div class="morph-group">
                                            <div class="px-3 py-2 text-xs font-semibold text-gray-600 bg-gray-50">ìƒ‰ìƒ ëª¨í”„</div>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="ë ˆë“œ">ë ˆë“œ</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="ì˜ë¡œìš°">ì˜ë¡œìš°</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="í¬ë¦¼">í¬ë¦¼</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="íƒ€ì´ê±°">íƒ€ì´ê±°</button>
                                        </div>
                                        <div class="morph-group">
                                            <div class="px-3 py-2 text-xs font-semibold text-gray-600 bg-gray-50">íŠ¹ìˆ˜ ëª¨í”„</div>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="ë°”ì´">ë°”ì´</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="íŠ¸ë¼ì´">íŠ¸ë¼ì´</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="RCK">RCK</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="SPT">SPT</button>
                                        </div>
                                    </div>
                                </div>
                                <input type="hidden" id="animalMorph" value="">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ì´ë¯¸ì§€</label>
                            <input type="file" id="animalImage" accept="image/*" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                        </div>
                        
                        <div class="flex justify-end space-x-3 pt-4">
                            <button type="button" onclick="closeModal()" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                                ì·¨ì†Œ
                            </button>
                            <button type="button" onclick="registerAnimal()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                                ë“±ë¡
                            </button>
                        </div>
                    </form>
                </div>
            `;
            document.getElementById('modalOverlay').classList.remove('hidden');
        }

        function showAnimalListModal() {
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-gray-900"><i class="fas fa-list mr-2"></i>ê°œì²´ ëª©ë¡</h2>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div id="animalListContainer">
                        <!-- ê°œì²´ ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                </div>
            `;
            document.getElementById('modalOverlay').classList.remove('hidden');
            
            // ëª¨í”„ ê²€ìƒ‰ ê¸°ëŠ¥ ì´ˆê¸°í™”
            initializeMorphSearch('animalMorphSearch', 'animalMorphDropdown', 'animalMorph');
            loadAnimalList();
        }

        function showBabyModal() {
            // ë“±ë¡ëœ ê°œì²´ë“¤ ê°€ì ¸ì˜¤ê¸°
            const animals = getAllAnimals();
            const maleAnimals = animals.filter(a => a.gender === 'ìˆ˜ì»·' && a.status === 'í™œì„±');
            const femaleAnimals = animals.filter(a => a.gender === 'ì•”ì»·' && a.status === 'í™œì„±');
            
            let maleOptions = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';
            maleAnimals.forEach(animal => {
                maleOptions += `<option value="${animal.name}">${animal.name} (${animal.generation}ì„¸ëŒ€, ${animal.morph || 'Normal'})</option>`;
            });
            
            let femaleOptions = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';
            femaleAnimals.forEach(animal => {
                femaleOptions += `<option value="${animal.name}">${animal.name} (${animal.generation}ì„¸ëŒ€, ${animal.morph || 'Normal'})</option>`;
            });

            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-gray-900"><i class="fas fa-baby mr-2"></i>ë² ì´ë¹„ ë“±ë¡</h2>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="mb-4 p-3 bg-blue-50 rounded-lg">
                        <p class="text-sm text-blue-800">
                            <i class="fas fa-info-circle mr-2"></i>
                            ë² ì´ë¹„ IDëŠ” ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤. (í˜•ì‹: YYMMDD-ë¶€ëª¨ì´ë‹ˆì…œ-ìˆœë²ˆ)
                        </p>
                        <p class="text-xs text-blue-600 mt-1">
                            ì˜ˆì‹œ: 241215-ë£¨í¼-01 (2024ë…„ 12ì›” 15ì¼, ë£¨ì‹œí¼Ã—í¼ì‹œ, 1ë²ˆì§¸)
                        </p>
                    </div>
                    
                    <form class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ì„±ë³„ *</label>
                            <select id="babyGender" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent" required>
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="ë¯¸êµ¬ë¶„">ë¯¸êµ¬ë¶„</option>
                                <option value="ìˆ˜ì»·">ìˆ˜ì»·</option>
                                <option value="ìˆ˜ì»· ì¶”ì •">ìˆ˜ì»· ì¶”ì •</option>
                                <option value="ì•”ì»·">ì•”ì»·</option>
                                <option value="ì•”ì»· ì¶”ì •">ì•”ì»· ì¶”ì •</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ëª¨í”„</label>
                            <div class="relative">
                                <input type="text" id="babyMorphSearch" placeholder="ëª¨í”„ ê²€ìƒ‰ ë˜ëŠ” ì„ íƒ..." 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                       autocomplete="off">
                                <div id="babyMorphDropdown" class="absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto hidden">
                                    <div class="p-2 border-b border-gray-200">
                                        <div class="text-xs font-semibold text-gray-500 mb-2">ì¸ê¸° ëª¨í”„</div>
                                        <div class="grid grid-cols-2 gap-1">
                                            <button type="button" class="morph-option px-2 py-1 text-xs bg-gray-100 hover:bg-pink-100 rounded" data-value="ë…¸ë©€">ë…¸ë©€</button>
                                            <button type="button" class="morph-option px-2 py-1 text-xs bg-gray-100 hover:bg-pink-100 rounded" data-value="ë¦´ë¦¬í™”ì´íŠ¸">ë¦´ë¦¬í™”ì´íŠ¸</button>
                                            <button type="button" class="morph-option px-2 py-1 text-xs bg-gray-100 hover:bg-pink-100 rounded" data-value="ë‹¬ë§ˆì‹œì•ˆ">ë‹¬ë§ˆì‹œì•ˆ</button>
                                            <button type="button" class="morph-option px-2 py-1 text-xs bg-gray-100 hover:bg-pink-100 rounded" data-value="í• ë¦¬í€¸">í• ë¦¬í€¸</button>
                                        </div>
                                    </div>
                                    <div class="max-h-48 overflow-y-auto">
                                        <div class="morph-group">
                                            <div class="px-3 py-2 text-xs font-semibold text-gray-600 bg-gray-50">ë² ì´ìŠ¤ ëª¨í”„</div>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="ë…¸ë©€">ë…¸ë©€</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="ë£¨ì•„">ë£¨ì•„</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="ë¶€í•­">ë¶€í•­</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="ë¶€í•­ ë°€ë¦¬">ë¶€í•­ ë°€ë¦¬</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="ë°€ë¦¬ ì„¸ì´ë¸”">ë°€ë¦¬ ì„¸ì´ë¸”</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="ë¦´ë¦¬í™”ì´íŠ¸">ë¦´ë¦¬í™”ì´íŠ¸</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="í—·ì•„ì§">í—·ì•„ì§</button>
                                        </div>
                                        <div class="morph-group">
                                            <div class="px-3 py-2 text-xs font-semibold text-gray-600 bg-gray-50">íŒ¨í„´ ëª¨í”„</div>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="ì„¸ì´ë¸”">ì„¸ì´ë¸”</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="ì•„ì”í‹±">ì•„ì”í‹±</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="ì´ˆì´ˆ">ì´ˆì´ˆ</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="ì¹´í‘¸ì¹˜ë…¸">ì¹´í‘¸ì¹˜ë…¸</button>
                                        </div>
                                        <div class="morph-group">
                                            <div class="px-3 py-2 text-xs font-semibold text-gray-600 bg-gray-50">ì¡°í•© ëª¨í”„</div>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="ë‹¬ë§ˆì‹œì•ˆ">ë‹¬ë§ˆì‹œì•ˆ</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="ìŠˆí¼ë‹¬ë§ˆì‹œì•ˆ">ìŠˆí¼ë‹¬ë§ˆì‹œì•ˆ</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="ë¸Œë§ë“¤">ë¸Œë§ë“¤</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="ì†”ë¦¬ë“œë°±">ì†”ë¦¬ë“œë°±</button>
                                        </div>
                                        <div class="morph-group">
                                            <div class="px-3 py-2 text-xs font-semibold text-gray-600 bg-gray-50">ê³ ê¸‰ ëª¨í”„</div>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="í• ë¦¬í€¸">í• ë¦¬í€¸</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="íŒ¬í…€">íŒ¬í…€</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="í•€ìŠ¤íŠ¸ë¼ì´í”„">í•€ìŠ¤íŠ¸ë¼ì´í”„</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="í™”ì´íŠ¸ì‡">í™”ì´íŠ¸ì‡</button>
                                        </div>
                                        <div class="morph-group">
                                            <div class="px-3 py-2 text-xs font-semibold text-gray-600 bg-gray-50">ìƒ‰ìƒ ëª¨í”„</div>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="ë ˆë“œ">ë ˆë“œ</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="ì˜ë¡œìš°">ì˜ë¡œìš°</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="í¬ë¦¼">í¬ë¦¼</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="íƒ€ì´ê±°">íƒ€ì´ê±°</button>
                                        </div>
                                        <div class="morph-group">
                                            <div class="px-3 py-2 text-xs font-semibold text-gray-600 bg-gray-50">íŠ¹ìˆ˜ ëª¨í”„</div>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="ë°”ì´">ë°”ì´</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="íŠ¸ë¼ì´">íŠ¸ë¼ì´</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="RCK">RCK</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="SPT">SPT</button>
                                        </div>
                                    </div>
                                </div>
                                <input type="hidden" id="babyMorph" value="">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ì˜ˆìƒ ì„¸ëŒ€ (ìë™ ê³„ì‚°)</label>
                            <input type="text" id="babyGeneration" class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50" placeholder="ë¶€ëª¨ë¥¼ ì„ íƒí•˜ë©´ ìë™ìœ¼ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤" readonly>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ë¶€ê°œì²´ (ìˆ˜ì»·) *</label>
                            <select id="babyParent1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent" required>
                                ${maleOptions}
                            </select>
                            ${maleAnimals.length === 0 ? '<p class="text-xs text-red-600 mt-1">ë“±ë¡ëœ ìˆ˜ì»· ê°œì²´ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ê°œì²´ë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš”.</p>' : ''}
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ëª¨ê°œì²´ (ì•”ì»·) *</label>
                            <select id="babyParent2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent" required>
                                ${femaleOptions}
                            </select>
                            ${femaleAnimals.length === 0 ? '<p class="text-xs text-red-600 mt-1">ë“±ë¡ëœ ì•”ì»· ê°œì²´ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ê°œì²´ë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš”.</p>' : ''}
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">íƒœì–´ë‚œ ë‚ ì§œ *</label>
                            <input type="date" id="babyBirthDate" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ì´ë¯¸ì§€</label>
                            <input type="file" id="babyImage" accept="image/*" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                        </div>
                        
                        <div class="flex justify-end space-x-3 pt-4">
                            <button type="button" onclick="closeModal()" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                                ì·¨ì†Œ
                            </button>
                            <button type="button" onclick="registerBaby()" class="px-4 py-2 bg-pink-600 text-white rounded-lg hover:bg-pink-700">
                                ë“±ë¡
                            </button>
                        </div>
                    </form>
                </div>
            `;
            document.getElementById('modalOverlay').classList.remove('hidden');
            
            // ë¶€ëª¨ ì„ íƒ ì‹œ ì„¸ëŒ€ ìë™ ê³„ì‚°
            function updateBabyGeneration() {
                const parent1Name = document.getElementById('babyParent1').value;
                const parent2Name = document.getElementById('babyParent2').value;
                const generationField = document.getElementById('babyGeneration');
                
                if (parent1Name && parent2Name) {
                    const animals = getAllAnimals();
                    const parent1 = animals.find(a => a.name === parent1Name);
                    const parent2 = animals.find(a => a.name === parent2Name);
                    
                    if (parent1 && parent2) {
                        const parent1Gen = parseInt(parent1.generation.replace('F', ''));
                        const parent2Gen = parseInt(parent2.generation.replace('F', ''));
                        const maxParentGen = Math.max(parent1Gen, parent2Gen);
                        const babyGeneration = Math.min(maxParentGen + 1, 6); // ìµœëŒ€ F6
                        
                        generationField.value = `F${babyGeneration}`;
                        generationField.classList.remove('bg-gray-50');
                        generationField.classList.add('bg-green-50', 'text-green-800', 'font-semibold');
                    }
                } else {
                    generationField.value = '';
                    generationField.placeholder = 'ë¶€ëª¨ë¥¼ ì„ íƒí•˜ë©´ ìë™ìœ¼ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤';
                    generationField.classList.remove('bg-green-50', 'text-green-800', 'font-semibold');
                    generationField.classList.add('bg-gray-50');
                }
            }
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            document.getElementById('babyParent1').addEventListener('change', updateBabyGeneration);
            document.getElementById('babyParent2').addEventListener('change', updateBabyGeneration);
            
            // ëª¨í”„ ê²€ìƒ‰ ê¸°ëŠ¥ ì´ˆê¸°í™”
            initializeMorphSearch('babyMorphSearch', 'babyMorphDropdown', 'babyMorph');
        }

        function showBabyListModal() {
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-gray-900"><i class="fas fa-heart mr-2"></i>ë² ì´ë¹„ ëª©ë¡</h2>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div id="babyListContainer">
                        <!-- ë² ì´ë¹„ ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                </div>
            `;
            document.getElementById('modalOverlay').classList.remove('hidden');
            loadBabyList();
        }

        function showMorphCalculatorModal() {
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-gray-900"><i class="fas fa-calculator mr-2"></i>ëª¨í”„ ê³„ì‚°ê¸°</h2>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ë¶€ê°œì²´ ëª¨í”„</label>
                            <select id="fatherMorphs" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="Normal">Normal</option>
                                <option value="Super Dalmatian">Super Dalmatian</option>
                                <option value="Lily White">Lily White</option>
                                <option value="Pinstripe">Pinstripe</option>
                                <option value="Harlequin">Harlequin</option>
                                <option value="Tremper Albino">Tremper Albino</option>
                                <option value="Bell Albino">Bell Albino</option>
                                <option value="Creamsicle">Creamsicle</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ëª¨ê°œì²´ ëª¨í”„</label>
                            <select id="motherMorphs" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="Normal">Normal</option>
                                <option value="Super Dalmatian">Super Dalmatian</option>
                                <option value="Lily White">Lily White</option>
                                <option value="Pinstripe">Pinstripe</option>
                                <option value="Harlequin">Harlequin</option>
                                <option value="Tremper Albino">Tremper Albino</option>
                                <option value="Bell Albino">Bell Albino</option>
                                <option value="Creamsicle">Creamsicle</option>
                            </select>
  </div>

                        <div class="flex justify-end space-x-3 pt-4">
                            <button type="button" onclick="closeModal()" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                                ì·¨ì†Œ
                            </button>
                            <button type="button" onclick="calculateMorphs()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                                ê³„ì‚°
                            </button>
  </div>

                        <div id="morphResults" class="mt-6 p-4 bg-gray-50 rounded-lg">
                            <!-- ê³„ì‚° ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('modalOverlay').classList.remove('hidden');
        }

                function showSoldListModal() {
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-gray-900"><i class="fas fa-handshake mr-2"></i>ë¶„ì–‘ ì™„ë£Œ ëª©ë¡</h2>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div id="soldListContainer">
                        <!-- ë¶„ì–‘ ì™„ë£Œ ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                </div>
            `;
            document.getElementById('modalOverlay').classList.remove('hidden');
            loadSoldList();
        }

        function showBulkImportModal() {
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="p-6 max-w-4xl">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-gray-900">
                            <i class="fas fa-file-import mr-2"></i>ëŒ€ëŸ‰ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                        </h2>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="space-y-6">
                        <!-- 130ë§ˆë¦¬ ì•ˆë‚´ -->
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                            <div class="flex items-start">
                                <i class="fas fa-exclamation-triangle text-yellow-600 mt-1 mr-3"></i>
                                <div>
                                    <h3 class="font-semibold text-yellow-800">ëŒ€ëŸ‰ ë°ì´í„° ê´€ë¦¬ ëª¨ë“œ</h3>
                                    <p class="text-sm text-yellow-700 mt-1">
                                        130ë§ˆë¦¬ì˜ ë„ë§ˆë±€ ë°ì´í„°ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê¸° ìœ„í•´ ìµœì í™”ëœ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.
                                        ì´ë¯¸ì§€ëŠ” ìë™ìœ¼ë¡œ ì••ì¶•ë˜ë©°, í´ë¼ìš°ë“œ ë™ê¸°í™”ë¡œ ì•ˆì „í•˜ê²Œ ë³´ê´€ë©ë‹ˆë‹¤.
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- íŒŒì¼ ì—…ë¡œë“œ -->
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                            <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                            <h3 class="text-lg font-semibold text-gray-700 mb-2">íŒŒì¼ ì„ íƒ</h3>
                            <p class="text-sm text-gray-500 mb-4">
                                CSV, Excel, JSON íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”
                            </p>
                            <input type="file" id="bulkImportFile" accept=".csv,.xlsx,.xls,.json" 
                                   class="hidden" onchange="handleBulkImport(this)">
                            <button onclick="document.getElementById('bulkImportFile').click()" 
                                    class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                                íŒŒì¼ ì„ íƒ
                            </button>
                        </div>
                        
                        <!-- í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ -->
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <h3 class="font-semibold text-blue-800 mb-2">
                                <i class="fas fa-download mr-2"></i>í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ
                            </h3>
                            <p class="text-sm text-blue-700 mb-3">
                                ì•„ë˜ í…œí”Œë¦¿ì„ ë‹¤ìš´ë¡œë“œí•˜ì—¬ ë°ì´í„°ë¥¼ ì •ë¦¬í•œ í›„ ì—…ë¡œë“œí•˜ì„¸ìš”.
                            </p>
                            <button onclick="window.bulkDataManager.downloadTemplate()" 
                                    class="px-4 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700">
                                <i class="fas fa-file-csv mr-2"></i>CSV í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ
                            </button>
                        </div>
                        
                        <!-- í˜„ì¬ ë°ì´í„° ë‚´ë³´ë‚´ê¸° -->
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                            <h3 class="font-semibold text-green-800 mb-2">
                                <i class="fas fa-upload mr-2"></i>í˜„ì¬ ë°ì´í„° ë°±ì—…
                            </h3>
                            <p class="text-sm text-green-700 mb-3">
                                í˜„ì¬ ë“±ë¡ëœ ëª¨ë“  ë°ì´í„°ë¥¼ JSON íŒŒì¼ë¡œ ë°±ì—…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                            </p>
                            <button onclick="window.bulkDataManager.exportData()" 
                                    class="px-4 py-2 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700">
                                <i class="fas fa-download mr-2"></i>ì „ì²´ ë°ì´í„° ë°±ì—…
                            </button>
                        </div>
                        
                        <!-- ì§„í–‰ë¥  í‘œì‹œ -->
                        <div id="importProgress" class="hidden">
                            <!-- ì§„í–‰ë¥ ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                        </div>
                        
                        <!-- ì‚¬ìš© ê°€ì´ë“œ -->
                        <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                            <h3 class="font-semibold text-gray-800 mb-2">
                                <i class="fas fa-info-circle mr-2"></i>ì‚¬ìš© ê°€ì´ë“œ
                            </h3>
                            <div class="text-sm text-gray-700 space-y-1">
                                <p><strong>1. CSV í˜•ì‹:</strong> name,gender,generation,morph,birthDate,parent1,parent2</p>
                                <p><strong>2. ì„±ë³„:</strong> ìˆ˜ì»·, ì•”ì»·, ë¯¸êµ¬ë¶„ (ë˜ëŠ” male, female)</p>
                                <p><strong>3. ì„¸ëŒ€:</strong> F1, F2, F3, F4, F5, F6</p>
                                <p><strong>4. ë‚ ì§œ:</strong> YYYY-MM-DD í˜•ì‹ (ì˜ˆ: 2024-01-15)</p>
                                <p><strong>5. ì´ë¯¸ì§€:</strong> íŒŒì¼ ì—…ë¡œë“œ í›„ ê°œë³„ì ìœ¼ë¡œ ì¶”ê°€ ê°€ëŠ¥</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('modalOverlay').classList.remove('hidden');
        }

        function showFamilyTreeModal() {
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-gray-900"><i class="fas fa-sitemap mr-2"></i>í˜ˆí†µ íŠ¸ë¦¬</h2>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>

                    <div class="text-center py-8">
                        <i class="fas fa-tools text-4xl text-gray-300 mb-4"></i>
                        <p class="text-gray-500">ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤...</p>
                        <p class="text-sm text-gray-400 mt-2">ê³§ ì—…ë°ì´íŠ¸ë  ì˜ˆì •ì…ë‹ˆë‹¤!</p>
                    </div>
                </div>
            `;
            document.getElementById('modalOverlay').classList.remove('hidden');
        }
        
        // ëª¨í”„ ê²€ìƒ‰ ê¸°ëŠ¥
        function initializeMorphSearch(searchInputId, dropdownId, hiddenInputId) {
            const searchInput = document.getElementById(searchInputId);
            const dropdown = document.getElementById(dropdownId);
            const hiddenInput = document.getElementById(hiddenInputId);
            
            if (!searchInput || !dropdown || !hiddenInput) return;
            
            // ê²€ìƒ‰ ì…ë ¥ ì‹œ í•„í„°ë§
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const morphOptions = dropdown.querySelectorAll('.morph-option');
                const morphGroups = dropdown.querySelectorAll('.morph-group');
                
                if (searchTerm === '') {
                    // ê²€ìƒ‰ì–´ê°€ ì—†ìœ¼ë©´ ëª¨ë“  í•­ëª© í‘œì‹œ
                    morphOptions.forEach(option => option.style.display = 'block');
                    morphGroups.forEach(group => group.style.display = 'block');
                } else {
                    // ê²€ìƒ‰ì–´ì™€ ì¼ì¹˜í•˜ëŠ” í•­ëª©ë§Œ í‘œì‹œ
                    morphGroups.forEach(group => {
                        const groupOptions = group.querySelectorAll('.morph-option');
                        let hasVisibleOptions = false;
                        
                        groupOptions.forEach(option => {
                            const morphName = option.textContent.toLowerCase();
                            if (morphName.includes(searchTerm)) {
                                option.style.display = 'block';
                                hasVisibleOptions = true;
                            } else {
                                option.style.display = 'none';
                            }
                        });
                        
                        // ê·¸ë£¹ì— ë³´ì´ëŠ” ì˜µì…˜ì´ ìˆìœ¼ë©´ ê·¸ë£¹ë„ í‘œì‹œ
                        group.style.display = hasVisibleOptions ? 'block' : 'none';
                    });
                }
            });
            
            // í¬ì»¤ìŠ¤ ì‹œ ë“œë¡­ë‹¤ìš´ í‘œì‹œ
            searchInput.addEventListener('focus', function() {
                dropdown.classList.remove('hidden');
            });
            
            // ì™¸ë¶€ í´ë¦­ ì‹œ ë“œë¡­ë‹¤ìš´ ìˆ¨ê¹€
            document.addEventListener('click', function(e) {
                if (!searchInput.contains(e.target) && !dropdown.contains(e.target)) {
                    dropdown.classList.add('hidden');
                }
            });
            
            // ëª¨í”„ ì˜µì…˜ í´ë¦­ ì‹œ ì„ íƒ
            dropdown.addEventListener('click', function(e) {
                if (e.target.classList.contains('morph-option')) {
                    const selectedValue = e.target.getAttribute('data-value');
                    searchInput.value = selectedValue;
                    hiddenInput.value = selectedValue;
                    dropdown.classList.add('hidden');
                }
            });
            
            // ì—”í„°í‚¤ ì²˜ë¦¬
            searchInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    const visibleOptions = dropdown.querySelectorAll('.morph-option[style*="block"], .morph-option:not([style])');
                    if (visibleOptions.length > 0) {
                        const firstOption = visibleOptions[0];
                        const selectedValue = firstOption.getAttribute('data-value');
                        searchInput.value = selectedValue;
                        hiddenInput.value = selectedValue;
                        dropdown.classList.add('hidden');
                    }
                }
                
                if (e.key === 'Escape') {
                    dropdown.classList.add('hidden');
                }
            });
        }
        
        // ìˆ˜ë™ ë™ê¸°í™” í•¨ìˆ˜
        function manualSync() {
            if (window.firebaseSync) {
                window.firebaseSync.manualSync();
            } else {
                alert('ë™ê¸°í™” ì‹œìŠ¤í…œì´ ì•„ì§ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            }
        }
        
        // ì‚¬ìš©ì ë©”ë‰´ í† ê¸€
        function toggleUserMenu() {
            const menu = document.getElementById('userMenu');
            menu.classList.toggle('hidden');
        }
        
        // ì™¸ë¶€ í´ë¦­ ì‹œ ë©”ë‰´ ë‹«ê¸°
        document.addEventListener('click', function(e) {
            const menu = document.getElementById('userMenu');
            const button = e.target.closest('button[onclick="toggleUserMenu()"]');
            
            if (!button && menu && !menu.contains(e.target)) {
                menu.classList.add('hidden');
            }
        });
        
        // ëŒ€ëŸ‰ ê°€ì ¸ì˜¤ê¸° ì²˜ë¦¬
        async function handleBulkImport(input) {
            const file = input.files[0];
            if (!file) return;
            
            try {
                document.getElementById('importProgress').classList.remove('hidden');
                
                console.log('ğŸ“ íŒŒì¼ ì²˜ë¦¬ ì‹œì‘:', file.name);
                await window.bulkDataManager.importFromFile(file);
                
                // UI ìƒˆë¡œê³ ì¹¨
                if (window.updateStatistics) {
                    window.updateStatistics();
                }
                
                // ê°œì²´ ëª©ë¡ì´ ì—´ë ¤ìˆìœ¼ë©´ ìƒˆë¡œê³ ì¹¨
                if (document.getElementById('animalListContainer')) {
                    window.loadAnimalList();
                }
                
            } catch (error) {
                console.error('ëŒ€ëŸ‰ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
                alert('íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                
                document.getElementById('importProgress').innerHTML = `
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <div class="flex items-center">
                            <i class="fas fa-exclamation-circle text-red-600 mr-2"></i>
                            <span class="text-red-800 font-semibold">ì˜¤ë¥˜ ë°œìƒ</span>
                        </div>
                        <p class="text-sm text-red-700 mt-1">${error.message}</p>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>