<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="description" content="실시간 동기화 지원 크레스티드 게코 브리딩 관리 시스템 - PC와 모바일 간 완벽 동기화">
    <meta name="keywords" content="크레스티드게코, 브리딩, 파충류, 관리시스템, PWA, 실시간동기화">
    <meta name="author" content="크레스티드 게코 브리더">
    <meta name="robots" content="index, follow">
    
    <!-- PWA 설정 -->
    <link rel="manifest" href="manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="게코 브리딩">
    <meta name="theme-color" content="#1565C0">
    <meta name="msapplication-TileColor" content="#1565C0">
    
    <!-- 보안 헤더 -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    
    <title>크레스티드 게코 브리딩 시스템 | 실시간 동기화 지원</title>
    
    <!-- Icons -->
    <link rel="apple-touch-icon" sizes="192x192" href="icons/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192x192.png">
    
    <!-- 외부 리소스 최적화 -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="preconnect" href="https://cdn.tailwindcss.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="dns-prefetch" href="https://www.gstatic.com">
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    
    <!-- 폰트 및 스타일 -->
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" rel="stylesheet" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com" crossorigin="anonymous"></script>
    
    <style>
        :root {
            /* 토스 스타일 색상 시스템 */
            --primary-50: #e3f2fd;
            --primary-100: #bbdefb;
            --primary-200: #90caf9;
            --primary-300: #64b5f6;
            --primary-400: #42a5f5;
            --primary-500: #2196f3;
            --primary-600: #1e88e5;
            --primary-700: #1976d2;
            --primary-800: #1565c0;
            --primary-900: #0d47a1;
            
            /* 네이버 스타일 그레이 */
            --gray-50: #fafafa;
            --gray-100: #f5f5f5;
            --gray-200: #eeeeee;
            --gray-300: #e0e0e0;
            --gray-400: #bdbdbd;
            --gray-500: #9e9e9e;
            --gray-600: #757575;
            --gray-700: #424242;
            --gray-800: #212121;
            --gray-900: #000000;
            
            /* 카카오 스타일 컬러 */
            --success: #00c853;
            --warning: #ff9800;
            --error: #f44336;
            --info: #2196f3;
            
            /* 디자인 시스템 */
            --border-radius: 12px;
            --border-radius-lg: 16px;
            --shadow: 0 2px 8px rgba(0,0,0,0.1);
            --shadow-lg: 0 4px 20px rgba(0,0,0,0.15);
            --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Pretendard Variable', Pretendard, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #fafafa;
            color: var(--gray-800);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* 카드 시스템 - 토스/네이버 스타일 */
        .card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            border: 1px solid var(--gray-200);
            transition: var(--transition);
        }

        .card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-1px);
            border-color: var(--gray-300);
        }

        .card-clickable:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
            border-color: var(--primary-200);
            cursor: pointer;
        }

        /* 헤더 */
        .header {
            background: white;
            border-bottom: 1px solid var(--gray-200);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 40;
        }

        /* 통계 카드 */
        .stat-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 1.25rem;
            border: 1px solid var(--gray-200);
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .stat-value {
            font-size: 1.875rem;
            font-weight: 700;
            color: var(--gray-900);
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--gray-600);
            font-weight: 500;
        }

        /* 기능 카드 - 모바일 터치 최적화 */
        .feature-card {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .feature-card:hover, .feature-card:focus {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-200);
            outline: none;
        }
        
        .feature-card:active {
            transform: translateY(0);
            box-shadow: var(--shadow);
        }

        .feature-card:hover .feature-icon {
            transform: scale(1.1);
        }
        
        /* 터치 디바이스 최적화 */
        @media (hover: none) and (pointer: coarse) {
            .feature-card:hover {
                transform: none;
                box-shadow: var(--shadow);
            }
            
            .feature-card:active {
                transform: scale(0.95);
                background-color: var(--gray-50);
                box-shadow: var(--shadow);
            }
            
            /* 모바일에서 버튼 터치 피드백 */
            button:active {
                transform: scale(0.95);
                opacity: 0.8;
            }
            
            /* 터치 시 스크롤 방지 */
            .feature-card {
                touch-action: manipulation;
                -webkit-tap-highlight-color: rgba(0,0,0,0.1);
            }
            
            button {
                touch-action: manipulation;
                -webkit-tap-highlight-color: rgba(0,0,0,0.1);
            }
        }
        
        /* 모바일에서 텍스트 선택 방지 */
        .feature-card, .feature-title, .feature-description {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .feature-icon {
            font-size: 2rem;
            margin-bottom: 0.75rem;
            transition: var(--transition);
        }

        .feature-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 0.25rem;
        }

        .feature-description {
            font-size: 0.875rem;
            color: var(--gray-600);
        }

        /* 버튼 - 터치 친화적 */
        .btn-primary {
            background-color: var(--primary-600);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            padding: 0.75rem 1rem;
            font-weight: 500;
            font-size: 0.875rem;
            cursor: pointer;
            transition: var(--transition);
            min-height: 44px; /* iOS 터치 타겟 권장 크기 */
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .btn-primary:hover {
            background-color: var(--primary-700);
            transform: translateY(-1px);
        }
        
        .btn-primary:active {
            transform: translateY(0);
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .btn-secondary {
            background-color: var(--gray-100);
            color: var(--gray-700);
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius);
            padding: 0.75rem 1rem;
            font-weight: 500;
            font-size: 0.875rem;
            cursor: pointer;
            transition: var(--transition);
            min-height: 44px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .btn-secondary:hover {
            background-color: var(--gray-200);
            transform: translateY(-1px);
        }
        
        .btn-secondary:active {
            transform: translateY(0);
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        /* 토스트 알림 - 모바일 최적화 */
        .toast {
            position: fixed;
            top: 1rem;
            right: 1rem;
            left: 1rem;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            padding: 1rem;
            z-index: 1000;
            opacity: 0;
            transform: translateX(100%);
            transition: var(--transition);
        }

        .toast.show {
            opacity: 1;
            transform: translateX(0);
        }
        
        @media (min-width: 640px) {
            .toast {
                left: auto;
                max-width: 20rem;
            }
        }

        /* 모달 - 모바일 최적화 */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 50;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem;
        }

        .modal-content {
            background: white;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-lg);
            max-width: 100vw;
            max-height: 95vh;
            overflow-y: auto;
            width: 100%;
            margin: 0.5rem;
        }
        
        @media (min-width: 640px) {
            .modal-content {
                max-width: 90vw;
                width: auto;
                margin: 1rem;
            }
        }
        
        @media (min-width: 768px) {
            .modal-content {
                max-width: 600px;
            }
        }

        /* 폼 요소 */
        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius);
            font-size: 0.875rem;
            transition: var(--transition);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }

        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--gray-700);
            margin-bottom: 0.5rem;
        }

        /* 반응형 그리드 */
        .grid {
            display: grid;
            gap: 1rem;
        }

        .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        .grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        .grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
        .grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
        .grid-cols-7 { grid-template-columns: repeat(7, minmax(0, 1fr)); }

        @media (min-width: 640px) {
            .sm\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
            .sm\:grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
            .sm\:grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
        }

        @media (min-width: 768px) {
            .md\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
            .md\:grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
            .md\:grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
            .md\:grid-cols-7 { grid-template-columns: repeat(7, minmax(0, 1fr)); }
        }

        @media (min-width: 1024px) {
            .lg\:grid-cols-7 { grid-template-columns: repeat(7, minmax(0, 1fr)); }
        }

        /* 유틸리티 클래스 */
        .text-center { text-align: center; }
        .font-semibold { font-weight: 600; }
        .font-bold { font-weight: 700; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mb-8 { margin-bottom: 2rem; }
        .p-4 { padding: 1rem; }
        .p-6 { padding: 1.5rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .hidden { display: none; }
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .space-x-2 > * + * { margin-left: 0.5rem; }
        .space-x-4 > * + * { margin-left: 1rem; }
    </style>
</head>
<body>
    <!-- 헤더 - 모바일 최적화 -->
    <header class="header">
        <div class="max-w-7xl mx-auto px-3 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-3">
                <!-- 로고 및 제목 -->
                <div class="flex items-center space-x-2 sm:space-x-4">
                    <div class="flex items-center justify-center w-8 h-8 sm:w-10 sm:h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl">
                        <i class="fas fa-dragon text-white text-sm sm:text-xl"></i>
                    </div>
                    <h1 class="text-sm sm:text-xl font-bold text-gray-900">크레스티드 게코</h1>
                </div>
                
                <!-- 모바일 상태 표시 -->
                <div class="flex items-center space-x-1 sm:space-x-4">
                    <!-- 사용자 정보 -->
                    <div id="userInfo" class="hidden sm:block">
                        <!-- 사용자 정보가 여기에 표시됩니다 -->
                    </div>
                    
                    <!-- 동기화 상태 (모바일에서는 아이콘만) -->
                    <div id="syncStatus" class="text-xs">
                        <span class="text-gray-600 sm:hidden">⏳</span>
                        <span class="text-gray-600 hidden sm:inline">⏳ 동기화 준비중</span>
                    </div>
                    
                    <!-- 액션 버튼들 -->
                    <div class="flex space-x-1 sm:space-x-2">
                        <!-- PWA 설치 버튼 -->
                        <button id="pwaInstallBtn" onclick="installPWA()" class="btn-primary hidden text-xs sm:text-sm px-2 sm:px-4">
                            <i class="fas fa-download"></i>
                            <span class="hidden sm:inline ml-1">앱 설치</span>
                        </button>
                        
                        <!-- 동기화 버튼 -->
                        <button onclick="manualSync()" class="btn-primary text-xs sm:text-sm px-2 sm:px-4">
                            <i class="fas fa-sync"></i>
                            <span class="hidden sm:inline ml-1">동기화</span>
                        </button>
                        
                        <!-- 메뉴 버튼 -->
                        <div class="relative">
                            <button onclick="toggleUserMenu()" class="btn-secondary text-xs sm:text-sm px-2 sm:px-4">
                                <i class="fas fa-bars sm:hidden"></i>
                                <i class="fas fa-user hidden sm:inline"></i>
                                <span class="hidden sm:inline ml-1">설정</span>
                            </button>
                            <div id="userMenu" class="hidden absolute right-0 mt-2 w-40 sm:w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-50">
                                <button onclick="changeUser()" class="w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-t-lg">
                                    <i class="fas fa-user-switch mr-2"></i>사용자 변경
                                </button>
                                <button onclick="logout()" class="w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-b-lg">
                                    <i class="fas fa-sign-out-alt mr-2"></i>로그아웃
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- 메인 컨텐츠 -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <!-- 산란 알림 대시보드 -->
        <div id="breedingAlerts" class="mb-8 hidden">
            <!-- 산란 알림이 여기에 표시됩니다 -->
        </div>

        <!-- 통계 대시보드 -->
        <section class="mb-8">
            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-7 gap-4">
                <div class="stat-card text-center">
                    <div class="flex items-center justify-center w-12 h-12 bg-green-100 rounded-xl mx-auto mb-3">
                        <i class="fas fa-dragon text-green-600 text-xl"></i>
                    </div>
                    <div class="stat-value" id="totalAnimals">0</div>
                    <div class="stat-label">총 개체</div>
                </div>
                <div class="stat-card text-center">
                    <div class="flex items-center justify-center w-12 h-12 bg-blue-100 rounded-xl mx-auto mb-3">
                        <i class="fas fa-seedling text-blue-600 text-xl"></i>
                    </div>
                    <div class="stat-value" id="f1Count">0</div>
                    <div class="stat-label">F1 세대</div>
                </div>
                <div class="stat-card text-center">
                    <div class="flex items-center justify-center w-12 h-12 bg-yellow-100 rounded-xl mx-auto mb-3">
                        <i class="fas fa-leaf text-yellow-600 text-xl"></i>
                    </div>
                    <div class="stat-value" id="f2Count">0</div>
                    <div class="stat-label">F2 세대</div>
                </div>
                <div class="stat-card text-center">
                    <div class="flex items-center justify-center w-12 h-12 bg-purple-100 rounded-xl mx-auto mb-3">
                        <i class="fas fa-tree text-purple-600 text-xl"></i>
                    </div>
                    <div class="stat-value" id="f3Count">0</div>
                    <div class="stat-label">F3 세대</div>
                </div>
                <div class="stat-card text-center">
                    <div class="flex items-center justify-center w-12 h-12 bg-indigo-100 rounded-xl mx-auto mb-3">
                        <i class="fas fa-seedling text-indigo-600 text-xl"></i>
                    </div>
                    <div class="stat-value" id="f4PlusCount">0</div>
                    <div class="stat-label">F4+ 세대</div>
                </div>
                <div class="stat-card text-center">
                    <div class="flex items-center justify-center w-12 h-12 bg-pink-100 rounded-xl mx-auto mb-3">
                        <i class="fas fa-baby text-pink-600 text-xl"></i>
                    </div>
                    <div class="stat-value" id="babyCount">0</div>
                    <div class="stat-label">베이비</div>
                </div>
                <div class="stat-card text-center">
                    <div class="flex items-center justify-center w-12 h-12 bg-blue-100 rounded-xl mx-auto mb-3">
                        <i class="fas fa-handshake text-blue-600 text-xl"></i>
                    </div>
                    <div class="stat-value" id="soldCount">0</div>
                    <div class="stat-label">분양 완료</div>
                </div>
            </div>
        </section>

        <!-- 주요 기능 - 모바일 최적화 -->
        <section class="mb-6">
            <h2 class="text-base sm:text-lg font-semibold text-gray-900 mb-3 sm:mb-4 px-1">🦎 주요 기능</h2>
            <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-3 sm:gap-4">
                <button onclick="showAnimalRegistrationModal()" class="feature-card" type="button">
                    <div class="feature-icon text-green-600">
                        <i class="fas fa-plus-circle"></i>
                    </div>
                    <div class="feature-title text-xs sm:text-sm">개체 등록</div>
                    <div class="feature-description text-xs hidden sm:block">새로운 개체 등록</div>
                </button>
                
                <button onclick="showAnimalListModal()" class="feature-card" type="button">
                    <div class="feature-icon text-blue-600">
                        <i class="fas fa-list"></i>
                    </div>
                    <div class="feature-title text-xs sm:text-sm">개체 목록</div>
                    <div class="feature-description text-xs hidden sm:block">등록된 개체 관리</div>
                </button>
                
                <button onclick="showBabyModal()" class="feature-card" type="button">
                    <div class="feature-icon text-pink-600">
                        <i class="fas fa-baby"></i>
                    </div>
                    <div class="feature-title text-xs sm:text-sm">베이비 등록</div>
                    <div class="feature-description text-xs hidden sm:block">새 베이비 등록</div>
                </button>
                
                <button onclick="showBabyListModal()" class="feature-card" type="button">
                    <div class="feature-icon text-red-600">
                        <i class="fas fa-heart"></i>
                    </div>
                    <div class="feature-title text-xs sm:text-sm">베이비 목록</div>
                    <div class="feature-description text-xs hidden sm:block">베이비 관리</div>
                </button>
                
                <button onclick="showSoldListModal()" class="feature-card" type="button">
                    <div class="feature-icon text-blue-600">
                        <i class="fas fa-handshake"></i>
                    </div>
                    <div class="feature-title text-xs sm:text-sm">분양 완료</div>
                    <div class="feature-description text-xs hidden sm:block">분양 완료 목록</div>
                </button>
                
                <button onclick="showBulkImportModal()" class="feature-card" type="button">
                    <div class="feature-icon text-purple-600">
                        <i class="fas fa-file-import"></i>
                    </div>
                    <div class="feature-title text-xs sm:text-sm">대량 가져오기</div>
                    <div class="feature-description text-xs hidden sm:block">CSV/Excel 가져오기</div>
                </button>
            </div>
        </section>

        <!-- 고급 기능 - 모바일 최적화 -->
        <section class="mb-6">
            <h2 class="text-base sm:text-lg font-semibold text-gray-900 mb-3 sm:mb-4 px-1">⚡ 고급 기능</h2>
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4">
                <button onclick="showMorphCalculatorModal()" class="feature-card h-24 sm:h-auto" type="button">
                    <div class="feature-icon text-purple-600 text-lg sm:text-2xl">
                        <i class="fas fa-calculator"></i>
                    </div>
                    <div class="feature-title text-sm sm:text-base">모프 계산기</div>
                    <div class="feature-description text-xs hidden sm:block">유전 조합 예측</div>
                </button>
                
                <button onclick="showFamilyTreeModal()" class="feature-card h-24 sm:h-auto" type="button">
                    <div class="feature-icon text-teal-600 text-lg sm:text-2xl">
                        <i class="fas fa-sitemap"></i>
                    </div>
                    <div class="feature-title text-sm sm:text-base">혈통 트리</div>
                    <div class="feature-description text-xs hidden sm:block">혈통 관계 조회</div>
                </button>
                
                <button onclick="showHealthManagementModal()" class="feature-card h-24 sm:h-auto" type="button">
                    <div class="feature-icon text-red-600 text-lg sm:text-2xl">
                        <i class="fas fa-heartbeat"></i>
                    </div>
                    <div class="feature-title text-sm sm:text-base">건강 관리</div>
                    <div class="feature-description text-xs hidden sm:block">건강 기록 관리</div>
                </button>
            </div>
        </section>
    </main>

    <!-- 모달 -->
    <div id="modalOverlay" class="hidden modal-overlay">
        <div id="modalContent" class="modal-content relative">
            <!-- 닫기 버튼 -->
            <button onclick="closeModal()" class="absolute top-4 right-4 z-10 w-8 h-8 bg-gray-200 hover:bg-gray-300 rounded-full flex items-center justify-center text-gray-600 hover:text-gray-800 transition-colors">
                <i class="fas fa-times"></i>
            </button>
            <!-- 모달 내용이 여기에 동적으로 삽입됩니다 -->
        </div>
    </div>
    
    <!-- ESC 키 및 클릭으로 모달 닫기 -->
    <script>
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal();
            }
        });
        
        document.getElementById('modalOverlay').addEventListener('click', function(event) {
            if (event.target === this) {
                closeModal();
            }
        });
    </script>

    <!-- Firebase SDK v9 (최신 모듈 방식) -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, doc, setDoc, getDoc, onSnapshot, collection, enableNetwork, disableNetwork } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getStorage, ref, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';
        import { getAuth, signInAnonymously, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        // Firebase 설정
        const firebaseConfig = {
            apiKey: "AIzaSyDD5ZpR5fk70tmcKXB09FEj5g6LeZb1-Zc",
            authDomain: "crested-gecko-breeding.firebaseapp.com",
            projectId: "crested-gecko-breeding",
            storageBucket: "crested-gecko-breeding.firebasestorage.app",
            messagingSenderId: "12684495107",
            appId: "1:12684495107:web:289489c1a456db8b134136"
        };

        // Firebase 초기화
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app);
        const auth = getAuth(app);

        // 전역으로 내보내기
        window.db = db;
        window.firebaseStorage = storage;
        window.auth = auth;
        window.firebaseImports = {
            doc, setDoc, getDoc, onSnapshot, collection,
            ref, uploadBytes, getDownloadURL,
            signInAnonymously, onAuthStateChanged,
            enableNetwork, disableNetwork
        };

        // 익명 인증 (에러 처리 개선)
        signInAnonymously(auth).then((result) => {
            window.currentUserId = result.user.uid;
            console.log('🔐 익명 로그인 완료:', window.currentUserId);
            
            // Firebase 준비 완료 이벤트 발생
            setTimeout(() => {
                window.dispatchEvent(new CustomEvent('firebaseReady'));
            }, 500);
            
            // 사용자 정보 UI 업데이트
            updateUserInfo(result.user.uid);
            
        }).catch((error) => {
            console.warn('Firebase 인증 실패, 오프라인 모드로 전환:', error.message);
            // 오프라인 모드로 전환
            window.currentUserId = 'offline_' + Date.now();
            setTimeout(() => {
                window.dispatchEvent(new CustomEvent('firebaseReady'));
            }, 500);
            
            // 오프라인 모드 사용자 정보
            const userInfoElement = document.getElementById('userInfo');
            if (userInfoElement) {
                userInfoElement.innerHTML = `
                    <div class="flex items-center space-x-2">
                        <div class="w-2 h-2 bg-gray-500 rounded-full"></div>
                        <span class="text-sm text-gray-600">오프라인 모드</span>
                    </div>
                `;
            }
        });

        function updateUserInfo(userId) {
            const userInfoElement = document.getElementById('userInfo');
            if (userInfoElement) {
                const shortId = userId.substring(0, 8);
                userInfoElement.innerHTML = `
                    <div class="flex items-center space-x-2">
                        <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                        <span class="text-sm text-gray-600">사용자: ${shortId}</span>
                    </div>
                `;
            }
        }
        
        // 전역 함수 정의
        window.changeUser = function() {
            if (window.userAuth && typeof window.userAuth.changeUser === 'function') {
                window.userAuth.changeUser();
            } else {
                console.warn('사용자 인증 시스템을 찾을 수 없습니다.');
                alert('사용자 인증 시스템이 아직 로드되지 않았습니다. 잠시 후 다시 시도해주세요.');
            }
        };
        
        window.logout = function() {
            if (window.userAuth && typeof window.userAuth.logout === 'function') {
                window.userAuth.logout();
            } else {
                console.warn('사용자 인증 시스템을 찾을 수 없습니다.');
                alert('사용자 인증 시스템이 아직 로드되지 않았습니다. 잠시 후 다시 시도해주세요.');
            }
        };
        
        window.toggleUserMenu = function() {
            const menu = document.getElementById('userMenu');
            if (menu) {
                menu.classList.toggle('hidden');
            }
        };
    </script>
    
    <!-- 전역 오류 핸들러 -->
    <script>
        // 향상된 전역 에러 처리
        const errorReports = [];
        const MAX_ERROR_REPORTS = 10;
        
        function logError(error, context = 'unknown') {
            const errorInfo = {
                message: error.message || 'Unknown error',
                stack: error.stack || 'No stack trace',
                context: context,
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                url: window.location.href
            };
            
            // 에러 큐 관리
            errorReports.push(errorInfo);
            if (errorReports.length > MAX_ERROR_REPORTS) {
                errorReports.shift();
            }
            
            console.error(`[${context}] 오류:`, errorInfo);
            
            // 심각한 오류의 경우 사용자에게 알림
            const criticalErrors = ['QuotaExceededError', 'SecurityError', 'NetworkError'];
            if (criticalErrors.some(err => error.message?.includes(err))) {
                if (typeof window.showToast === 'function') {
                    window.showToast('시스템 오류가 발생했습니다. 잠시 후 다시 시도해주세요.', 'error');
                }
            }
        }
        
        window.addEventListener('error', function(e) {
            // 치명적이지 않은 오류는 조용히 처리
            if (e.message && (
                e.message.includes('Script error') ||
                e.message.includes('Non-Error promise rejection') ||
                e.message.includes('Loading chunk') ||
                e.message.includes('Loading CSS chunk') ||
                e.message.includes('ResizeObserver loop limit exceeded')
            )) {
                console.warn('외부 리소스 오류 (무시됨):', e.message);
                return;
            }
            
            logError({
                message: e.message,
                stack: e.error?.stack,
                filename: e.filename,
                lineno: e.lineno,
                colno: e.colno
            }, 'global-error');
        });
        
        // Promise 에러 처리 개선
        window.addEventListener('unhandledrejection', function(e) {
            // Firebase나 외부 라이브러리 오류는 조용히 처리
            const reason = e.reason?.toString() || '';
            if (reason.includes('firebase') || 
                reason.includes('Network Error') || 
                reason.includes('Failed to fetch')) {
                console.warn('외부 서비스 연결 오류 (무시됨):', reason);
                e.preventDefault();
                return;
            }
            
            console.error('처리되지 않은 Promise 오류:', e.reason);
            e.preventDefault();
        });
        
        // PWA 설치 관리
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            // 기본 설치 프롬프트 방지
            e.preventDefault();
            deferredPrompt = e;
            
            // 설치 버튼 표시
            const installBtn = document.getElementById('pwaInstallBtn');
            if (installBtn) {
                installBtn.classList.remove('hidden');
            }
        });
        
        window.installPWA = function() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('📱 PWA 설치됨');
                        // 토스트 알림
                        showToast('앱이 설치되었습니다! 홈 화면에서 확인해보세요.', 'success');
                    } else {
                        console.log('❌ PWA 설치 취소됨');
                    }
                    deferredPrompt = null;
                    document.getElementById('pwaInstallBtn').classList.add('hidden');
                });
            }
        };
        
        // 앱 설치 완료 시
        window.addEventListener('appinstalled', (e) => {
            console.log('✅ PWA 설치 완료');
            showToast('앱이 성공적으로 설치되었습니다!', 'success');
            document.getElementById('pwaInstallBtn').classList.add('hidden');
        });
        
        // 리소스 로드 완료 확인
        window.addEventListener('load', function() {
            console.log('🚀 페이지 로드 완료');
            
            // Service Worker 등록 (에러 무시)
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('SW 등록 성공:', registration.scope);
                        
                        // 업데이트 확인
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    showToast('새 업데이트가 있습니다. 페이지를 새로고침하세요.', 'info');
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.warn('SW 등록 실패 (계속 진행):', error.message);
                    });
            }
        });
        
        // 간단하고 확실한 버튼 이벤트 처리
        function addTouchSupport() {
            console.log('🔧 버튼 이벤트 설정 시작');
            
            // 모든 버튼에 직접 이벤트 바인딩
            setTimeout(() => {
                // 개체 등록 버튼
                const animalRegBtn = document.querySelector('button[onclick="showAnimalRegistrationModal()"]');
                if (animalRegBtn) {
                    animalRegBtn.onclick = function(e) {
                        e.preventDefault();
                        console.log('개체 등록 버튼 클릭됨');
                        if (typeof window.showAnimalRegistrationModal === 'function') {
                            window.showAnimalRegistrationModal();
                        } else {
                            alert('개체 등록 기능을 로딩 중입니다...');
                        }
                    };
                    console.log('✅ 개체 등록 버튼 연결됨');
                }
                
                // 개체 목록 버튼
                const animalListBtn = document.querySelector('button[onclick="showAnimalListModal()"]');
                if (animalListBtn) {
                    animalListBtn.onclick = function(e) {
                        e.preventDefault();
                        console.log('개체 목록 버튼 클릭됨');
                        if (typeof window.showAnimalListModal === 'function') {
                            window.showAnimalListModal();
                        } else {
                            alert('개체 목록 기능을 로딩 중입니다...');
                        }
                    };
                    console.log('✅ 개체 목록 버튼 연결됨');
                }
                
                // 동기화 버튼
                const syncBtn = document.querySelector('button[onclick="manualSync()"]');
                if (syncBtn) {
                    syncBtn.onclick = function(e) {
                        e.preventDefault();
                        console.log('동기화 버튼 클릭됨');
                        alert('수동 동기화를 실행합니다.');
                    };
                    console.log('✅ 동기화 버튼 연결됨');
                }
                
                // PWA 설치 버튼
                const pwaBtn = document.querySelector('button[onclick="installPWA()"]');
                if (pwaBtn) {
                    pwaBtn.onclick = function(e) {
                        e.preventDefault();
                        console.log('PWA 설치 버튼 클릭됨');
                        if (typeof window.installPWA === 'function') {
                            window.installPWA();
                        } else {
                            alert('PWA 설치 기능을 준비 중입니다.');
                        }
                    };
                    console.log('✅ PWA 설치 버튼 연결됨');
                }
                
                // 메뉴 버튼
                const menuBtn = document.querySelector('button[onclick="toggleUserMenu()"]');
                if (menuBtn) {
                    menuBtn.onclick = function(e) {
                        e.preventDefault();
                        console.log('메뉴 버튼 클릭됨');
                        const userMenu = document.getElementById('userMenu');
                        if (userMenu) {
                            userMenu.classList.toggle('hidden');
                        }
                    };
                    console.log('✅ 메뉴 버튼 연결됨');
                }
                
                // 나머지 버튼들 (베이비, 분양완료 등)
                const otherButtons = [
                    'showBabyModal',
                    'showBabyListModal', 
                    'showSoldListModal',
                    'showBulkImportModal',
                    'showMorphCalculatorModal',
                    'showFamilyTreeModal',
                    'showHealthManagementModal'
                ];
                
                otherButtons.forEach(funcName => {
                    const btn = document.querySelector(`button[onclick="${funcName}()"]`);
                    if (btn) {
                        btn.onclick = function(e) {
                            e.preventDefault();
                            console.log(`${funcName} 버튼 클릭됨`);
                            alert('해당 기능을 준비 중입니다.');
                        };
                        console.log(`✅ ${funcName} 버튼 연결됨`);
                    }
                });
                
                console.log('🎉 모든 버튼 이벤트 설정 완료');
            }, 1000);
        }

        // DOM 준비 완료 시 초기화
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🎉 DOM 준비 완료');
            
            // 모바일 터치 지원 추가
            addTouchSupport();
            
            // 통계 업데이트 함수 확인 및 실행
            const initializeStats = () => {
                if (typeof window.updateStatistics === 'function') {
                    try {
                        window.updateStatistics();
                        console.log('✅ 초기 통계 업데이트 완료');
                    } catch (error) {
                        console.warn('통계 업데이트 실패:', error.message);
                    }
                } else {
                    console.log('⏳ updateStatistics 함수 대기 중...');
                    setTimeout(initializeStats, 1000);
                }
            };
            
            // 지연 실행으로 스크립트 로드 대기
            setTimeout(initializeStats, 500);
        });
    </script>
    
    <!-- JavaScript 파일들 (순서 중요) -->
    <script src="script.js" defer></script>
    <script src="firebase-sync.js" defer></script>
    <script src="bulk-import.js" defer></script>
    <script src="user-auth.js" defer></script>
    
    <!-- 초기화 스크립트 -->
    <script>
        // 스크립트 로딩 확인
        window.addEventListener('load', function() {
            console.log('📝 스크립트 로딩 확인:');
            console.log('- showAnimalRegistrationModal:', typeof window.showAnimalRegistrationModal);
            console.log('- showAnimalListModal:', typeof window.showAnimalListModal);
            console.log('- showToast:', typeof window.showToast);
            console.log('- openModal:', typeof window.openModal);
            console.log('- closeModal:', typeof window.closeModal);
            
            // 버튼 이벤트 다시 설정
            setTimeout(() => {
                addTouchSupport();
            }, 2000);
        });
    </script>
    
    <!-- 핵심 기능 함수들 (즉시 사용 가능) -->
    <script>
        // 기본 모달 함수들
        function openModal() {
            const modalOverlay = document.getElementById('modalOverlay');
            if (modalOverlay) {
                modalOverlay.classList.remove('hidden');
                console.log('✅ 모달 열림');
            }
        }
        
        function closeModal() {
            const modalOverlay = document.getElementById('modalOverlay');
            if (modalOverlay) {
                modalOverlay.classList.add('hidden');
                console.log('✅ 모달 닫힘');
            }
        }
        
        // 토스트 알림 함수
        function showToast(message, type = 'info') {
            const colors = {
                success: 'bg-green-500 text-white',
                error: 'bg-red-500 text-white',
                warning: 'bg-yellow-500 text-black',
                info: 'bg-blue-500 text-white'
            };
            
            const toast = document.createElement('div');
            toast.className = `fixed top-4 left-4 right-4 sm:top-4 sm:right-4 sm:left-auto p-3 sm:p-4 rounded-lg shadow-lg z-50 sm:max-w-sm ${colors[type]}`;
            toast.innerHTML = `<div class="flex items-center space-x-2"><i class="fas fa-info-circle"></i><span>${message}</span></div>`;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentNode) {
                    document.body.removeChild(toast);
                }
            }, 3000);
        }
        
        // 개체 등록 모달
        function showAnimalRegistrationModal() {
            console.log('🦎 개체 등록 모달 열기');
            const modalContent = document.getElementById('modalContent');
            if (!modalContent) {
                alert('모달을 찾을 수 없습니다.');
                return;
            }
            
            modalContent.innerHTML = `
                <div class="p-4 sm:p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-lg font-bold text-gray-900">
                            <i class="fas fa-plus-circle mr-2 text-green-600"></i>개체 등록
                        </h2>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 p-2">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <form onsubmit="registerAnimal(); return false;" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">개체 이름 *</label>
                            <input type="text" id="animalName" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-base" required placeholder="예: Luna-01">
                        </div>
                        
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">성별 *</label>
                                <select id="animalGender" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-base" required>
                                    <option value="">선택하세요</option>
                                    <option value="수컷">수컷 ♂</option>
                                    <option value="암컷">암컷 ♀</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">세대 *</label>
                                <select id="animalGeneration" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-base" required>
                                    <option value="">선택하세요</option>
                                    <option value="F1">F1 (1세대)</option>
                                    <option value="F2">F2 (2세대)</option>
                                    <option value="F3">F3 (3세대)</option>
                                    <option value="F4">F4 (4세대)</option>
                                    <option value="F5">F5 (5세대)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">모프</label>
                            <input type="text" id="animalMorphSearch" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-base" placeholder="예: 노멀, 릴리화이트, 달마시안">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">이미지</label>
                            <input type="file" id="animalImage" accept="image/*" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-base">
                        </div>
                        
                        <div class="flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-3 pt-4">
                            <button type="button" onclick="closeModal()" class="px-4 py-3 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 text-base">
                                취소
                            </button>
                            <button type="submit" class="px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 text-base">
                                <i class="fas fa-plus mr-2"></i>등록하기
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            openModal();
        }
        
        // 개체 목록 모달
        function showAnimalListModal() {
            console.log('📋 개체 목록 모달 열기');
            const modalContent = document.getElementById('modalContent');
            
            modalContent.innerHTML = `
                <div class="p-4 sm:p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-lg font-bold text-gray-900">
                            <i class="fas fa-list mr-2 text-blue-600"></i>개체 목록
                        </h2>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 p-2">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="text-center py-8">
                        <i class="fas fa-dragon text-4xl text-gray-300 mb-4"></i>
                        <p class="text-gray-500 mb-2">등록된 개체가 없습니다.</p>
                        <p class="text-sm text-gray-400">개체를 등록하여 관리를 시작하세요!</p>
                    </div>
                </div>
            `;
            
            openModal();
        }
        
        // 개체 등록 처리
        function registerAnimal() {
            const name = document.getElementById('animalName').value;
            const gender = document.getElementById('animalGender').value;
            const generation = document.getElementById('animalGeneration').value;
            const morph = document.getElementById('animalMorphSearch').value;
            
            if (!name || !gender || !generation) {
                alert('필수 항목을 모두 입력해주세요.');
                return;
            }
            
            console.log('🦎 개체 등록:', { name, gender, generation, morph });
            showToast('개체가 성공적으로 등록되었습니다!', 'success');
            closeModal();
        }
        
        // 나머지 모달 함수들
        function showBabyModal() {
            showToast('베이비 등록 기능을 준비 중입니다.', 'info');
        }
        
        function showBabyListModal() {
            showToast('베이비 목록 기능을 준비 중입니다.', 'info');
        }
        
        function showSoldListModal() {
            showToast('분양 완료 목록을 준비 중입니다.', 'info');
        }
        
        function showBulkImportModal() {
            showToast('대량 가져오기 기능을 준비 중입니다.', 'info');
        }
        
        function showMorphCalculatorModal() {
            showToast('모프 계산기를 준비 중입니다.', 'info');
        }
        
        function showFamilyTreeModal() {
            showToast('혈통 트리 기능을 준비 중입니다.', 'info');
        }
        
        function showHealthManagementModal() {
            showToast('건강 관리 기능을 준비 중입니다.', 'info');
        }
        
        function manualSync() {
            showToast('수동 동기화를 실행합니다.', 'info');
        }
        
        function toggleUserMenu() {
            const userMenu = document.getElementById('userMenu');
            if (userMenu) {
                userMenu.classList.toggle('hidden');
            }
        }
        
        function changeUser() {
            showToast('사용자 변경 기능을 준비 중입니다.', 'info');
            toggleUserMenu();
        }
        
        function logout() {
            if (confirm('로그아웃하시겠습니까?')) {
                alert('로그아웃되었습니다.');
                location.reload();
            }
            toggleUserMenu();
        }
        
        console.log('✅ 모든 기본 함수 로드 완료');
    </script>
    
    <script>
        // PWA 설치 관리
        function installPWA() {
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-gray-900"><i class="fas fa-plus-circle mr-2"></i>개체 등록</h2>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <form class="space-y-4">
                        <div>
                            <label class="form-label">개체 이름 *</label>
                            <input type="text" id="animalName" class="form-input" required>
                        </div>
                        
                        <div>
                            <label class="form-label">성별 *</label>
                            <select id="animalGender" class="form-input" required>
                                <option value="">선택하세요</option>
                                <option value="수컷">수컷</option>
                                <option value="암컷">암컷</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="form-label">세대 *</label>
                            <select id="animalGeneration" class="form-input" required>
                                <option value="">선택하세요</option>
                                <option value="F1">F1</option>
                                <option value="F2">F2</option>
                                <option value="F3">F3</option>
                                <option value="F4">F4</option>
                                <option value="F5">F5</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="form-label">모프</label>
                            <div class="relative">
                                <input type="text" id="animalMorphSearch" placeholder="모프 검색 또는 선택..." 
                                       class="form-input" autocomplete="off">
                                <div id="animalMorphDropdown" class="absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto hidden">
                                    <div class="p-2 border-b border-gray-200">
                                        <div class="text-xs font-semibold text-gray-500 mb-2">인기 모프</div>
                                        <div class="grid grid-cols-2 gap-1">
                                            <button type="button" class="morph-option px-2 py-1 text-xs bg-gray-100 hover:bg-green-100 rounded" data-value="노멀">노멀</button>
                                            <button type="button" class="morph-option px-2 py-1 text-xs bg-gray-100 hover:bg-green-100 rounded" data-value="릴리화이트">릴리화이트</button>
                                            <button type="button" class="morph-option px-2 py-1 text-xs bg-gray-100 hover:bg-green-100 rounded" data-value="달마시안">달마시안</button>
                                            <button type="button" class="morph-option px-2 py-1 text-xs bg-gray-100 hover:bg-green-100 rounded" data-value="할리퀸">할리퀸</button>
                                        </div>
                                    </div>
                                    <div class="max-h-48 overflow-y-auto">
                                        <div class="morph-group">
                                            <div class="px-3 py-2 text-xs font-semibold text-gray-600 bg-gray-50">베이스 모프</div>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="노멀">노멀</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="루아">루아</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="부항">부항</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="릴리화이트">릴리화이트</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="헷아직">헷아직</button>
                                        </div>
                                        <div class="morph-group">
                                            <div class="px-3 py-2 text-xs font-semibold text-gray-600 bg-gray-50">패턴 모프</div>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="세이블">세이블</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="아잔틱">아잔틱</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="초초">초초</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="카푸치노">카푸치노</button>
                                        </div>
                                        <div class="morph-group">
                                            <div class="px-3 py-2 text-xs font-semibold text-gray-600 bg-gray-50">조합 모프</div>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="달마시안">달마시안</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="슈퍼달마시안">슈퍼달마시안</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="브링들">브링들</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="솔리드백">솔리드백</button>
                                        </div>
                                        <div class="morph-group">
                                            <div class="px-3 py-2 text-xs font-semibold text-gray-600 bg-gray-50">고급 모프</div>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="할리퀸">할리퀸</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="팬텀">팬텀</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="핀스트라이프">핀스트라이프</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="화이트잇">화이트잇</button>
                                        </div>
                                        <div class="morph-group">
                                            <div class="px-3 py-2 text-xs font-semibold text-gray-600 bg-gray-50">색상 모프</div>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="레드">레드</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="옐로우">옐로우</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="크림">크림</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="타이거">타이거</button>
                                        </div>
                                        <div class="morph-group">
                                            <div class="px-3 py-2 text-xs font-semibold text-gray-600 bg-gray-50">특수 모프</div>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="바이">바이</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="트라이">트라이</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="RCK">RCK</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-green-50" data-value="SPT">SPT</button>
                                        </div>
                                    </div>
                                </div>
                                <input type="hidden" id="animalMorph" value="">
                            </div>
                        </div>
                        
                        <div>
                            <label class="form-label">이미지</label>
                            <input type="file" id="animalImage" accept="image/*" class="form-input">
                        </div>
                        
                        <div class="flex justify-end space-x-3 pt-4">
                            <button type="button" onclick="closeModal()" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                                취소
                            </button>
                            <button type="button" onclick="registerAnimal()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                                등록
                            </button>
                        </div>
                    </form>
                </div>
            `;
            openModal();
        }

        function showAnimalListModal() {
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-gray-900"><i class="fas fa-list mr-2"></i>개체 목록</h2>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div id="animalListContainer">
                        <!-- 개체 목록이 여기에 표시됩니다 -->
                    </div>
                </div>
            `;
            openModal();
            
            // 모프 검색 기능 초기화
            setTimeout(() => {
                if (typeof initializeMorphSearch === 'function') {
                    initializeMorphSearch('animalMorphSearch', 'animalMorphDropdown', 'animalMorph');
                }
                if (typeof loadAnimalList === 'function') {
                    loadAnimalList();
                }
            }, 100);
        }

        function showBabyModal() {
            // 등록된 개체들 가져오기
            const animals = getAllAnimals();
            const maleAnimals = animals.filter(a => a.gender === '수컷' && a.status === '활성');
            const femaleAnimals = animals.filter(a => a.gender === '암컷' && a.status === '활성');
            
            let maleOptions = '<option value="">선택하세요</option>';
            maleAnimals.forEach(animal => {
                maleOptions += `<option value="${animal.name}">${animal.name} (${animal.generation}세대, ${animal.morph || 'Normal'})</option>`;
            });
            
            let femaleOptions = '<option value="">선택하세요</option>';
            femaleAnimals.forEach(animal => {
                femaleOptions += `<option value="${animal.name}">${animal.name} (${animal.generation}세대, ${animal.morph || 'Normal'})</option>`;
            });

            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-gray-900"><i class="fas fa-baby mr-2"></i>베이비 등록</h2>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="mb-4 p-3 bg-blue-50 rounded-lg">
                        <p class="text-sm text-blue-800">
                            <i class="fas fa-info-circle mr-2"></i>
                            베이비 ID는 자동으로 생성됩니다. (형식: YYMMDD-부모이니셜-순번)
                        </p>
                        <p class="text-xs text-blue-600 mt-1">
                            예시: 241215-루퍼-01 (2024년 12월 15일, 루시퍼×퍼시, 1번째)
                        </p>
                    </div>
                    
                    <form class="space-y-4">
                        <div>
                            <label class="form-label">성별 *</label>
                            <select id="babyGender" class="form-input" required>
                                <option value="">선택하세요</option>
                                <option value="미구분">미구분</option>
                                <option value="수컷">수컷</option>
                                <option value="수컷 추정">수컷 추정</option>
                                <option value="암컷">암컷</option>
                                <option value="암컷 추정">암컷 추정</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="form-label">모프</label>
                            <div class="relative">
                                <input type="text" id="babyMorphSearch" placeholder="모프 검색 또는 선택..." 
                                       class="form-input" autocomplete="off">
                                <div id="babyMorphDropdown" class="absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto hidden">
                                    <div class="p-2 border-b border-gray-200">
                                        <div class="text-xs font-semibold text-gray-500 mb-2">인기 모프</div>
                                        <div class="grid grid-cols-2 gap-1">
                                            <button type="button" class="morph-option px-2 py-1 text-xs bg-gray-100 hover:bg-pink-100 rounded" data-value="노멀">노멀</button>
                                            <button type="button" class="morph-option px-2 py-1 text-xs bg-gray-100 hover:bg-pink-100 rounded" data-value="릴리화이트">릴리화이트</button>
                                            <button type="button" class="morph-option px-2 py-1 text-xs bg-gray-100 hover:bg-pink-100 rounded" data-value="달마시안">달마시안</button>
                                            <button type="button" class="morph-option px-2 py-1 text-xs bg-gray-100 hover:bg-pink-100 rounded" data-value="할리퀸">할리퀸</button>
                                        </div>
                                    </div>
                                    <div class="max-h-48 overflow-y-auto">
                                        <div class="morph-group">
                                            <div class="px-3 py-2 text-xs font-semibold text-gray-600 bg-gray-50">베이스 모프</div>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="노멀">노멀</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="루아">루아</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="부항">부항</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="부항 밀리">부항 밀리</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="밀리 세이블">밀리 세이블</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="릴리화이트">릴리화이트</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="헷아직">헷아직</button>
                                        </div>
                                        <div class="morph-group">
                                            <div class="px-3 py-2 text-xs font-semibold text-gray-600 bg-gray-50">패턴 모프</div>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="세이블">세이블</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="아잔틱">아잔틱</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="초초">초초</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="카푸치노">카푸치노</button>
                                        </div>
                                        <div class="morph-group">
                                            <div class="px-3 py-2 text-xs font-semibold text-gray-600 bg-gray-50">조합 모프</div>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="달마시안">달마시안</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="슈퍼달마시안">슈퍼달마시안</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="브링들">브링들</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="솔리드백">솔리드백</button>
                                        </div>
                                        <div class="morph-group">
                                            <div class="px-3 py-2 text-xs font-semibold text-gray-600 bg-gray-50">고급 모프</div>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="할리퀸">할리퀸</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="팬텀">팬텀</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="핀스트라이프">핀스트라이프</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="화이트잇">화이트잇</button>
                                        </div>
                                        <div class="morph-group">
                                            <div class="px-3 py-2 text-xs font-semibold text-gray-600 bg-gray-50">색상 모프</div>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="레드">레드</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="옐로우">옐로우</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="크림">크림</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="타이거">타이거</button>
                                        </div>
                                        <div class="morph-group">
                                            <div class="px-3 py-2 text-xs font-semibold text-gray-600 bg-gray-50">특수 모프</div>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="바이">바이</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="트라이">트라이</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="RCK">RCK</button>
                                            <button type="button" class="morph-option w-full text-left px-3 py-2 text-sm hover:bg-pink-50" data-value="SPT">SPT</button>
                                        </div>
                                    </div>
                                </div>
                                <input type="hidden" id="babyMorph" value="">
                            </div>
                        </div>
                        
                        <div>
                            <label class="form-label">예상 세대 (자동 계산)</label>
                            <input type="text" id="babyGeneration" class="form-input bg-gray-50" placeholder="부모를 선택하면 자동으로 계산됩니다" readonly>
                        </div>
                        
                        <div>
                            <label class="form-label">부개체 (수컷) *</label>
                            <select id="babyParent1" class="form-input" required>
                                ${maleOptions}
                            </select>
                            ${maleAnimals.length === 0 ? '<p class="text-xs text-red-600 mt-1">등록된 수컷 개체가 없습니다. 먼저 개체를 등록해주세요.</p>' : ''}
                        </div>
                        
                        <div>
                            <label class="form-label">모개체 (암컷) *</label>
                            <select id="babyParent2" class="form-input" required>
                                ${femaleOptions}
                            </select>
                            ${femaleAnimals.length === 0 ? '<p class="text-xs text-red-600 mt-1">등록된 암컷 개체가 없습니다. 먼저 개체를 등록해주세요.</p>' : ''}
                        </div>
                        
                        <div>
                            <label class="form-label">태어난 날짜 *</label>
                            <input type="date" id="babyBirthDate" class="form-input" required>
                        </div>
                        
                        <div>
                            <label class="form-label">이미지</label>
                            <input type="file" id="babyImage" accept="image/*" class="form-input">
                        </div>
                        
                        <div class="flex justify-end space-x-3 pt-4">
                            <button type="button" onclick="closeModal()" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                                취소
                            </button>
                            <button type="button" onclick="registerBaby()" class="px-4 py-2 bg-pink-600 text-white rounded-lg hover:bg-pink-700">
                                등록
                            </button>
                        </div>
                    </form>
                </div>
            `;
            openModal();
            
            // 부모 선택 시 세대 자동 계산
            function updateBabyGeneration() {
                const parent1Name = document.getElementById('babyParent1').value;
                const parent2Name = document.getElementById('babyParent2').value;
                const generationField = document.getElementById('babyGeneration');
                
                if (parent1Name && parent2Name) {
                    const animals = getAllAnimals();
                    const parent1 = animals.find(a => a.name === parent1Name);
                    const parent2 = animals.find(a => a.name === parent2Name);
                    
                    if (parent1 && parent2) {
                        const parent1Gen = parseInt(parent1.generation.replace('F', ''));
                        const parent2Gen = parseInt(parent2.generation.replace('F', ''));
                        const maxParentGen = Math.max(parent1Gen, parent2Gen);
                        const babyGeneration = Math.min(maxParentGen + 1, 6); // 최대 F6
                        
                        generationField.value = `F${babyGeneration}`;
                        generationField.classList.remove('bg-gray-50');
                        generationField.classList.add('bg-green-50', 'text-green-800', 'font-semibold');
                    }
                } else {
                    generationField.value = '';
                    generationField.placeholder = '부모를 선택하면 자동으로 계산됩니다';
                    generationField.classList.remove('bg-green-50', 'text-green-800', 'font-semibold');
                    generationField.classList.add('bg-gray-50');
                }
            }
            
            // 이벤트 리스너 추가
            document.getElementById('babyParent1').addEventListener('change', updateBabyGeneration);
            document.getElementById('babyParent2').addEventListener('change', updateBabyGeneration);
            
            // 모프 검색 기능 초기화
            initializeMorphSearch('babyMorphSearch', 'babyMorphDropdown', 'babyMorph');
        }

        function showBabyListModal() {
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-gray-900"><i class="fas fa-heart mr-2"></i>베이비 목록</h2>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div id="babyListContainer">
                        <!-- 베이비 목록이 여기에 표시됩니다 -->
                    </div>
                </div>
            `;
            openModal();
            loadBabyList();
        }

        function showMorphCalculatorModal() {
            const animals = getAllAnimals();
            const activeAnimals = animals.filter(a => a.status === '활성');
            
            let maleOptions = '<option value="">직접 선택 또는 등록된 개체 선택</option>';
            let femaleOptions = '<option value="">직접 선택 또는 등록된 개체 선택</option>';
            
            activeAnimals.forEach(animal => {
                if (animal.gender === '수컷' && animal.morph) {
                    maleOptions += `<option value="${animal.morph}">${animal.name} (${animal.morph})</option>`;
                }
                if (animal.gender === '암컷' && animal.morph) {
                    femaleOptions += `<option value="${animal.morph}">${animal.name} (${animal.morph})</option>`;
                }
            });
            
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="p-6 max-w-4xl">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-gray-900"><i class="fas fa-calculator mr-2"></i>고급 모프 계산기</h2>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- 부모 선택 -->
                        <div class="space-y-4">
                            <div>
                                <label class="form-label">부개체 (수컷)</label>
                                <select id="fatherMorphs" onchange="updateMorphDisplay('father')" class="form-input">
                                    ${maleOptions}
                                    <optgroup label="직접 선택">
                                        <option value="노멀">노멀</option>
                                        <option value="릴리화이트">릴리화이트</option>
                                        <option value="달마시안">달마시안</option>
                                        <option value="슈퍼달마시안">슈퍼달마시안</option>
                                        <option value="할리퀸">할리퀸</option>
                                        <option value="핀스트라이프">핀스트라이프</option>
                                        <option value="팬텀">팬텀</option>
                                        <option value="세이블">세이블</option>
                                    </optgroup>
                                </select>
                                <div id="fatherMorphDisplay" class="mt-2 p-2 bg-blue-50 rounded text-sm text-blue-800 hidden">
                                    <!-- 선택된 모프 정보 표시 -->
                                </div>
                            </div>
                            
                            <div>
                                <label class="form-label">모개체 (암컷)</label>
                                <select id="motherMorphs" onchange="updateMorphDisplay('mother')" class="form-input">
                                    ${femaleOptions}
                                    <optgroup label="직접 선택">
                                        <option value="노멀">노멀</option>
                                        <option value="릴리화이트">릴리화이트</option>
                                        <option value="달마시안">달마시안</option>
                                        <option value="슈퍼달마시안">슈퍼달마시안</option>
                                        <option value="할리퀸">할리퀸</option>
                                        <option value="핀스트라이프">핀스트라이프</option>
                                        <option value="팬텀">팬텀</option>
                                        <option value="세이블">세이블</option>
                                    </optgroup>
                                </select>
                                <div id="motherMorphDisplay" class="mt-2 p-2 bg-pink-50 rounded text-sm text-pink-800 hidden">
                                    <!-- 선택된 모프 정보 표시 -->
                                </div>
                            </div>
                            
                            <button type="button" onclick="calculateAdvancedMorphs()" class="btn-primary w-full">
                                <i class="fas fa-magic mr-2"></i>고급 계산하기
                            </button>
                        </div>
                        
                        <!-- 결과 표시 -->
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">예상 결과</h3>
                            <div id="morphResults" class="space-y-3">
                                <p class="text-gray-500 text-center py-8">부모를 선택하고 계산하기를 클릭하세요</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 모프 정보 가이드 -->
                    <div class="mt-6 bg-gray-50 rounded-lg p-4">
                        <h4 class="font-semibold text-gray-800 mb-2">
                            <i class="fas fa-info-circle mr-2"></i>모프 유전 정보
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600">
                            <div>
                                <strong>우성 유전:</strong> 릴리화이트, 달마시안
                            </div>
                            <div>
                                <strong>공우성:</strong> 할리퀸, 핀스트라이프
                            </div>
                            <div>
                                <strong>열성 유전:</strong> 세이블, 루아, 부항
                            </div>
                        </div>
                    </div>
                </div>
            `;
            openModal();
        }

        function showSoldListModal() {
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-gray-900"><i class="fas fa-handshake mr-2"></i>분양 완료 목록</h2>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div id="soldListContainer">
                        <!-- 분양 완료 목록이 여기에 표시됩니다 -->
                    </div>
                </div>
            `;
            openModal();
            loadSoldList();
        }

        function showBulkImportModal() {
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="p-6 max-w-4xl">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-gray-900">
                            <i class="fas fa-file-import mr-2"></i>대량 데이터 가져오기
                        </h2>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="space-y-6">
                        <!-- 130마리 안내 -->
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                            <div class="flex items-start">
                                <i class="fas fa-exclamation-triangle text-yellow-600 mt-1 mr-3"></i>
                                <div>
                                    <h3 class="font-semibold text-yellow-800">대량 데이터 관리 모드</h3>
                                    <p class="text-sm text-yellow-700 mt-1">
                                        130마리의 도마뱀 데이터를 효율적으로 관리하기 위해 최적화된 시스템입니다.
                                        이미지는 자동으로 압축되며, 클라우드 동기화로 안전하게 보관됩니다.
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 파일 업로드 -->
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                            <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                            <h3 class="text-lg font-semibold text-gray-700 mb-2">파일 선택</h3>
                            <p class="text-sm text-gray-500 mb-4">
                                CSV, Excel, JSON 파일을 드래그하거나 클릭하여 선택하세요
                            </p>
                            <input type="file" id="bulkImportFile" accept=".csv,.xlsx,.xls,.json" 
                                   class="hidden" onchange="handleBulkImport(this)">
                            <button onclick="document.getElementById('bulkImportFile').click()" 
                                    class="btn-primary">
                                파일 선택
                            </button>
                        </div>
                        
                        <!-- 템플릿 다운로드 -->
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <h3 class="font-semibold text-blue-800 mb-2">
                                <i class="fas fa-download mr-2"></i>템플릿 다운로드
                            </h3>
                            <p class="text-sm text-blue-700 mb-3">
                                아래 템플릿을 다운로드하여 데이터를 정리한 후 업로드하세요.
                            </p>
                            <button onclick="window.bulkDataManager.downloadTemplate()" 
                                    class="btn-primary text-sm">
                                <i class="fas fa-file-csv mr-2"></i>CSV 템플릿 다운로드
                            </button>
                        </div>
                        
                        <!-- 현재 데이터 내보내기 -->
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                            <h3 class="font-semibold text-green-800 mb-2">
                                <i class="fas fa-upload mr-2"></i>현재 데이터 백업
                            </h3>
                            <p class="text-sm text-green-700 mb-3">
                                현재 등록된 모든 데이터를 JSON 파일로 백업할 수 있습니다.
                            </p>
                            <button onclick="window.bulkDataManager.exportData()" 
                                    class="btn-primary text-sm">
                                <i class="fas fa-download mr-2"></i>전체 데이터 백업
                            </button>
                        </div>
                        
                        <!-- 진행률 표시 -->
                        <div id="importProgress" class="hidden">
                            <!-- 진행률이 여기에 표시됩니다 -->
                        </div>
                        
                        <!-- 사용 가이드 -->
                        <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                            <h3 class="font-semibold text-gray-800 mb-2">
                                <i class="fas fa-info-circle mr-2"></i>사용 가이드
                            </h3>
                            <div class="text-sm text-gray-700 space-y-1">
                                <p><strong>1. CSV 형식:</strong> name,gender,generation,morph,birthDate,parent1,parent2</p>
                                <p><strong>2. 성별:</strong> 수컷, 암컷, 미구분 (또는 male, female)</p>
                                <p><strong>3. 세대:</strong> F1, F2, F3, F4, F5, F6</p>
                                <p><strong>4. 날짜:</strong> YYYY-MM-DD 형식 (예: 2024-01-15)</p>
                                <p><strong>5. 이미지:</strong> 파일 업로드 후 개별적으로 추가 가능</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            openModal();
        }

        function showFamilyTreeModal() {
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-gray-900"><i class="fas fa-sitemap mr-2"></i>혈통 트리</h2>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>

                    <div class="text-center py-8">
                        <i class="fas fa-tools text-4xl text-gray-300 mb-4"></i>
                        <p class="text-gray-500">준비 중입니다...</p>
                        <p class="text-sm text-gray-400 mt-2">곧 업데이트될 예정입니다!</p>
                    </div>
                </div>
            `;
            openModal();
        }

        function showHealthManagementModal() {
            const animals = getAllAnimals();
            const babies = getBabies();
            const allEntities = [...animals, ...babies];
            
            let entityOptions = '<option value="">개체를 선택하세요</option>';
            allEntities.forEach(entity => {
                const type = entity.status === '베이비' ? '베이비' : '성체';
                entityOptions += `<option value="${entity.id}">${entity.name} (${type})</option>`;
            });
            
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-gray-900">
                            <i class="fas fa-heartbeat mr-2"></i>건강 관리 시스템
                        </h2>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- 건강 상태 기록 -->
                        <div class="bg-green-50 rounded-lg p-4">
                            <h3 class="font-semibold text-green-800 mb-3">
                                <i class="fas fa-plus-circle mr-2"></i>건강 기록 추가
                            </h3>
                            <form class="space-y-3">
                                <select id="healthEntitySelect" class="form-input text-sm">
                                    ${entityOptions}
                                </select>
                                <select id="healthType" class="form-input text-sm">
                                    <option value="">기록 유형</option>
                                    <option value="건강검진">정기 건강검진</option>
                                    <option value="탈피">탈피 기록</option>
                                    <option value="질병">질병/치료</option>
                                    <option value="예방접종">예방접종</option>
                                    <option value="기타">기타</option>
                                </select>
                                <input type="date" id="healthDate" class="form-input text-sm">
                                <textarea id="healthNotes" placeholder="상세 내용..." class="form-input text-sm h-20 resize-none"></textarea>
                                <button type="button" onclick="saveHealthRecord()" class="btn-primary w-full text-sm">
                                    기록 저장
                                </button>
                            </form>
                        </div>
                        
                        <!-- 건강 알림 -->
                        <div class="bg-blue-50 rounded-lg p-4">
                            <h3 class="font-semibold text-blue-800 mb-3">
                                <i class="fas fa-bell mr-2"></i>건강 관리 알림
                            </h3>
                            <div class="space-y-2 text-sm" id="healthReminders">
                                <!-- 알림이 여기에 표시됩니다 -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- 최근 건강 기록 -->
                    <div class="mt-6 bg-gray-50 rounded-lg p-4">
                        <h3 class="font-semibold text-gray-800 mb-3">
                            <i class="fas fa-history mr-2"></i>최근 건강 기록
                        </h3>
                        <div id="recentHealthRecords" class="space-y-2">
                            <!-- 최근 기록이 여기에 표시됩니다 -->
                        </div>
                    </div>
                </div>
            `;
            openModal();
            
            // 오늘 날짜 설정
            document.getElementById('healthDate').value = new Date().toISOString().split('T')[0];
            
            // 건강 알림과 최근 기록 로드
            loadHealthReminders();
            loadRecentHealthRecords();
        }
        
        // 모프 검색 기능
        function initializeMorphSearch(searchInputId, dropdownId, hiddenInputId) {
            const searchInput = document.getElementById(searchInputId);
            const dropdown = document.getElementById(dropdownId);
            const hiddenInput = document.getElementById(hiddenInputId);
            
            if (!searchInput || !dropdown || !hiddenInput) return;
            
            // 검색 입력 시 필터링
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const morphOptions = dropdown.querySelectorAll('.morph-option');
                const morphGroups = dropdown.querySelectorAll('.morph-group');
                
                if (searchTerm === '') {
                    // 검색어가 없으면 모든 항목 표시
                    morphOptions.forEach(option => option.style.display = 'block');
                    morphGroups.forEach(group => group.style.display = 'block');
                } else {
                    // 검색어와 일치하는 항목만 표시
                    morphGroups.forEach(group => {
                        const groupOptions = group.querySelectorAll('.morph-option');
                        let hasVisibleOptions = false;
                        
                        groupOptions.forEach(option => {
                            const morphName = option.textContent.toLowerCase();
                            if (morphName.includes(searchTerm)) {
                                option.style.display = 'block';
                                hasVisibleOptions = true;
                            } else {
                                option.style.display = 'none';
                            }
                        });
                        
                        // 그룹에 보이는 옵션이 있으면 그룹도 표시
                        group.style.display = hasVisibleOptions ? 'block' : 'none';
                    });
                }
            });
            
            // 포커스 시 드롭다운 표시
            searchInput.addEventListener('focus', function() {
                dropdown.classList.remove('hidden');
            });
            
            // 외부 클릭 시 드롭다운 숨김
            document.addEventListener('click', function(e) {
                if (!searchInput.contains(e.target) && !dropdown.contains(e.target)) {
                    dropdown.classList.add('hidden');
                }
            });
            
            // 모프 옵션 클릭 시 선택
            dropdown.addEventListener('click', function(e) {
                if (e.target.classList.contains('morph-option')) {
                    const selectedValue = e.target.getAttribute('data-value');
                    searchInput.value = selectedValue;
                    hiddenInput.value = selectedValue;
                    dropdown.classList.add('hidden');
                }
            });
            
            // 엔터키 처리
            searchInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    const visibleOptions = dropdown.querySelectorAll('.morph-option[style*="block"], .morph-option:not([style])');
                    if (visibleOptions.length > 0) {
                        const firstOption = visibleOptions[0];
                        const selectedValue = firstOption.getAttribute('data-value');
                        searchInput.value = selectedValue;
                        hiddenInput.value = selectedValue;
                        dropdown.classList.add('hidden');
                    }
                }
                
                if (e.key === 'Escape') {
                    dropdown.classList.add('hidden');
                }
            });
        }
        
        // 수동 동기화 함수
        window.manualSync = function() {
            if (window.firebaseSync && typeof window.firebaseSync.manualSync === 'function') {
                window.firebaseSync.manualSync();
            } else {
                console.warn('동기화 시스템을 찾을 수 없습니다.');
                alert('동기화 시스템이 아직 초기화되지 않았습니다. 잠시 후 다시 시도해주세요.');
            }
        };
        
        // 사용자 메뉴 토글
        function toggleUserMenu() {
            const menu = document.getElementById('userMenu');
            menu.classList.toggle('hidden');
        }
        
        // 외부 클릭 시 메뉴 닫기
        document.addEventListener('click', function(e) {
            const menu = document.getElementById('userMenu');
            const button = e.target.closest('button[onclick*="toggleUserMenu"]');
            
            if (!button && menu && !menu.contains(e.target)) {
                menu.classList.add('hidden');
            }
        });
        
        // 대량 가져오기 처리
        window.handleBulkImport = async function(input) {
            const file = input.files[0];
            if (!file) return;
            
            try {
                const progressElement = document.getElementById('importProgress');
                if (progressElement) {
                    progressElement.classList.remove('hidden');
                }
                
                console.log('📁 파일 처리 시작:', file.name);
                
                if (window.bulkDataManager && typeof window.bulkDataManager.importFromFile === 'function') {
                    await window.bulkDataManager.importFromFile(file);
                } else {
                    throw new Error('대량 데이터 관리자를 찾을 수 없습니다.');
                }
                
                // UI 새로고침
                if (typeof window.updateStatistics === 'function') {
                    window.updateStatistics();
                }
                
                // 개체 목록이 열려있으면 새로고침
                if (document.getElementById('animalListContainer') && typeof window.loadAnimalList === 'function') {
                    window.loadAnimalList();
                }
                
            } catch (error) {
                console.error('대량 가져오기 실패:', error);
                alert('파일 처리 중 오류가 발생했습니다: ' + error.message);
                
                const progressElement = document.getElementById('importProgress');
                if (progressElement) {
                    progressElement.innerHTML = `
                        <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                            <div class="flex items-center">
                                <i class="fas fa-exclamation-circle text-red-600 mr-2"></i>
                                <span class="text-red-800 font-semibold">오류 발생</span>
                            </div>
                            <p class="text-sm text-red-700 mt-1">${error.message}</p>
                        </div>
                    `;
                }
            }
        };
    </script>
</body>
</html>