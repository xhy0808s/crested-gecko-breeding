<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¦ í¬ë ˆìŠ¤í‹°ë“œ ê²Œì½” ë¸Œë¦¬ë”© ì‹œìŠ¤í…œ</title>
    
    <!-- PWA ì„¤ì • -->
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#3b82f6">
    <link rel="icon" type="image/png" sizes="192x192" href="./icons/icon-192x192.png">
    
    <!-- ì™¸ë¶€ í°íŠ¸ ë° ì•„ì´ì½˜ -->
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        :root {
            /* í˜„ëŒ€ì ì¸ ìƒ‰ìƒ íŒ”ë ˆíŠ¸ */
            --primary: #3b82f6;
            --primary-light: #dbeafe;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-900: #111827;
            
            /* ê¸€ë˜ìŠ¤ëª¨í”¼ì¦˜ */
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --backdrop-blur: blur(20px);
            
            /* ê·¸ë¦¼ì */
            --shadow-soft: 0 4px 20px rgba(0, 0, 0, 0.05);
            --shadow-medium: 0 8px 30px rgba(0, 0, 0, 0.1);
            --shadow-strong: 0 20px 40px rgba(0, 0, 0, 0.15);
            
            /* ì• ë‹ˆë©”ì´ì…˜ */
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Pretendard Variable', Pretendard, -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, 
                rgba(59, 130, 246, 0.1) 0%, 
                rgba(168, 85, 247, 0.05) 25%,
                rgba(34, 197, 94, 0.08) 50%,
                rgba(244, 114, 182, 0.06) 75%,
                rgba(59, 130, 246, 0.1) 100%
            );
            min-height: 100vh;
            color: var(--gray-900);
            overflow-x: hidden;
        }
        
        /* ë°°ê²½ ì• ë‹ˆë©”ì´ì…˜ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(168, 85, 247, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(34, 197, 94, 0.06) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
            animation: dreamFloat 20s ease-in-out infinite;
        }
        
        @keyframes dreamFloat {
            0%, 100% { transform: scale(1) rotate(0deg); opacity: 0.8; }
            50% { transform: scale(1.1) rotate(180deg); opacity: 0.6; }
        }
        
        /* ê¸€ë˜ìŠ¤ ì¹´ë“œ */
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: var(--backdrop-blur);
            -webkit-backdrop-filter: var(--backdrop-blur);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            box-shadow: var(--shadow-soft);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .glass-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-strong);
            background: rgba(255, 255, 255, 0.95);
        }
        
        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn {
            padding: 12px 24px;
            border-radius: 15px;
            font-weight: 600;
            font-size: 14px;
            transition: var(--transition);
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, #2563eb 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: var(--backdrop-blur);
            color: var(--gray-900);
            border: 1px solid var(--glass-border);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.95);
            transform: translateY(-2px);
        }
        
        /* ëª¨ë‹¬ */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: var(--backdrop-blur);
            border-radius: 25px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-strong);
            position: relative;
        }
        
        /* ì…ë ¥ í•„ë“œ */
        .input-field {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid rgba(229, 231, 235, 0.5);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.8);
            transition: var(--transition);
            font-size: 14px;
        }
        
        .input-field:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        /* ë°˜ì‘í˜• ê·¸ë¦¬ë“œ */
        .grid {
            display: grid;
            gap: 20px;
        }
        
        .grid-2 { grid-template-columns: repeat(2, 1fr); }
        .grid-3 { grid-template-columns: repeat(3, 1fr); }
        .grid-4 { grid-template-columns: repeat(4, 1fr); }
        
        @media (max-width: 768px) {
            .grid-2, .grid-3, .grid-4 { 
                grid-template-columns: 1fr; 
            }
        }
        
        /* ìˆ¨ê¸°ê¸°/ë³´ì´ê¸° */
        .hidden { display: none !important; }
        .fade-in { animation: fadeIn 0.5s ease-out; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* í†µê³„ ì¹´ë“œ */
        .stat-card {
            text-align: center;
            padding: 24px;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary) 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #6b7280;
            font-weight: 500;
            margin-top: 8px;
        }
        
        /* ê¸°ëŠ¥ ì¹´ë“œ */
        .feature-card {
            padding: 24px;
            text-align: center;
            cursor: pointer;
            min-height: 140px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .feature-icon {
            font-size: 2.5rem;
            margin-bottom: 12px;
            background: linear-gradient(135deg, var(--primary) 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .feature-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 4px;
        }
        
        .feature-description {
            font-size: 0.85rem;
            color: #6b7280;
        }
        
        /* ì´ë¯¸ì§€ ì—…ë¡œë“œ ìŠ¤íƒ€ì¼ */
        .image-upload-area {
            border: 2px dashed #d1d5db;
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            background: rgba(249, 250, 251, 0.8);
            min-height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .image-upload-area:hover {
            border-color: #6366f1;
            background: rgba(99, 102, 241, 0.05);
        }
        
        .preview-image {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            margin-bottom: 12px;
            box-shadow: var(--shadow-soft);
            object-fit: cover;
        }
        
        .remove-image-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        
        .remove-image-btn:hover {
            background: #dc2626;
            transform: translateY(-1px);
        }
        
        /* ëª¨í”„ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .morph-btn {
            background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);
            color: #3730a3;
            border: 1px solid #c7d2fe;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 12px;
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
        }
        
        .morph-btn:hover {
            background: linear-gradient(135deg, #c7d2fe 0%, #a5b4fc 100%);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
        }
        
        .morph-btn:active {
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <!-- í—¤ë” -->
    <header class="p-6">
        <div class="max-w-7xl mx-auto">
            <div class="glass-card p-6">
                <h1 class="text-2xl font-bold text-center">
                    <span class="text-3xl mr-2">ğŸ¦</span>
                    í¬ë ˆìŠ¤í‹°ë“œ ê²Œì½” ë¸Œë¦¬ë”© ì‹œìŠ¤í…œ
                </h1>
                <p class="text-center text-gray-600 mt-2">
                    130ë§ˆë¦¬ ëŒ€ëŸ‰ ê´€ë¦¬ ì‹œìŠ¤í…œ - ì‹¤ì‹œê°„ ë™ê¸°í™” ì§€ì›
                </p>
            </div>
        </div>
    </header>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <main class="max-w-7xl mx-auto px-6 pb-12">
        <!-- í†µê³„ ì¹´ë“œ -->
        <section class="mb-8">
            <div class="grid grid-4 mb-6">
                <div class="glass-card stat-card">
                    <div class="stat-number" id="totalCount">0</div>
                    <div class="stat-label">ì´ ê°œì²´</div>
                </div>
                <div class="glass-card stat-card">
                    <div class="stat-number" id="maleCount">0</div>
                    <div class="stat-label">ìˆ˜ì»·</div>
                </div>
                <div class="glass-card stat-card">
                    <div class="stat-number" id="femaleCount">0</div>
                    <div class="stat-label">ì•”ì»·</div>
                </div>
                <div class="glass-card stat-card">
                    <div class="stat-number" id="babyCount">0</div>
                    <div class="stat-label">ë² ì´ë¹„</div>
                </div>
            </div>
        </section>

        <!-- ì£¼ìš” ê¸°ëŠ¥ -->
        <section class="mb-8">
            <h2 class="text-2xl font-bold mb-6">ğŸš€ ì£¼ìš” ê¸°ëŠ¥</h2>
            <div class="grid grid-3">
                <div class="glass-card feature-card" onclick="showAnimalRegistrationModal()">
                    <div class="feature-icon">
                        <i class="fas fa-plus-circle"></i>
                    </div>
                    <div class="feature-title">ê°œì²´ ë“±ë¡</div>
                    <div class="feature-description">ìƒˆë¡œìš´ ê²Œì½” ë“±ë¡</div>
                </div>
                
                <div class="glass-card feature-card" onclick="showAnimalListModal()">
                    <div class="feature-icon">
                        <i class="fas fa-list"></i>
                    </div>
                    <div class="feature-title">ê°œì²´ ëª©ë¡</div>
                    <div class="feature-description">ë“±ë¡ëœ ê°œì²´ ê´€ë¦¬</div>
                </div>
                
                <div class="glass-card feature-card" onclick="showBabyModal()">
                    <div class="feature-icon">
                        <i class="fas fa-baby"></i>
                    </div>
                    <div class="feature-title">ë² ì´ë¹„ ë“±ë¡</div>
                    <div class="feature-description">ìƒˆ ë² ì´ë¹„ ì¶”ê°€</div>
                </div>
                
                <div class="glass-card feature-card" onclick="showBabyListModal()">
                    <div class="feature-icon">
                        <i class="fas fa-list-alt"></i>
                    </div>
                    <div class="feature-title">ë² ì´ë¹„ ëª©ë¡</div>
                    <div class="feature-description">ë² ì´ë¹„ ê´€ë¦¬ ë° ì„±ì¥ê¸°ë¡</div>
                </div>
                
                <div class="glass-card feature-card" onclick="showPedigreeModal()">
                    <div class="feature-icon">
                        <i class="fas fa-sitemap"></i>
                    </div>
                    <div class="feature-title">ëˆ„ëŒ€ ê´€ë¦¬</div>
                    <div class="feature-description">í˜ˆí†µ ì¶”ì  ë° ê°€ê³„ë„</div>
                </div>
                
                <!-- ì„ì‹œ ë””ë²„ê¹… ë²„íŠ¼ -->
                <div class="glass-card feature-card" onclick="debugData()" style="background: linear-gradient(135deg, #fef3c7 0%, #fbbf24 100%);">
                    <div class="feature-icon">
                        <i class="fas fa-bug"></i>
                    </div>
                    <div class="feature-title">ğŸ”§ ë””ë²„ê·¸</div>
                    <div class="feature-description">ë°ì´í„° ìƒíƒœ í™•ì¸</div>
                </div>
            </div>
        </section>

        <!-- ê³ ê¸‰ ê¸°ëŠ¥ -->
        <section class="mb-8">
            <h2 class="text-2xl font-bold mb-6">âš¡ ê³ ê¸‰ ê¸°ëŠ¥</h2>
            <div class="grid grid-2">
                <div class="glass-card feature-card" onclick="showMorphCalculatorModal()">
                    <div class="feature-icon">
                        <i class="fas fa-calculator"></i>
                    </div>
                    <div class="feature-title">ëª¨í”„ ê³„ì‚°ê¸°</div>
                    <div class="feature-description">ìœ ì „ ì¡°í•© ì˜ˆì¸¡</div>
                </div>
                
                <div class="glass-card feature-card" onclick="showBulkImportModal()">
                    <div class="feature-icon">
                        <i class="fas fa-file-import"></i>
                    </div>
                    <div class="feature-title">ëŒ€ëŸ‰ ê°€ì ¸ì˜¤ê¸°</div>
                    <div class="feature-description">CSV/Excel íŒŒì¼ ê°€ì ¸ì˜¤ê¸°</div>
                </div>
            </div>
        </section>
    </main>

    <!-- ëª¨ë‹¬ -->
    <div id="modalOverlay" class="modal-overlay hidden">
        <div class="modal-content">
            <div id="modalContent">
                <!-- ëª¨ë‹¬ ë‚´ìš©ì´ ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë°ì´í„° ì €ì¥ì†Œ
        // ì „ì—­ ë³€ìˆ˜ ì´ˆê¸°í™” (ì•ˆì „í•œ ë°°ì—´ ë³´ì¥)
        let animals = [];
        let babies = [];
        
        // ì „ì—­ ë³€ìˆ˜ ë³´í˜¸ í•¨ìˆ˜
        function ensureArrays() {
            if (!Array.isArray(animals)) {
                console.warn('âš ï¸ animals ë°°ì—´ ë³µêµ¬');
                animals = [];
            }
            if (!Array.isArray(babies)) {
                console.warn('âš ï¸ babies ë°°ì—´ ë³µêµ¬');
                babies = [];
            }
        }
        
        // ì „ì—­ ì˜¤ë¥˜ í•¸ë“¤ëŸ¬ ì¶”ê°€
        window.addEventListener('error', function(event) {
            console.error('ğŸš¨ JavaScript ì˜¤ë¥˜ ë°œìƒ:', event.error);
            console.error('íŒŒì¼:', event.filename);
            console.error('ë¼ì¸:', event.lineno);
            console.error('ì»¬ëŸ¼:', event.colno);
            
            // ë°°ì—´ ë³µêµ¬ ì‹œë„
            ensureArrays();
        });
        
        window.addEventListener('unhandledrejection', function(event) {
            console.error('ğŸš¨ Promise ì˜¤ë¥˜ ë°œìƒ:', event.reason);
        });
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            try {
                ensureArrays();
                loadData();
                updateStatistics();
                console.log('ğŸ¦ í¬ë ˆìŠ¤í‹°ë“œ ê²Œì½” ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ!');
            } catch (error) {
                console.error('ğŸš¨ ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                // ì´ˆê¸°í™” ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ ìƒíƒœë¡œ
                animals = [];
                babies = [];
                updateStatistics();
            }
        });
        
        // ë°ì´í„° ë¡œë“œ
        function loadData() {
            try {
                // ì—¬ëŸ¬ í‚¤ í˜•íƒœ í˜¸í™˜ì„± í™•ë³´
                const animalKeys = ['geckoBreedingData', 'geckoAnimals'];
                const babyKeys = ['babies', 'geckoBabies'];
                
                // ë™ë¬¼ ë°ì´í„° ë¡œë“œ
                for (const key of animalKeys) {
                    const data = localStorage.getItem(key);
                    if (data) {
                        animals = JSON.parse(data);
                        break;
                    }
                }
                if (!Array.isArray(animals)) animals = [];
                
                // ë² ì´ë¹„ ë°ì´í„° ë¡œë“œ
                for (const key of babyKeys) {
                    const data = localStorage.getItem(key);
                    if (data) {
                        try {
                            babies = JSON.parse(data);
                            if (Array.isArray(babies)) break;
                        } catch (error) {
                            console.error(`ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜ (${key}):`, error);
                        }
                    }
                }
                if (!Array.isArray(babies)) babies = [];
                
                updateStatistics();
                console.log(`ğŸ“Š ë°ì´í„° ë¡œë“œ ì™„ë£Œ: ê°œì²´ ${animals.length}ë§ˆë¦¬, ë² ì´ë¹„ ${babies.length}ë§ˆë¦¬`);
                
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                animals = [];
                babies = [];
            }
        }
        
        // ë°ì´í„° ì €ì¥ (í†µí•© í‚¤ ì‚¬ìš©)
        function saveData() {
            try {
                // ë°ì´í„° ìœ íš¨ì„± ê²€ì¦
                if (!Array.isArray(animals)) {
                    console.warn('âš ï¸ animalsê°€ ë°°ì—´ì´ ì•„ë‹˜, ìˆ˜ì •ì¤‘...');
                    animals = [];
                }
                
                if (!Array.isArray(babies)) {
                    console.warn('âš ï¸ babiesê°€ ë°°ì—´ì´ ì•„ë‹˜, ìˆ˜ì •ì¤‘...');
                    babies = [];
                }
                
                // í‘œì¤€ í‚¤ë¡œ ì €ì¥
                localStorage.setItem('geckoBreedingData', JSON.stringify(animals));
                localStorage.setItem('babies', JSON.stringify(babies));
                
                // í˜¸í™˜ì„±ì„ ìœ„í•´ ê¸°ì¡´ í‚¤ë„ ìœ ì§€
                localStorage.setItem('geckoAnimals', JSON.stringify(animals));
                localStorage.setItem('geckoBabies', JSON.stringify(babies));
                
                updateStatistics();
                console.log(`ğŸ’¾ ë°ì´í„° ì €ì¥ ì™„ë£Œ - ê°œì²´: ${animals.length}ë§ˆë¦¬, ë² ì´ë¹„: ${babies.length}ë§ˆë¦¬`);
                
            } catch (error) {
                console.error('âŒ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:', error);
                
                if (error.name === 'QuotaExceededError') {
                    showToast('ì €ì¥ ê³µê°„ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. ë¶ˆí•„ìš”í•œ ë°ì´í„°ë¥¼ ì •ë¦¬í•´ì£¼ì„¸ìš”.', 'error');
                    // ìë™ ì••ì¶• ì‹œë„
                    if (window.bulkDataManager && window.bulkDataManager.compressAndSave) {
                        console.log('ğŸ—œï¸ ìë™ ë°ì´í„° ì••ì¶• ì‹œë„...');
                        window.bulkDataManager.compressAndSave();
                    }
                } else {
                    showToast('ë°ì´í„° ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
                }
            }
        }
        
        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStatistics() {
            const total = animals.length + babies.length;
            const males = animals.filter(a => a.gender === 'ìˆ˜ì»·').length;
            const females = animals.filter(a => a.gender === 'ì•”ì»·').length;
            
            document.getElementById('totalCount').textContent = total;
            document.getElementById('maleCount').textContent = males;
            document.getElementById('femaleCount').textContent = females;
            document.getElementById('babyCount').textContent = babies.length;
        }
        
        // ëª¨ë‹¬ ì—´ê¸°/ë‹«ê¸°
        function openModal() {
            const modalOverlay = document.getElementById('modalOverlay');
            if (modalOverlay) {
                modalOverlay.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            } else {
                console.error('âŒ ëª¨ë‹¬ ì˜¤ë²„ë ˆì´ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }
        
        function closeModal() {
            const modalOverlay = document.getElementById('modalOverlay');
            if (modalOverlay) {
                modalOverlay.classList.add('hidden');
                document.body.style.overflow = 'auto';
            } else {
                console.error('âŒ ëª¨ë‹¬ ì˜¤ë²„ë ˆì´ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }
        
        // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') closeModal();
        });
        
        // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ìœ¼ë¡œ ë‹«ê¸°
        document.getElementById('modalOverlay').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });
        
        // ê°œì²´ ë“±ë¡ ëª¨ë‹¬
        function showAnimalRegistrationModal() {
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold flex items-center gap-2">
                            <i class="fas fa-plus-circle text-blue-500"></i>
                            ê°œì²´ ë“±ë¡
                        </h2>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 text-2xl">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <form onsubmit="registerAnimal(event)" class="space-y-6">
                        <!-- ê¸°ë³¸ ì •ë³´ -->
                        <div class="glass-card p-6">
                            <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                                <i class="fas fa-id-card text-green-500"></i>
                                ê¸°ë³¸ ì •ë³´
                            </h3>
                            <div class="grid grid-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2 flex items-center justify-between">
                                        ê°œì²´ ì´ë¦„ *
                                        <button type="button" onclick="generateAnimalId()" class="text-xs bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 transition-colors" title="ìë™ ID ìƒì„±">
                                            <i class="fas fa-magic"></i> ìë™ìƒì„±
                                        </button>
                                    </label>
                                    <input type="text" id="animalName" class="input-field" required
                                           placeholder="ì˜ˆ: Luna-01, Dragon-23">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">ì„±ë³„ *</label>
                                    <select id="animalGender" class="input-field" required onchange="updateAnimalPreview()">
                                        <option value="">ì„±ë³„ ì„ íƒ</option>
                                        <option value="ìˆ˜ì»·">ğŸ”µ ìˆ˜ì»· (Male)</option>
                                        <option value="ì•”ì»·">ğŸ”´ ì•”ì»· (Female)</option>
                                        <option value="ë¯¸êµ¬ë¶„">âšª ë¯¸êµ¬ë¶„ (Unknown)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ìœ ì „ ì •ë³´ -->
                        <div class="glass-card p-6">
                            <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                                <i class="fas fa-dna text-blue-500"></i>
                                ìœ ì „ ì •ë³´
                            </h3>
                            <div class="grid grid-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">ì„¸ëŒ€</label>
                                    <select id="animalGeneration" class="input-field">
                                        <option value="F1">F1 - 1ì„¸ëŒ€</option>
                                        <option value="F2">F2 - 2ì„¸ëŒ€</option>
                                        <option value="F3">F3 - 3ì„¸ëŒ€</option>
                                        <option value="F4">F4 - 4ì„¸ëŒ€</option>
                                        <option value="F5+">F5+ - 5ì„¸ëŒ€ ì´ìƒ</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">ëª¨í”„ (Morph)</label>
                                    <input type="text" id="animalMorph" class="input-field"
                                           placeholder="ì˜ˆ: ë¦´ë¦¬í™”ì´íŠ¸, ë‹¬ë§ˆì‹œì•ˆ, í•˜ë¥¼í€¸..."
                                           oninput="showMorphSuggestions(this.value)"
                                           onfocus="showPopularMorphs()">
                                    
                                    <!-- ì¸ê¸° ëª¨í”„ ë¹ ë¥¸ ì„ íƒ -->
                                    <div id="popularMorphs" class="mt-2 flex flex-wrap gap-1 hidden">
                                        <button type="button" onclick="selectMorph('Normal')" class="morph-btn">Normal</button>
                                        <button type="button" onclick="selectMorph('ë¦´ë¦¬í™”ì´íŠ¸')" class="morph-btn">ë¦´ë¦¬í™”ì´íŠ¸</button>
                                        <button type="button" onclick="selectMorph('ë‹¬ë§ˆì‹œì•ˆ')" class="morph-btn">ë‹¬ë§ˆì‹œì•ˆ</button>
                                        <button type="button" onclick="selectMorph('í•˜ë¥¼í€¸')" class="morph-btn">í•˜ë¥¼í€¸</button>
                                        <button type="button" onclick="selectMorph('íŠ¸ë¼ì´ì»¬ëŸ¬')" class="morph-btn">íŠ¸ë¼ì´ì»¬ëŸ¬</button>
                                        <button type="button" onclick="selectMorph('íŒŒì´ì–´')" class="morph-btn">íŒŒì´ì–´</button>
                                        <button type="button" onclick="selectMorph('í¬ë¦¼')" class="morph-btn">í¬ë¦¼</button>
                                        <button type="button" onclick="selectMorph('ì˜¤ë Œì§€')" class="morph-btn">ì˜¤ë Œì§€</button>
                                    </div>
                                    
                                    <!-- ìë™ì™„ì„± ì œì•ˆ -->
                                    <div id="morphSuggestions" class="mt-1 bg-white border border-gray-300 rounded-lg shadow-lg hidden max-h-32 overflow-y-auto"></div>
                                </div>
                            </div>
                            <div class="grid grid-2 gap-4 mt-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">ì¶œìƒì¼</label>
                                    <input type="date" id="animalBirthDate" class="input-field" 
                                           value="${new Date().toISOString().split('T')[0]}">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">í˜„ì¬ ì²´ì¤‘ (g)</label>
                                    <input type="number" id="animalWeight" class="input-field" step="0.1"
                                           placeholder="ì˜ˆ: 45.5">
                                </div>
                            </div>
                        </div>
                        
                        <!-- ê°œì²´ ì´ë¯¸ì§€ -->
                        <div class="glass-card p-6">
                            <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                                <i class="fas fa-camera text-green-500"></i>
                                ê°œì²´ ì‚¬ì§„
                            </h3>
                            <div class="image-upload-area" onclick="document.getElementById('animalImageInput').click()">
                                <input type="file" id="animalImageInput" accept="image/*" style="display:none" onchange="previewAnimalImage(this)">
                                <div id="animalImagePreview" style="display:none">
                                    <img id="animalPreviewImg" class="preview-image">
                                    <button type="button" onclick="removeAnimalImage()" class="remove-image-btn">
                                        <i class="fas fa-trash"></i> ì´ë¯¸ì§€ ì‚­ì œ
                                    </button>
                                </div>
                                <div id="animalImageUploader">
                                    <i class="fas fa-camera text-4xl text-gray-400 mb-2"></i>
                                    <p class="text-gray-600 font-medium">ê°œì²´ ì‚¬ì§„ ì¶”ê°€</p>
                                    <p class="text-sm text-gray-500 mt-1">í´ë¦­í•˜ì—¬ ì´ë¯¸ì§€ ì„ íƒ (JPG, PNG ì§€ì›)</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ì¶”ê°€ ì •ë³´ -->
                        <div class="glass-card p-6">
                            <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                                <i class="fas fa-info-circle text-purple-500"></i>
                                ì¶”ê°€ ì •ë³´
                            </h3>
                            <div class="grid grid-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">íšë“ì¼</label>
                                    <input type="date" id="animalDate" class="input-field" 
                                           value="${new Date().toISOString().split('T')[0]}">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">ìƒíƒœ</label>
                                    <select id="animalStatus" class="input-field">
                                        <option value="í™œì„±">âœ… í™œì„± (Active)</option>
                                        <option value="íŒë§¤ë¨">ğŸ’° íŒë§¤ë¨ (Sold)</option>
                                        <option value="êµë°°ì¤‘">â¤ï¸ êµë°°ì¤‘ (Breeding)</option>
                                        <option value="ë¹„í™œì„±">â¸ï¸ ë¹„í™œì„± (Inactive)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="mt-4">
                                <label class="block text-sm font-medium mb-2">ë©”ëª¨</label>
                                <textarea id="animalNotes" class="input-field" rows="3"
                                          placeholder="ê°œì²´ì— ëŒ€í•œ íŠ¹ì´ì‚¬í•­ì´ë‚˜ ë©”ëª¨..."></textarea>
                            </div>
                        </div>
                        
                        <!-- ë²„íŠ¼ -->
                        <div class="flex gap-3">
                            <button type="button" onclick="closeModal()" class="btn btn-secondary flex-1">
                                <i class="fas fa-times"></i> ì·¨ì†Œ
                            </button>
                            <button type="submit" class="btn btn-primary flex-1">
                                <i class="fas fa-plus"></i> ê°œì²´ ë“±ë¡
                            </button>
                        </div>
                    </form>
                </div>
            `;
            openModal();
        }
        
        // ëª¨í”„ë³„ ê³ ìœ  ì˜ì–´ ì•½ì–´ ë§¤í•‘
        const morphCodes = {
            // ê¸°ë³¸ ëª¨í”„
            'Normal': 'NOR',
            'normal': 'NOR',
            'ë…¸ë©€': 'NOR',
            
            // ë¦´ë¦¬í™”ì´íŠ¸ ê³„ì—´
            'Lily White': 'LW',
            'LilyWhite': 'LW', 
            'Lilly White': 'LW',
            'ë¦´ë¦¬í™”ì´íŠ¸': 'LW',
            'ë¦´ë¦¬ í™”ì´íŠ¸': 'LW',
            
            // ë‹¬ë§ˆì‹œì•ˆ ê³„ì—´
            'Dalmatian': 'DAL',
            'dalmatian': 'DAL',
            'ë‹¬ë§ˆì‹œì•ˆ': 'DAL',
            
            // í•˜ë¥¼í€¸ ê³„ì—´
            'Harlequin': 'HAR',
            'harlequin': 'HAR',
            'í•˜ë¥¼í€¸': 'HAR',
            
            // íŠ¸ë¼ì´ì»¬ëŸ¬
            'Tri Color': 'TRI',
            'Tricolor': 'TRI',
            'Tri-Color': 'TRI',
            'íŠ¸ë¼ì´ì»¬ëŸ¬': 'TRI',
            
            // íŒŒì´ì–´
            'Fire': 'FIR',
            'fire': 'FIR',
            'íŒŒì´ì–´': 'FIR',
            
            // í¬ë¦¼
            'Cream': 'CRM',
            'cream': 'CRM',
            'í¬ë¦¼': 'CRM',
            
            // ì˜¤ë Œì§€
            'Orange': 'ORG',
            'orange': 'ORG',
            'ì˜¤ë Œì§€': 'ORG',
            
            // ë ˆë“œ
            'Red': 'RED',
            'red': 'RED',
            'ë ˆë“œ': 'RED',
            
            // ì—˜ë¡œìš°
            'Yellow': 'YEL',
            'yellow': 'YEL',
            'ì˜ë¡œìš°': 'YEL',
            'ë…¸ë‘': 'YEL',
            
            // í”Œë ˆì„
            'Flame': 'FLA',
            'flame': 'FLA',
            'í”Œë ˆì„': 'FLA',
            
            // íŒ¨í„´ë“œ
            'Patterned': 'PAT',
            'patterned': 'PAT',
            'íŒ¨í„´ë“œ': 'PAT',
            
            // ê³ ìŠ¤íŠ¸
            'Ghost': 'GHO',
            'ghost': 'GHO',
            'ê³ ìŠ¤íŠ¸': 'GHO',
            
            // ë°”ì´ì»¬ëŸ¬
            'Bi-Color': 'BIC',
            'Bicolor': 'BIC',
            'ë°”ì´ì»¬ëŸ¬': 'BIC'
        };
        
        // ëª¨í”„ ì½”ë“œ ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜
        function getMorphCode(morphInput) {
            // ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” ê²ƒë¶€í„° ì°¾ê¸°
            if (morphCodes[morphInput]) {
                return morphCodes[morphInput];
            }
            
            // ëŒ€ì†Œë¬¸ì êµ¬ë¶„ ì—†ì´ ì°¾ê¸°
            const lowerInput = morphInput.toLowerCase();
            for (const [key, value] of Object.entries(morphCodes)) {
                if (key.toLowerCase() === lowerInput) {
                    return value;
                }
            }
            
            // ë¶€ë¶„ ì¼ì¹˜ ì°¾ê¸°
            for (const [key, value] of Object.entries(morphCodes)) {
                if (key.toLowerCase().includes(lowerInput) || lowerInput.includes(key.toLowerCase())) {
                    return value;
                }
            }
            
            // ì—†ìœ¼ë©´ ì²« 3ê¸€ì ëŒ€ë¬¸ìë¡œ
            return morphInput.substring(0, 3).toUpperCase() || 'UNK';
        }
        
        // ê°œì²´ ìë™ ID ìƒì„± í•¨ìˆ˜ (ê°œì„ ë¨)
        function generateAnimalId() {
            const gender = document.getElementById('animalGender').value;
            const morphInput = document.getElementById('animalMorph').value || 'Normal';
            
            if (!gender) {
                showToast('ë¨¼ì € ì„±ë³„ì„ ì„ íƒí•´ì£¼ì„¸ìš”!', 'warning');
                return;
            }
            
            // ì„±ë³„ë³„ ì ‘ë‘ì‚¬
            const genderPrefix = {
                'ìˆ˜ì»·': 'M',
                'ì•”ì»·': 'F', 
                'ë¯¸êµ¬ë¶„': 'U'
            };
            
            // ëª¨í”„ ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
            const morphCode = getMorphCode(morphInput);
            
            // í˜„ì¬ ë‚ ì§œ
            const now = new Date();
            const year = now.getFullYear().toString().slice(-2);
            const month = (now.getMonth() + 1).toString().padStart(2, '0');
            
            // ê°™ì€ ëª¨í”„ì˜ ê¸°ì¡´ ê°œì²´ ìˆ˜ í™•ì¸
            const sameGenderMorphCount = animals.filter(a => 
                a.gender === gender && getMorphCode(a.morph || 'Normal') === morphCode
            ).length;
            const count = (sameGenderMorphCount + 1).toString().padStart(2, '0');
            
            // ìë™ ID ìƒì„±: YYMMGenderMorphCode-Count
            const genderChar = genderPrefix[gender];
            const autoId = `${year}${month}${genderChar}${morphCode}-${count}`;
            
            document.getElementById('animalName').value = autoId;
            showToast(`ëª¨í”„ "${morphInput}" â†’ ì½”ë“œ "${morphCode}"ë¡œ ID ìƒì„±!`, 'success');
        }
        
        // ê°œì²´ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateAnimalPreview() {
            // ì¶”í›„ ê°œì²´ ë¯¸ë¦¬ë³´ê¸° ê¸°ëŠ¥ì„ ìœ„í•œ í•¨ìˆ˜
            console.log('ê°œì²´ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸');
        }
        
        // ê°œì²´ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° í•¨ìˆ˜
        function previewAnimalImage(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('animalPreviewImg').src = e.target.result;
                    document.getElementById('animalImagePreview').style.display = 'block';
                    document.getElementById('animalImageUploader').style.display = 'none';
                };
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        // ê°œì²´ ì´ë¯¸ì§€ ì œê±° í•¨ìˆ˜
        function removeAnimalImage() {
            document.getElementById('animalImageInput').value = '';
            document.getElementById('animalImagePreview').style.display = 'none';
            document.getElementById('animalImageUploader').style.display = 'block';
        }
        
        // ê°œì²´ ë“±ë¡ í•¨ìˆ˜
        async function registerAnimal(event) {
            event.preventDefault();
            
            const imageInput = document.getElementById('animalImageInput');
            
            // ì´ë¯¸ì§€ ì²˜ë¦¬
            let imageData = null;
            if (imageInput.files && imageInput.files[0]) {
                try {
                    showToast('ì´ë¯¸ì§€ ì²˜ë¦¬ ì¤‘...', 'info');
                    imageData = await compressImage(imageInput.files[0]);
                } catch (error) {
                    console.error('ì´ë¯¸ì§€ ì²˜ë¦¬ ì‹¤íŒ¨:', error);
                    showToast('ì´ë¯¸ì§€ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ê³„ì† ì§„í–‰í•©ë‹ˆë‹¤.', 'warning');
                }
            }
            
            const newAnimal = {
                id: Date.now().toString(),
                name: document.getElementById('animalName').value,
                gender: document.getElementById('animalGender').value,
                generation: document.getElementById('animalGeneration').value || 'F1',
                morph: document.getElementById('animalMorph').value || 'Normal',
                birthDate: document.getElementById('animalBirthDate').value,
                weight: document.getElementById('animalWeight').value || '',
                date: document.getElementById('animalDate').value || new Date().toISOString().split('T')[0],
                status: document.getElementById('animalStatus').value || 'í™œì„±',
                notes: document.getElementById('animalNotes').value || '',
                imageData: imageData, // ê°œì²´ ì´ë¯¸ì§€ ì¶”ê°€
                createdAt: new Date().toISOString(),
                // ìë™ìœ¼ë¡œ ê±´ê°• ê¸°ë¡ ì´ˆê¸°í™”
                healthRecords: [],
                // êµë°° ì´ë ¥ ì´ˆê¸°í™”  
                breedingHistory: []
            };
            
            animals.push(newAnimal);
            saveData();
            
            // UI ì—…ë°ì´íŠ¸
            updateStatistics();
            
            // Firebase ë™ê¸°í™”
            if (window.firebaseSync && window.firebaseSync.isInitialized) {
                window.firebaseSync.saveToCloud('animals', animals);
            }
            
            closeModal();
            
            // ì„±ê³µ ë©”ì‹œì§€
            showToast(`${newAnimal.name} ê°œì²´ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');
            
            console.log('ìƒˆ ê°œì²´ ë“±ë¡:', newAnimal);
            
            // 0.5ì´ˆ í›„ ê°œì²´ ëª©ë¡ ëª¨ë‹¬ ìë™ í‘œì‹œ
            setTimeout(() => {
                showAnimalListModal();
            }, 500);
        }
        
        // ê°œì²´ ëª©ë¡ ëª¨ë‹¬
        function showAnimalListModal() {
            const modalContent = document.getElementById('modalContent');
            let listHTML = '';
            
            if (animals.length === 0) {
                listHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-search text-6xl text-gray-300 mb-4"></i>
                        <p class="text-gray-500 text-lg">ë“±ë¡ëœ ê°œì²´ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                        <button onclick="closeModal(); showAnimalRegistrationModal();" class="btn btn-primary mt-4">
                            <i class="fas fa-plus"></i> ì²« ê°œì²´ ë“±ë¡í•˜ê¸°
                        </button>
                    </div>
                `;
            } else {
                listHTML = `
                    <div class="grid gap-4">
                        ${animals.map(animal => `
                            <div class="glass-card p-4 hover:bg-white/50 transition-colors">
                                <div class="flex gap-4">
                                    <!-- ê°œì²´ ì´ë¯¸ì§€ -->
                                    <div class="flex-shrink-0">
                                        ${animal.imageData ? 
                                            `<img src="${animal.imageData}" alt="${animal.name}" class="w-20 h-20 object-cover rounded-lg border-2 border-gray-200">` :
                                            `<div class="w-20 h-20 bg-gray-100 rounded-lg border-2 border-gray-200 flex items-center justify-center">
                                                <i class="fas fa-camera text-gray-400 text-lg"></i>
                                            </div>`
                                        }
                                    </div>
                                    
                                    <!-- ê°œì²´ ì •ë³´ -->
                                    <div class="flex-1">
                                        <h4 class="font-semibold text-lg">${animal.name}</h4>
                                        <div class="text-sm text-gray-600 mt-1">
                                            <span class="mr-4">${animal.gender} â€¢ ${animal.generation}</span>
                                            <span class="text-gray-500">${animal.morph}</span>
                                        </div>
                                        <div class="text-sm text-gray-500 mt-1">
                                            ë“±ë¡ì¼: ${animal.date}
                                            ${animal.weight ? ` â€¢ ì²´ì¤‘: ${animal.weight}g` : ''}
                                        </div>
                                        ${animal.notes ? `<p class="text-sm text-gray-600 mt-1">${animal.notes}</p>` : ''}
                                    </div>
                                    
                                    <!-- ìƒíƒœ ë° ì•¡ì…˜ -->
                                    <div class="text-right flex-shrink-0">
                                        <span class="inline-block px-2 py-1 ${animal.status === 'í™œì„±' ? 'bg-green-100 text-green-800' : 
                                                                              animal.status === 'êµë°°ì¤‘' ? 'bg-pink-100 text-pink-800' : 
                                                                              animal.status === 'íŒë§¤ë¨' ? 'bg-yellow-100 text-yellow-800' : 
                                                                              'bg-gray-100 text-gray-800'} text-xs rounded-full mb-2">
                                            ${animal.status}
                                        </span>
                                        <div class="flex flex-col gap-1">
                                            <button onclick="showAnimalDetails('${animal.id}')" 
                                                    class="text-xs text-blue-600 hover:text-blue-800 px-2 py-1 rounded">
                                                ìƒì„¸ë³´ê¸°
                                            </button>
                                            <button onclick="editAnimal('${animal.id}')" 
                                                    class="text-xs text-green-600 hover:text-green-800 px-2 py-1 rounded">
                                                í¸ì§‘
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold flex items-center gap-2">
                            <i class="fas fa-list text-blue-500"></i>
                            ê°œì²´ ëª©ë¡ (${animals.length}ë§ˆë¦¬)
                        </h2>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 text-2xl">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    ${listHTML}
                </div>
            `;
            openModal();
        }
        
        // ê°œì²´ ìƒì„¸ ì •ë³´ ëª¨ë‹¬
        function showAnimalDetails(animalId) {
            const animal = animals.find(a => a.id === animalId);
            if (!animal) {
                showToast('ê°œì²´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!', 'error');
                return;
            }
            
            const modalContent = document.getElementById('modalContent');
            
            // ë‚˜ì´ ê³„ì‚°
            const birthDate = animal.birthDate || animal.date;
            const age = birthDate ? Math.floor((new Date() - new Date(birthDate)) / (1000 * 60 * 60 * 24 * 365.25)) : '?';
            const ageInDays = birthDate ? Math.floor((new Date() - new Date(birthDate)) / (1000 * 60 * 60 * 24)) : '?';
            
            // ìì† ì°¾ê¸° (ë² ì´ë¹„ ì¤‘ì—ì„œ)
            const offspring = babies.filter(baby => 
                baby.fatherId === animal.id || baby.motherId === animal.id
            );
            
            modalContent.innerHTML = `
                <div class="p-6 max-w-2xl mx-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold flex items-center gap-2">
                            ${animal.gender === 'ìˆ˜ì»·' ? '<i class="fas fa-mars text-blue-500"></i>' : 
                              animal.gender === 'ì•”ì»·' ? '<i class="fas fa-venus text-pink-500"></i>' : 
                              '<i class="fas fa-question text-gray-500"></i>'}
                            ${animal.name} ìƒì„¸ ì •ë³´
                        </h2>
                        <button onclick="showAnimalListModal()" class="text-gray-400 hover:text-gray-600 text-2xl">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <!-- ê¸°ë³¸ ì •ë³´ -->
                        <div class="glass-card p-6">
                            <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                                <i class="fas fa-info-circle text-blue-500"></i>
                                ê¸°ë³¸ ì •ë³´
                            </h3>
                            
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="font-medium">ì´ë¦„:</span>
                                    <span>${animal.name}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="font-medium">ì„±ë³„:</span>
                                    <span class="flex items-center gap-1">
                                        ${animal.gender === 'ìˆ˜ì»·' ? '<i class="fas fa-mars text-blue-500"></i>' : 
                                          animal.gender === 'ì•”ì»·' ? '<i class="fas fa-venus text-pink-500"></i>' : 
                                          '<i class="fas fa-question text-gray-500"></i>'}
                                        ${animal.gender}
                                    </span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="font-medium">ì„¸ëŒ€:</span>
                                    <span class="px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded-full">
                                        ${animal.generation || 'F1'}
                                    </span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="font-medium">ëª¨í”„:</span>
                                    <span class="font-semibold text-purple-600">${animal.morph || 'Normal'}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="font-medium">ìƒíƒœ:</span>
                                    <span class="px-2 py-1 ${animal.status === 'í™œì„±' ? 'bg-green-100 text-green-800' : 
                                                            animal.status === 'êµë°°ì¤‘' ? 'bg-pink-100 text-pink-800' : 
                                                            animal.status === 'íŒë§¤ë¨' ? 'bg-yellow-100 text-yellow-800' : 
                                                            'bg-gray-100 text-gray-800'} text-xs rounded-full">
                                        ${animal.status || 'í™œì„±'}
                                    </span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="font-medium">ì²´ì¤‘:</span>
                                    <span>${animal.weight ? animal.weight + 'g' : 'ë¯¸ê¸°ë¡'}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="font-medium">ìƒë…„ì›”ì¼:</span>
                                    <span>${birthDate || 'ë¯¸ê¸°ë¡'}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="font-medium">ë‚˜ì´:</span>
                                    <span>${age}ì„¸ (${ageInDays}ì¼)</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="font-medium">ë“±ë¡ì¼:</span>
                                    <span>${animal.createdAt ? new Date(animal.createdAt).toLocaleString() : (animal.date || 'ë¯¸ê¸°ë¡')}</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ì‚¬ì§„ -->
                        <div class="glass-card p-6">
                            <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                                <i class="fas fa-camera text-green-500"></i>
                                ì‚¬ì§„
                            </h3>
                            
                            <div class="aspect-square bg-gray-100 rounded-lg overflow-hidden">
                                ${animal.imageData ? 
                                    `<img src="${animal.imageData}" alt="${animal.name}" class="w-full h-full object-cover">` :
                                    `<div class="w-full h-full flex items-center justify-center text-gray-400">
                                        <div class="text-center">
                                            <i class="fas fa-camera text-4xl mb-2"></i>
                                            <p>ì‚¬ì§„ ì—†ìŒ</p>
                                        </div>
                                    </div>`
                                }
                            </div>
                        </div>
                        
                        <!-- ìì† ì •ë³´ -->
                        ${offspring.length > 0 ? `
                        <div class="glass-card p-6 md:col-span-2">
                            <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                                <i class="fas fa-baby text-pink-500"></i>
                                ìì† ì •ë³´ (${offspring.length}ë§ˆë¦¬)
                            </h3>
                            
                            <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-3">
                                ${offspring.map(baby => {
                                    const babyAge = Math.floor((new Date() - new Date(baby.hatchDate)) / (1000 * 60 * 60 * 24));
                                    const partner = baby.fatherId === animal.id ? 
                                        animals.find(a => a.id === baby.motherId)?.name || 'ì•Œ ìˆ˜ ì—†ìŒ' :
                                        animals.find(a => a.id === baby.fatherId)?.name || 'ì•Œ ìˆ˜ ì—†ìŒ';
                                    
                                    return `
                                        <div class="bg-white p-3 rounded-lg border">
                                            <div class="font-medium text-sm">${baby.name || baby.babyId}</div>
                                            <div class="text-xs text-gray-500 mt-1">
                                                ìƒëŒ€: ${partner}<br>
                                                í•´ì¹­: ${baby.hatchDate} (${babyAge}ì¼)<br>
                                                ì²´ì¤‘: ${baby.weight || 'ë¯¸ê¸°ë¡'}g
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                        ` : ''}
                        
                        <!-- ë©”ëª¨ -->
                        ${animal.notes ? `
                        <div class="glass-card p-6 md:col-span-2">
                            <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                                <i class="fas fa-sticky-note text-yellow-500"></i>
                                ë©”ëª¨
                            </h3>
                            <p class="text-gray-700 leading-relaxed">${animal.notes}</p>
                        </div>
                        ` : ''}
                    </div>
                    
                    <!-- ì•¡ì…˜ ë²„íŠ¼ -->
                    <div class="flex gap-3 mt-6">
                        <button onclick="showAnimalListModal()" class="btn btn-secondary flex-1">
                            <i class="fas fa-arrow-left"></i> ëª©ë¡ìœ¼ë¡œ
                        </button>
                        <button onclick="editAnimal('${animal.id}')" class="btn btn-primary flex-1">
                            <i class="fas fa-edit"></i> í¸ì§‘
                        </button>
                    </div>
                </div>
            `;
        }
        
        // ë² ì´ë¹„ ìƒì„¸ ì •ë³´ ëª¨ë‹¬
        function showBabyDetails(babyId) {
            const baby = babies.find(b => b.id === babyId);
            if (!baby) {
                showToast('ë² ì´ë¹„ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!', 'error');
                return;
            }
            
            const modalContent = document.getElementById('modalContent');
            
            // ë¶€ëª¨ ì •ë³´ ì°¾ê¸°
            const father = animals.find(a => a.id === baby.fatherId);
            const mother = animals.find(a => a.id === baby.motherId);
            
            // ë‚˜ì´ ê³„ì‚°
            const age = Math.floor((new Date() - new Date(baby.hatchDate)) / (1000 * 60 * 60 * 24));
            const weeks = Math.floor(age / 7);
            
            // ìµœì‹  ì²´ì¤‘ ì°¾ê¸°
            let currentWeight = baby.weight || 0;
            if (baby.growthRecords && baby.growthRecords.length > 0) {
                const latestRecord = baby.growthRecords
                    .filter(r => r.weight && parseFloat(r.weight) > 0)
                    .sort((a, b) => new Date(b.date) - new Date(a.date))[0];
                if (latestRecord) currentWeight = latestRecord.weight;
            }
            
            modalContent.innerHTML = `
                <div class="p-6 max-w-2xl mx-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold flex items-center gap-2">
                            <i class="fas fa-baby text-pink-500"></i>
                            ${baby.name || baby.babyId} ìƒì„¸ ì •ë³´
                        </h2>
                        <button onclick="showBabyListModal()" class="text-gray-400 hover:text-gray-600 text-2xl">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <!-- ê¸°ë³¸ ì •ë³´ -->
                        <div class="glass-card p-6">
                            <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                                <i class="fas fa-info-circle text-blue-500"></i>
                                ê¸°ë³¸ ì •ë³´
                            </h3>
                            
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="font-medium">ì´ë¦„:</span>
                                    <span>${baby.name || baby.babyId}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="font-medium">ê³ ìœ  ID:</span>
                                    <span class="text-xs text-gray-500">${baby.babyId}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="font-medium">ì„±ë³„:</span>
                                    <div class="flex items-center gap-2">
                                        <span class="flex items-center gap-1">
                                            ${baby.gender === 'ìˆ˜ì»·' ? '<i class="fas fa-mars text-blue-500"></i> ìˆ˜ì»·' : 
                                              baby.gender === 'ì•”ì»·' ? '<i class="fas fa-venus text-pink-500"></i> ì•”ì»·' : 
                                              '<i class="fas fa-question text-gray-500"></i> ë¯¸êµ¬ë¶„'}
                                        </span>
                                        <button onclick="updateBabyGender('${baby.id}')" class="text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200">
                                            ë³€ê²½
                                        </button>
                                    </div>
                                </div>
                                <div class="flex justify-between">
                                    <span class="font-medium">ëª¨í”„:</span>
                                    <span class="font-semibold text-purple-600">${baby.morph || 'TBD'}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="font-medium">ìƒíƒœ:</span>
                                    <div class="flex items-center gap-2">
                                        <span class="px-2 py-1 ${baby.status === 'ë² ì´ë¹„' ? 'bg-pink-100 text-pink-800' : 
                                                                baby.status === 'ë¶„ì–‘ë¨' ? 'bg-green-100 text-green-800' : 
                                                                baby.status === 'íì‚¬' ? 'bg-red-100 text-red-800' : 
                                                                'bg-gray-100 text-gray-800'} text-xs rounded-full">
                                            ${baby.status || 'ë² ì´ë¹„'}
                                        </span>
                                        <button onclick="updateBabyStatus('${baby.id}')" class="text-xs px-2 py-1 bg-orange-100 text-orange-700 rounded hover:bg-orange-200">
                                            ë³€ê²½
                                        </button>
                                    </div>
                                </div>
                                <div class="flex justify-between">
                                    <span class="font-medium">í˜„ì¬ ì²´ì¤‘:</span>
                                    <span class="font-semibold">${currentWeight}g</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="font-medium">í•´ì¹­ì¼:</span>
                                    <span>ğŸ¥š ${baby.hatchDate}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="font-medium">ë‚˜ì´:</span>
                                    <span>${age}ì¼ (${weeks}ì£¼)</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ì‚¬ì§„ -->
                        <div class="glass-card p-6">
                            <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                                <i class="fas fa-camera text-green-500"></i>
                                ì‚¬ì§„
                            </h3>
                            
                            <div class="aspect-square bg-gray-100 rounded-lg overflow-hidden">
                                ${baby.imageData ? 
                                    `<img src="${baby.imageData}" alt="${baby.name || baby.babyId}" class="w-full h-full object-cover">` :
                                    `<div class="w-full h-full flex items-center justify-center text-gray-400">
                                        <div class="text-center">
                                            <i class="fas fa-camera text-4xl mb-2"></i>
                                            <p>ì‚¬ì§„ ì—†ìŒ</p>
                                        </div>
                                    </div>`
                                }
                            </div>
                        </div>
                        
                        <!-- ë¶€ëª¨ ì •ë³´ -->
                        <div class="glass-card p-6 md:col-span-2">
                            <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                                <i class="fas fa-users text-purple-500"></i>
                                ë¶€ëª¨ ì •ë³´
                            </h3>
                            
                            <div class="grid sm:grid-cols-2 gap-4">
                                <div class="bg-blue-50 p-4 rounded-lg">
                                    <h4 class="font-medium flex items-center gap-2 mb-2">
                                        <i class="fas fa-mars text-blue-500"></i>
                                        ì•„ë²„ì§€
                                    </h4>
                                    <p class="font-semibold">${father ? father.name : 'ì•Œ ìˆ˜ ì—†ìŒ'}</p>
                                    ${father ? `<p class="text-sm text-gray-600">${father.morph || 'Normal'} â€¢ ${father.generation || 'F1'}</p>` : ''}
                                </div>
                                <div class="bg-pink-50 p-4 rounded-lg">
                                    <h4 class="font-medium flex items-center gap-2 mb-2">
                                        <i class="fas fa-venus text-pink-500"></i>
                                        ì–´ë¨¸ë‹ˆ
                                    </h4>
                                    <p class="font-semibold">${mother ? mother.name : 'ì•Œ ìˆ˜ ì—†ìŒ'}</p>
                                    ${mother ? `<p class="text-sm text-gray-600">${mother.morph || 'Normal'} â€¢ ${mother.generation || 'F1'}</p>` : ''}
                                </div>
                            </div>
                        </div>
                        
                        <!-- ì„±ì¥ ê¸°ë¡ ìš”ì•½ -->
                        ${baby.growthRecords && baby.growthRecords.length > 0 ? `
                        <div class="glass-card p-6 md:col-span-2">
                            <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                                <i class="fas fa-chart-line text-green-500"></i>
                                ì„±ì¥ ê¸°ë¡ (${baby.growthRecords.length}ê°œ)
                            </h3>
                            
                            <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-3">
                                ${baby.growthRecords
                                    .sort((a, b) => new Date(b.date) - new Date(a.date))
                                    .slice(0, 6)
                                    .map(record => `
                                        <div class="bg-white p-3 rounded-lg border">
                                            <div class="font-medium text-sm">${record.milestone || 'ê¸°ë¡'}</div>
                                            <div class="text-xs text-gray-500 mt-1">
                                                ë‚ ì§œ: ${record.date}<br>
                                                ì²´ì¤‘: ${record.weight || 'ë¯¸ê¸°ë¡'}g
                                                ${record.notes ? `<br>ë©”ëª¨: ${record.notes.substring(0, 30)}${record.notes.length > 30 ? '...' : ''}` : ''}
                                            </div>
                                        </div>
                                    `).join('')}
                            </div>
                        </div>
                        ` : ''}
                        
                        <!-- ë©”ëª¨ -->
                        ${baby.notes ? `
                        <div class="glass-card p-6 md:col-span-2">
                            <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                                <i class="fas fa-sticky-note text-yellow-500"></i>
                                ë©”ëª¨
                            </h3>
                            <p class="text-gray-700 leading-relaxed">${baby.notes}</p>
                        </div>
                        ` : ''}
                    </div>
                    
                    <!-- ì•¡ì…˜ ë²„íŠ¼ -->
                    <div class="flex gap-3 mt-6">
                        <button onclick="showBabyListModal()" class="btn btn-secondary flex-1">
                            <i class="fas fa-arrow-left"></i> ëª©ë¡ìœ¼ë¡œ
                        </button>
                        <button onclick="showBabyGrowthModal('${baby.id}')" class="btn btn-success flex-1">
                            <i class="fas fa-chart-line"></i> ì„±ì¥ê¸°ë¡
                        </button>
                        <button onclick="promoteToF2('${baby.id}')" class="btn btn-primary flex-1">
                            <i class="fas fa-arrow-up"></i> F2 ìŠ¹ê²©
                        </button>
                    </div>
                </div>
            `;
        }
        
        // ë² ì´ë¹„ ì„±ë³„ ë³€ê²½
        function updateBabyGender(babyId) {
            const baby = babies.find(b => b.id === babyId);
            if (!baby) return;
            
            const currentGender = baby.gender || 'ë¯¸êµ¬ë¶„';
            const genderOptions = ['ë¯¸êµ¬ë¶„', 'ìˆ˜ì»·', 'ì•”ì»·'];
            const currentIndex = genderOptions.indexOf(currentGender);
            
            const newGender = genderOptions[(currentIndex + 1) % genderOptions.length];
            
            if (confirm(`${baby.name || baby.babyId}ì˜ ì„±ë³„ì„ "${newGender}"ë¡œ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                baby.gender = newGender;
                baby.updatedAt = new Date().toISOString();
                
                saveData();
                showBabyDetails(babyId); // ëª¨ë‹¬ ìƒˆë¡œê³ ì¹¨
                showToast(`ì„±ë³„ì´ "${newGender}"ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
            }
        }
        
        // ë² ì´ë¹„ ìƒíƒœ ë³€ê²½
        function updateBabyStatus(babyId) {
            const baby = babies.find(b => b.id === babyId);
            if (!baby) return;
            
            const statusOptions = [
                { value: 'ë² ì´ë¹„', label: 'ë² ì´ë¹„', color: 'bg-pink-100 text-pink-800' },
                { value: 'ë¶„ì–‘ë¨', label: 'ë¶„ì–‘ë¨', color: 'bg-green-100 text-green-800' },
                { value: 'íì‚¬', label: 'íì‚¬', color: 'bg-red-100 text-red-800' }
            ];
            
            const optionsHTML = statusOptions.map(option => 
                `<button onclick="setBabyStatus('${babyId}', '${option.value}')" 
                         class="w-full px-4 py-2 text-left hover:bg-gray-50 ${option.color} mb-1 rounded">
                    ${option.label}
                </button>`
            ).join('');
            
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="p-6 max-w-md mx-auto">
                    <h3 class="text-lg font-semibold mb-4">ìƒíƒœ ë³€ê²½</h3>
                    <p class="text-gray-600 mb-4">${baby.name || baby.babyId}ì˜ ìƒíƒœë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”:</p>
                    <div class="space-y-2">
                        ${optionsHTML}
                    </div>
                    <button onclick="showBabyDetails('${babyId}')" class="btn btn-secondary w-full mt-4">
                        ì·¨ì†Œ
                    </button>
                </div>
            `;
        }
        
        // ë² ì´ë¹„ ìƒíƒœ ì„¤ì •
        function setBabyStatus(babyId, newStatus) {
            const baby = babies.find(b => b.id === babyId);
            if (!baby) return;
            
            baby.status = newStatus;
            baby.updatedAt = new Date().toISOString();
            
            // íì‚¬ ì‹œ ì¶”ê°€ ì •ë³´
            if (newStatus === 'íì‚¬') {
                const deathDate = prompt('íì‚¬ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš” (YYYY-MM-DD í˜•ì‹):');
                if (deathDate) {
                    baby.deathDate = deathDate;
                }
                const cause = prompt('íì‚¬ ì›ì¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš” (ì„ íƒì‚¬í•­):');
                if (cause) {
                    baby.notes = (baby.notes || '') + `\\níì‚¬ ì›ì¸: ${cause}`;
                }
            }
            
            // ë¶„ì–‘ ì‹œ ì¶”ê°€ ì •ë³´
            if (newStatus === 'ë¶„ì–‘ë¨') {
                const adoptionDate = prompt('ë¶„ì–‘ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš” (YYYY-MM-DD í˜•ì‹):');
                if (adoptionDate) {
                    baby.adoptionDate = adoptionDate;
                }
            }
            
            saveData();
            showBabyDetails(babyId);
            showToast(`ìƒíƒœê°€ "${newStatus}"ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
        }
        
        // ë² ì´ë¹„ ë“±ë¡ ëª¨ë‹¬
        function showBabyModal() {
            const modalContent = document.getElementById('modalContent');
            
            // ë¶€ëª¨ ê°œì²´ ëª©ë¡ (ì„±ì²´ë§Œ)
            const maleAnimals = animals.filter(a => a.gender === 'ìˆ˜ì»·' && a.status === 'í™œì„±');
            const femaleAnimals = animals.filter(a => a.gender === 'ì•”ì»·' && a.status === 'í™œì„±');
            
            let maleOptions = '<option value="">ğŸ”µ ë¶€ê°œì²´ ì„ íƒ (ìˆ˜ì»·)</option>';
            maleAnimals.forEach(animal => {
                const birthYear = animal.birthDate ? new Date(animal.birthDate).getFullYear() : (animal.date ? new Date(animal.date).getFullYear() : '?');
                const age = animal.birthDate ? Math.floor((new Date() - new Date(animal.birthDate)) / (1000 * 60 * 60 * 24 * 365.25)) : '?';
                maleOptions += `<option value="${animal.id}">ğŸ”µ ${animal.name} | ${animal.morph || 'Normal'} | ${birthYear}ë…„ìƒ (${age}ì„¸) ${animal.generation ? `| ${animal.generation}` : ''}</option>`;
            });
            
            let femaleOptions = '<option value="">ğŸ”´ ëª¨ê°œì²´ ì„ íƒ (ì•”ì»·)</option>';
            femaleAnimals.forEach(animal => {
                const birthYear = animal.birthDate ? new Date(animal.birthDate).getFullYear() : (animal.date ? new Date(animal.date).getFullYear() : '?');
                const age = animal.birthDate ? Math.floor((new Date() - new Date(animal.birthDate)) / (1000 * 60 * 60 * 24 * 365.25)) : '?';
                femaleOptions += `<option value="${animal.id}">ğŸ”´ ${animal.name} | ${animal.morph || 'Normal'} | ${birthYear}ë…„ìƒ (${age}ì„¸) ${animal.generation ? `| ${animal.generation}` : ''}</option>`;
            });
            
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold flex items-center gap-2">
                            <i class="fas fa-baby text-pink-500"></i>
                            ë² ì´ë¹„ ë“±ë¡
                        </h2>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 text-2xl">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <form onsubmit="registerBaby(event)" class="space-y-6">
                        <!-- ë¶€ëª¨ ì •ë³´ -->
                        <div class="glass-card p-6">
                            <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                                <i class="fas fa-users text-pink-500"></i>
                                ë¶€ëª¨ ì •ë³´ ì„ íƒ
                            </h3>
                            
                            <!-- ë¶€ê°œì²´ ì„ íƒ -->
                            <div class="mb-4">
                                <label class="block text-sm font-medium mb-2">ğŸ”µ ë¶€ê°œì²´ (ìˆ˜ì»·) *</label>
                                <select id="babyFather" class="input-field" required onchange="updateParentPreview('father')">
                                    ${maleOptions}
                                </select>
                                <div id="fatherPreview" class="mt-2 p-3 bg-blue-50 rounded-lg hidden">
                                    <div class="flex items-center gap-3">
                                        <div id="fatherImage" class="w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center">
                                            <i class="fas fa-male text-blue-500"></i>
                                        </div>
                                        <div id="fatherInfo" class="text-sm"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ëª¨ê°œì²´ ì„ íƒ -->
                            <div class="mb-4">
                                <label class="block text-sm font-medium mb-2">ğŸ”´ ëª¨ê°œì²´ (ì•”ì»·) *</label>
                                <select id="babyMother" class="input-field" required onchange="updateParentPreview('mother')">
                                    ${femaleOptions}
                                </select>
                                <div id="motherPreview" class="mt-2 p-3 bg-pink-50 rounded-lg hidden">
                                    <div class="flex items-center gap-3">
                                        <div id="motherImage" class="w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center">
                                            <i class="fas fa-female text-pink-500"></i>
                                        </div>
                                        <div id="motherInfo" class="text-sm"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ì˜ˆìƒ ëª¨í”„ -->
                            <div id="expectedMorphPreview" class="mt-4 p-3 bg-purple-50 rounded-lg hidden">
                                <div class="flex items-center gap-2">
                                    <i class="fas fa-dna text-purple-500"></i>
                                    <span class="text-sm font-medium">ì˜ˆìƒ ë² ì´ë¹„ ëª¨í”„:</span>
                                    <span id="expectedMorph" class="text-purple-700 font-semibold"></span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ë² ì´ë¹„ ì •ë³´ -->
                        <div class="glass-card p-6">
                            <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                                <i class="fas fa-egg text-yellow-500"></i>
                                ë² ì´ë¹„ ì •ë³´
                            </h3>
                            
                            <!-- ì•Œ ì„ íƒ (1ê°œ ë˜ëŠ” 2ê°œ) -->
                            <div class="mb-4">
                                <label class="block text-sm font-medium mb-2">ì´ë²ˆ ì‚°ë€ ì•Œ ê°œìˆ˜ *</label>
                                <div class="flex gap-3">
                                    <label class="flex items-center cursor-pointer">
                                        <input type="radio" name="eggCount" value="1" checked onchange="updateEggFields()">
                                        <span class="ml-2">ğŸ¥š 1ê°œ</span>
                                    </label>
                                    <label class="flex items-center cursor-pointer">
                                        <input type="radio" name="eggCount" value="2" onchange="updateEggFields()">
                                        <span class="ml-2">ğŸ¥šğŸ¥š 2ê°œ</span>
                                    </label>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">í¬ë ˆìŠ¤í‹°ë“œ ê²Œì½”ëŠ” íšŒì°¨ë‹¹ 1-2ê°œ ì•Œì„ ë‚³ìŠµë‹ˆë‹¤</p>
                            </div>
                            
                            <div class="grid grid-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">í•´ì¹­ì¼ *</label>
                                    <input type="date" id="babyHatchDate" class="input-field" required onchange="updateBabyIds()">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">ì˜ˆìƒ ëª¨í”„</label>
                                    <input type="text" id="babyMorph" class="input-field" readonly
                                           placeholder="ë¶€ëª¨ ëª¨í”„ ê¸°ë°˜ ìë™ ì¶”ì •">
                                </div>
                            </div>
                            
                            <!-- ë² ì´ë¹„ 1 ì •ë³´ -->
                            <div id="baby1Info" class="mt-6 p-4 bg-blue-50 rounded-lg">
                                <h4 class="font-medium mb-3 flex items-center gap-2">
                                    <span class="w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-xs">1</span>
                                    ì²« ë²ˆì§¸ ë² ì´ë¹„
                                </h4>
                                <div class="grid grid-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium mb-2">ë² ì´ë¹„ ê³ ìœ  ID (ìë™ ìƒì„±)</label>
                                        <input type="text" id="baby1Name" class="input-field bg-gray-100" readonly
                                               placeholder="ë¶€ëª¨ì´ë‹ˆì…œ-ë²ˆí˜¸">
                                        <p class="text-xs text-gray-500 mt-1">ë¶€ëª¨ ì„ íƒ ì‹œ ì—°ì† ë²ˆí˜¸ë¡œ ìë™ ìƒì„±ë©ë‹ˆë‹¤</p>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-2">ì´ˆê¸° ì²´ì¤‘ (g)</label>
                                        <input type="number" id="baby1Weight" class="input-field" 
                                               step="0.1" placeholder="1.5">
                                    </div>
                                </div>
                                
                                <!-- ë² ì´ë¹„ 1 ì‚¬ì§„ -->
                                <div class="mt-4">
                                    <label class="block text-sm font-medium mb-2">ë² ì´ë¹„ ì‚¬ì§„</label>
                                    <div class="image-upload-area" onclick="document.getElementById('baby1ImageInput').click()">
                                        <input type="file" id="baby1ImageInput" accept="image/*" style="display:none" onchange="previewBabyIndividualImage(this, 1)">
                                        <div id="baby1ImagePreview" style="display:none">
                                            <img id="baby1PreviewImg" class="preview-image">
                                            <button type="button" onclick="removeBabyIndividualImage(1)" class="remove-image-btn">
                                                <i class="fas fa-trash"></i> ì‚­ì œ
                                            </button>
                                        </div>
                                        <div id="baby1ImageUploader">
                                            <i class="fas fa-camera text-2xl text-gray-400 mb-1"></i>
                                            <p class="text-gray-600 text-sm">ì‚¬ì§„ ì¶”ê°€</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ë² ì´ë¹„ 2 ì •ë³´ (ê¸°ë³¸ ìˆ¨ê¹€) -->
                            <div id="baby2Info" class="mt-4 p-4 bg-pink-50 rounded-lg hidden">
                                <h4 class="font-medium mb-3 flex items-center gap-2">
                                    <span class="w-6 h-6 bg-pink-500 text-white rounded-full flex items-center justify-center text-xs">2</span>
                                    ë‘ ë²ˆì§¸ ë² ì´ë¹„
                                </h4>
                                <div class="grid grid-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium mb-2">ë² ì´ë¹„ ê³ ìœ  ID (ìë™ ìƒì„±)</label>
                                        <input type="text" id="baby2Name" class="input-field bg-gray-100" readonly
                                               placeholder="ë¶€ëª¨ì´ë‹ˆì…œ-ë²ˆí˜¸">
                                        <p class="text-xs text-gray-500 mt-1">ë¶€ëª¨ ì„ íƒ ì‹œ ì—°ì† ë²ˆí˜¸ë¡œ ìë™ ìƒì„±ë©ë‹ˆë‹¤</p>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-2">ì´ˆê¸° ì²´ì¤‘ (g)</label>
                                        <input type="number" id="baby2Weight" class="input-field" 
                                               step="0.1" placeholder="1.3">
                                    </div>
                                </div>
                                
                                <!-- ë² ì´ë¹„ 2 ì‚¬ì§„ -->
                                <div class="mt-4">
                                    <label class="block text-sm font-medium mb-2">ë² ì´ë¹„ ì‚¬ì§„</label>
                                    <div class="image-upload-area" onclick="document.getElementById('baby2ImageInput').click()">
                                        <input type="file" id="baby2ImageInput" accept="image/*" style="display:none" onchange="previewBabyIndividualImage(this, 2)">
                                        <div id="baby2ImagePreview" style="display:none">
                                            <img id="baby2PreviewImg" class="preview-image">
                                            <button type="button" onclick="removeBabyIndividualImage(2)" class="remove-image-btn">
                                                <i class="fas fa-trash"></i> ì‚­ì œ
                                            </button>
                                        </div>
                                        <div id="baby2ImageUploader">
                                            <i class="fas fa-camera text-2xl text-gray-400 mb-1"></i>
                                            <p class="text-gray-600 text-sm">ì‚¬ì§„ ì¶”ê°€</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        
                        <!-- ì¶”ê°€ ì •ë³´ -->
                        <div class="glass-card p-6">
                            <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                                <i class="fas fa-clipboard text-blue-500"></i>
                                ì¶”ê°€ ì •ë³´
                            </h3>
                            <div>
                                <label class="block text-sm font-medium mb-2">ë©”ëª¨</label>
                                <textarea id="babyNotes" class="input-field" rows="3"
                                          placeholder="í•´ì¹­ ìƒíƒœ, íŠ¹ì´ì‚¬í•­ ë“±..."></textarea>
                            </div>
                        </div>
                        
                        <!-- ë²„íŠ¼ -->
                        <div class="flex gap-3">
                            <button type="button" onclick="closeModal()" class="btn btn-secondary flex-1">
                                <i class="fas fa-times"></i> ì·¨ì†Œ
                            </button>
                            <button type="submit" class="btn btn-primary flex-1">
                                <i class="fas fa-baby"></i> ë² ì´ë¹„ ë“±ë¡
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            // í˜„ì¬ ë‚ ì§œë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •
            document.getElementById('babyHatchDate').value = new Date().toISOString().split('T')[0];
            
            openModal();
            
            // ëª¨ë‹¬ ì—´ë¦° í›„ ì´ˆê¸° ë² ì´ë¹„ ID ìƒì„±
            setTimeout(() => {
                updateBabyIds();
            }, 200);
        }
        
        // ë² ì´ë¹„ íšŒì°¨ë³„ ID ìë™ ìƒì„± í•¨ìˆ˜
        function generateBabyAutoId(fatherName, motherName, index) {
            if (!fatherName || !motherName) {
                return `??-${(index + 1).toString().padStart(2, '0')}`;
            }
            
            // ë¶€ëª¨ ì´ë¦„ì˜ ì²« ê¸€ì ì¶”ì¶œ (í•œê¸€/ì˜ë¬¸ ëª¨ë‘ ì§€ì›)
            const fatherInitial = fatherName.charAt(0);
            const motherInitial = motherName.charAt(0);
            
            // ê°™ì€ ë¶€ëª¨ ì¡°í•©ì˜ ê¸°ì¡´ ë² ì´ë¹„ ìˆ˜ í™•ì¸
            const parentPair = `${fatherInitial}${motherInitial}`;
            const existingBabies = babies.filter(baby => 
                baby.name && baby.name.startsWith(parentPair + '-')
            );
            
            const nextNumber = existingBabies.length + index + 1;
            const candidateId = `${parentPair}-${nextNumber.toString().padStart(2, '0')}`;
            
            // ì¤‘ë³µ í™•ì¸ ë° ì¡°ì •
            let finalNumber = nextNumber;
            let finalId = candidateId;
            
            while (babies.some(baby => baby.name === finalId || baby.babyId === finalId)) {
                finalNumber++;
                finalId = `${parentPair}-${finalNumber.toString().padStart(2, '0')}`;
            }
            
            return finalId;
        }
        
        // ë² ì´ë¹„ ID ìë™ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateBabyIds() {
            const fatherId = document.getElementById('babyFather').value;
            const motherId = document.getElementById('babyMother').value;
            const eggCount = parseInt(document.querySelector('input[name="eggCount"]:checked').value);
            
            let father = null, mother = null;
            if (fatherId && motherId) {
                father = animals.find(a => a.id === fatherId);
                mother = animals.find(a => a.id === motherId);
            }
            
            // ê° ë² ì´ë¹„ ID ìƒì„±
            for (let i = 0; i < eggCount; i++) {
                const babyNameField = document.getElementById(`baby${i+1}Name`);
                if (babyNameField) {
                    const autoId = generateBabyAutoId(
                        father ? father.name : '',
                        mother ? mother.name : '',
                        i
                    );
                    babyNameField.value = autoId;
                }
            }
        }
        
        // ì•Œ ê°œìˆ˜ ì„ íƒì— ë”°ë¥¸ UI ì—…ë°ì´íŠ¸
        function updateEggFields() {
            const eggCount = document.querySelector('input[name="eggCount"]:checked').value;
            const baby2Info = document.getElementById('baby2Info');
            const baby2Name = document.getElementById('baby2Name');
            
            if (eggCount === '2') {
                baby2Info.classList.remove('hidden');
                baby2Name.required = true;
            } else {
                baby2Info.classList.add('hidden');
                baby2Name.required = false;
                baby2Name.value = '';
                document.getElementById('baby2Weight').value = '';
                // ë² ì´ë¹„ 2 ì´ë¯¸ì§€ë„ ì´ˆê¸°í™”
                removeBabyIndividualImage(2);
            }
            
            // ë² ì´ë¹„ ID ì—…ë°ì´íŠ¸
            setTimeout(updateBabyIds, 100);
        }
        
        // ë² ì´ë¹„ ë“±ë¡ í•¨ìˆ˜ (ê°œì„ )
        async function registerBaby(event) {
            event.preventDefault();
            
            // ë°°ì—´ ì•ˆì „ì„± í™•ë³´
            ensureArrays();
            
            const fatherId = document.getElementById('babyFather').value;
            const motherId = document.getElementById('babyMother').value;
            const eggCount = parseInt(document.querySelector('input[name="eggCount"]:checked').value);
            
            // ë¶€ëª¨ ê²€ì¦
            if (!fatherId || !motherId) {
                showToast('ë¶€ëª¨ ê°œì²´ë¥¼ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”!', 'error');
                console.log('âŒ ë¶€ëª¨ ì„ íƒ ì˜¤ë¥˜ - fatherId:', fatherId, 'motherId:', motherId);
                return;
            }
            
            const father = animals.find(a => a.id === fatherId);
            const mother = animals.find(a => a.id === motherId);
            
            if (!father || !mother) {
                showToast('ì„ íƒí•œ ë¶€ëª¨ ê°œì²´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!', 'error');
                console.log('âŒ ë¶€ëª¨ ê°œì²´ ì°¾ê¸° ì‹¤íŒ¨ - father:', father, 'mother:', mother);
                return;
            }
            
            // ë¶€ëª¨ ì„±ë³„ ê²€ì¦
            if (father.gender !== 'ìˆ˜ì»·') {
                showToast('ë¶€ê°œì²´ëŠ” ìˆ˜ì»·ì´ì–´ì•¼ í•©ë‹ˆë‹¤!', 'error');
                return;
            }
            
            if (mother.gender !== 'ì•”ì»·') {
                showToast('ëª¨ê°œì²´ëŠ” ì•”ì»·ì´ì–´ì•¼ í•©ë‹ˆë‹¤!', 'error');
                return;
            }
            
            // ê°™ì€ ê°œì²´ ì„ íƒ ë°©ì§€
            if (father.id === mother.id) {
                showToast('ë¶€ëª¨ëŠ” ì„œë¡œ ë‹¤ë¥¸ ê°œì²´ì—¬ì•¼ í•©ë‹ˆë‹¤!', 'error');
                return;
            }
            
            console.log('âœ… ë¶€ëª¨ ê²€ì¦ ì™„ë£Œ:', { father: father.name, mother: mother.name });
            
            // ë² ì´ë¹„ ID ìƒì„± í•¨ìˆ˜
            function generateBabyId(hatchDate, index) {
                const date = new Date(hatchDate);
                const year = date.getFullYear().toString().slice(-2);
                const month = (date.getMonth() + 1).toString().padStart(2, '0');
                const day = date.getDate().toString().padStart(2, '0');
                const fatherInitial = father.name.charAt(0).toUpperCase();
                const motherInitial = mother.name.charAt(0).toUpperCase();
                const number = (index + 1).toString().padStart(2, '0');
                
                return `${year}${month}${day}-${fatherInitial}${motherInitial}-${number}`;
            }
            
            // ê°œë³„ ë² ì´ë¹„ ë“±ë¡
            for (let i = 0; i < eggCount; i++) {
                const babyName = document.getElementById(`baby${i+1}Name`).value;
                const babyWeight = document.getElementById(`baby${i+1}Weight`).value;
                const imageInput = document.getElementById(`baby${i+1}ImageInput`);
                
                // ìë™ ìƒì„±ëœ IDì´ë¯€ë¡œ ê²€ì¦ ë¶ˆí•„ìš” (ê¸°ë³¸ê°’ì´ë¼ë„ ì§„í–‰)
                if (!babyName) {
                    // ë² ì´ë¹„ IDê°€ ì—†ìœ¼ë©´ ì„ì‹œë¡œ ìƒì„±
                    const autoId = generateBabyAutoId(
                        father ? father.name : 'Unknown',
                        mother ? mother.name : 'Unknown',
                        i
                    );
                    document.getElementById(`baby${i+1}Name`).value = autoId;
                }
                
                const finalBabyName = babyName || document.getElementById(`baby${i+1}Name`).value;
                
                // ê°œë³„ ë² ì´ë¹„ ì´ë¯¸ì§€ ì²˜ë¦¬
                let babyImageData = null;
                if (imageInput && imageInput.files && imageInput.files[0]) {
                    try {
                        showToast(`${i+1}ë²ˆì§¸ ë² ì´ë¹„ ì´ë¯¸ì§€ ì²˜ë¦¬ ì¤‘...`, 'info');
                        babyImageData = await compressImage(imageInput.files[0]);
                    } catch (error) {
                        console.error(`ë² ì´ë¹„ ${i+1} ì´ë¯¸ì§€ ì²˜ë¦¬ ì‹¤íŒ¨:`, error);
                        showToast(`${i+1}ë²ˆì§¸ ë² ì´ë¹„ ì´ë¯¸ì§€ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ê³„ì† ì§„í–‰í•©ë‹ˆë‹¤.`, 'warning');
                    }
                }
                
                const newBaby = {
                    id: Date.now().toString() + '_' + Math.random().toString(36).substr(2, 9),
                    babyId: finalBabyName, // ìë™ ìƒì„±ëœ ê³ ìœ  IDë¥¼ babyIdë¡œ ì‚¬ìš©
                    name: finalBabyName,
                    fatherId: fatherId,
                    motherId: motherId,
                    fatherName: father.name,
                    motherName: mother.name,
                    hatchDate: document.getElementById('babyHatchDate').value,
                    weight: babyWeight || '',
                    morph: document.getElementById('babyMorph').value || 'TBD',
                    notes: document.getElementById('babyNotes').value,
                    status: 'ë² ì´ë¹„',
                    gender: 'ë¯¸êµ¬ë¶„',
                    imageData: babyImageData, // ê°œë³„ ë² ì´ë¹„ ì´ë¯¸ì§€
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    growthRecords: [
                        {
                            date: document.getElementById('babyHatchDate').value,
                            weight: babyWeight || '',
                            notes: `í•´ì¹­ - ${finalBabyName}`,
                            milestone: 'hatch',
                            image: babyImageData // í•´ì¹­ ì‹œì  ê°œë³„ ì´ë¯¸ì§€
                        }
                    ]
                };
                
                babies.push(newBaby);
                console.log(`ğŸ‘¶ ë² ì´ë¹„ ${finalBabyName} ë“±ë¡:`, newBaby);
            }
            
            console.log(`ğŸ’¾ ë² ì´ë¹„ ë“±ë¡ ì „ ë°°ì—´ í¬ê¸°: ${babies.length}`);
            console.log('ì „ì²´ ë² ì´ë¹„ ë°°ì—´:', babies);
            
            // ë°ì´í„° ì €ì¥
            saveData();
            
            // ì €ì¥ í›„ í™•ì¸
            console.log('ğŸ’¾ ì €ì¥ í›„ localStorage í™•ì¸:');
            console.log('- babies í‚¤:', localStorage.getItem('babies') ? JSON.parse(localStorage.getItem('babies')).length + 'ê°œ' : 'ì—†ìŒ');
            console.log('- geckoBabies í‚¤:', localStorage.getItem('geckoBabies') ? JSON.parse(localStorage.getItem('geckoBabies')).length + 'ê°œ' : 'ì—†ìŒ');
            
            // UI ì—…ë°ì´íŠ¸
            updateStatistics();
            
            // Firebase ë™ê¸°í™”
            if (window.firebaseSync && window.firebaseSync.isInitialized) {
                window.firebaseSync.saveToCloud('babies', babies);
                console.log('â˜ï¸ Firebase ë™ê¸°í™” ì‹œì‘');
            }
            
            closeModal();
            const babyNames = Array.from({length: eggCount}, (_, i) => 
                document.getElementById(`baby${i+1}Name`).value
            ).join(', ');
            showToast(`ë² ì´ë¹„ ${babyNames}ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤! (ì´ ${eggCount}ë§ˆë¦¬)`, 'success');
            console.log(`âœ… ìƒˆ ë² ì´ë¹„ ${eggCount}ë§ˆë¦¬ ë“±ë¡ ì™„ë£Œ:`, babyNames);
            
            // ì¦‰ì‹œ ë² ì´ë¹„ ëª©ë¡ ëª¨ë‹¬ í‘œì‹œ (ì§€ì—° ì‹œê°„ ì œê±°)
            setTimeout(() => {
                console.log('ğŸ“‹ ë² ì´ë¹„ ëª©ë¡ ëª¨ë‹¬ í‘œì‹œ ì‹œì‘...');
                showBabyListModal();
            }, 100);
        }
        
        // ê°œë³„ ë² ì´ë¹„ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° í•¨ìˆ˜
        function previewBabyIndividualImage(input, babyIndex) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById(`baby${babyIndex}PreviewImg`).src = e.target.result;
                    document.getElementById(`baby${babyIndex}ImagePreview`).style.display = 'block';
                    document.getElementById(`baby${babyIndex}ImageUploader`).style.display = 'none';
                };
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        // ê°œë³„ ë² ì´ë¹„ ì´ë¯¸ì§€ ì œê±° í•¨ìˆ˜
        function removeBabyIndividualImage(babyIndex) {
            document.getElementById(`baby${babyIndex}ImageInput`).value = '';
            document.getElementById(`baby${babyIndex}ImagePreview`).style.display = 'none';
            document.getElementById(`baby${babyIndex}ImageUploader`).style.display = 'block';
        }
        
        // ì´ë¯¸ì§€ë¥¼ Base64ë¡œ ì••ì¶•í•˜ëŠ” í•¨ìˆ˜
        function compressImage(file, maxWidth = 300, quality = 0.7) {
            return new Promise((resolve, reject) => {
                try {
                    // íŒŒì¼ ìœ íš¨ì„± ê²€ì¦
                    if (!file || !file.type.startsWith('image/')) {
                        reject(new Error('ìœ íš¨í•œ ì´ë¯¸ì§€ íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤.'));
                        return;
                    }
                    
                    // íŒŒì¼ í¬ê¸° ì œí•œ (10MB)
                    if (file.size > 10 * 1024 * 1024) {
                        reject(new Error('ì´ë¯¸ì§€ íŒŒì¼ì´ ë„ˆë¬´ í½ë‹ˆë‹¤. (ìµœëŒ€ 10MB)'));
                        return;
                    }
                    
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    const img = new Image();
                    
                    img.onload = function() {
                        try {
                            // ë¹„ìœ¨ ìœ ì§€í•˜ë©° ë¦¬ì‚¬ì´ì¦ˆ
                            const ratio = Math.min(maxWidth / img.width, maxWidth / img.height);
                            const newWidth = img.width * ratio;
                            const newHeight = img.height * ratio;
                            
                            canvas.width = newWidth;
                            canvas.height = newHeight;
                            
                            // ì´ë¯¸ì§€ ê·¸ë¦¬ê¸°
                            ctx.drawImage(img, 0, 0, newWidth, newHeight);
                            
                            // Base64ë¡œ ë³€í™˜ (ì••ì¶•)
                            const compressedData = canvas.toDataURL('image/jpeg', quality);
                            
                            // URL ê°ì²´ ì •ë¦¬
                            URL.revokeObjectURL(img.src);
                            
                            resolve(compressedData);
                        } catch (error) {
                            reject(new Error('ì´ë¯¸ì§€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message));
                        }
                    };
                    
                    img.onerror = function() {
                        reject(new Error('ì´ë¯¸ì§€ ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'));
                    };
                    
                    img.src = URL.createObjectURL(file);
                    
                } catch (error) {
                    reject(error);
                }
            });
        }
        
        // ë² ì´ë¹„ ëª©ë¡ ë°ì´í„° ìƒˆë¡œê³ ì¹¨ (ê°•í™”ëœ ë””ë²„ê¹…)
        function refreshBabyData() {
            console.log('ğŸ”„ ë² ì´ë¹„ ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì‹œì‘...');
            
            // ëª¨ë“  ê°€ëŠ¥í•œ í‚¤ì—ì„œ ë² ì´ë¹„ ë°ì´í„° ì°¾ê¸°
            const babyKeys = ['babies', 'geckoBabies'];
            let foundData = false;
            
            for (const key of babyKeys) {
                const savedData = localStorage.getItem(key);
                
                if (savedData) {
                    try {
                        const parsedData = JSON.parse(savedData);
                        console.log(`ğŸ“¦ í‚¤ "${key}" í™•ì¸: ${parsedData.length}ê°œ ë°œê²¬`);
                        
                        if (Array.isArray(parsedData) && parsedData.length > 0) {
                            babies = parsedData;
                            foundData = true;
                            console.log(`âœ… "${key}"ì—ì„œ ${babies.length}ë§ˆë¦¬ ë² ì´ë¹„ ë¡œë“œ ì„±ê³µ`);
                            break;
                        }
                    } catch (error) {
                        console.error(`âŒ í‚¤ "${key}" íŒŒì‹± ì‹¤íŒ¨:`, error);
                    }
                } else {
                    console.log(`ğŸ“¦ í‚¤ "${key}" í™•ì¸: ë°ì´í„° ì—†ìŒ`);
                }
            }
            
            if (!foundData) {
                console.warn('âš ï¸ ë² ì´ë¹„ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ - ë¹ˆ ë°°ì—´ë¡œ ì´ˆê¸°í™”');
                babies = [];
            }
            
            console.log(`ğŸ“Š ìµœì¢… ë² ì´ë¹„ ë°ì´í„°: ${babies.length}ë§ˆë¦¬`);
            console.log('ë² ì´ë¹„ ëª©ë¡:', babies);
        }
        
        // ë² ì´ë¹„ ëª©ë¡ ì¶”ê°€ (ì£¼ìš” ê¸°ëŠ¥ì— ì¶”ê°€í•˜ê¸° ìœ„í•¨)
        function showBabyListModal() {
            // ë°°ì—´ ì•ˆì „ì„± í™•ë³´
            ensureArrays();
            console.log('ğŸ“‹ ë² ì´ë¹„ ëª©ë¡ ëª¨ë‹¬ ì‹œì‘ - í˜„ì¬ babies ë°°ì—´:', babies.length + 'ë§ˆë¦¬');
            
            // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
            refreshBabyData();
            
            console.log('ğŸ”„ ìƒˆë¡œê³ ì¹¨ í›„ babies ë°°ì—´:', babies.length + 'ë§ˆë¦¬');
            
            const modalContent = document.getElementById('modalContent');
            let listHTML = '';
            
            if (!babies || babies.length === 0) {
                console.log('âš ï¸ ë² ì´ë¹„ ë°ì´í„°ê°€ ì—†ìŒ - ë¹ˆ ìƒíƒœ í‘œì‹œ');
                listHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-baby text-6xl text-gray-300 mb-4"></i>
                        <p class="text-gray-500 text-lg">ë“±ë¡ëœ ë² ì´ë¹„ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                        <button onclick="closeModal(); showBabyModal();" class="btn btn-primary mt-4">
                            <i class="fas fa-plus"></i> ì²« ë² ì´ë¹„ ë“±ë¡í•˜ê¸°
                        </button>
                    </div>
                `;
            } else {
                console.log(`âœ… ${babies.length}ë§ˆë¦¬ ë² ì´ë¹„ ëª©ë¡ ìƒì„± ì‹œì‘`);
                listHTML = `
                    <div class="grid gap-4">
                        ${babies.map(baby => {
                            const age = Math.floor((new Date() - new Date(baby.hatchDate)) / (1000 * 60 * 60 * 24));
                            return `
                                <div class="glass-card p-4 hover:bg-white/50 transition-colors">
                                    <div class="flex gap-4">
                                        <!-- ë² ì´ë¹„ ì´ë¯¸ì§€ -->
                                        <div class="flex-shrink-0">
                                            ${baby.imageData ? 
                                                `<img src="${baby.imageData}" alt="${baby.babyId}" class="w-20 h-20 object-cover rounded-lg border-2 border-gray-200">` :
                                                `<div class="w-20 h-20 bg-gray-100 rounded-lg border-2 border-gray-200 flex items-center justify-content">
                                                    <i class="fas fa-camera text-gray-400 text-lg mx-auto"></i>
                                                </div>`
                                            }
                                        </div>
                                        
                                        <!-- ë² ì´ë¹„ ì •ë³´ -->
                                        <div class="flex-1">
                                            <h4 class="font-semibold text-lg">${baby.name || baby.babyId}</h4>
                                            <div class="text-sm text-gray-600 mt-1">
                                                <span class="mr-4">ğŸ‘¨ ${baby.fatherName} Ã— ğŸ‘© ${baby.motherName}</span>
                                                <span class="text-purple-600 font-medium">${baby.morph || 'TBD'}</span>
                                            </div>
                                            ${baby.name ? `<div class="text-xs text-gray-500">ID: ${baby.babyId}</div>` : ''}
                                            <div class="text-sm text-gray-500 mt-1">
                                                ğŸ¥š í•´ì¹­: ${baby.hatchDate} (${age}ì¼ì°¨)
                                                ${baby.weight ? ` â€¢ âš–ï¸ ${baby.weight}g` : ' â€¢ âš–ï¸ ë¯¸ê¸°ë¡'}
                                            </div>
                                            ${baby.notes ? `<p class="text-sm text-gray-600 mt-1">${baby.notes}</p>` : ''}
                                        </div>
                                        
                                        <!-- ìƒíƒœ ë° ì•¡ì…˜ -->
                                        <div class="text-right flex-shrink-0">
                                            <span class="inline-block px-2 py-1 bg-pink-100 text-pink-800 text-xs rounded-full mb-2">
                                                ${baby.status}
                                            </span>
                                            <div class="flex flex-col gap-1">
                                                <button onclick="showBabyDetails('${baby.id}')" 
                                                        class="text-xs text-purple-600 hover:text-purple-800 px-2 py-1 rounded">
                                                    ìƒì„¸ë³´ê¸°
                                                </button>
                                                <button onclick="showBabyGrowthModal('${baby.id}')" 
                                                        class="text-xs text-green-600 hover:text-green-800 px-2 py-1 rounded">
                                                    ì„±ì¥ê¸°ë¡
                                                </button>
                                                <button onclick="promoteToF2('${baby.id}')" 
                                                        class="text-xs text-blue-600 hover:text-blue-800 px-2 py-1 rounded">
                                                    F2 ìŠ¹ê²©
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            }
            
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold flex items-center gap-2">
                            <i class="fas fa-baby text-pink-500"></i>
                            ë² ì´ë¹„ ëª©ë¡ (${babies.length}ë§ˆë¦¬)
                        </h2>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 text-2xl">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <!-- ê²€ìƒ‰ ë° í•„í„°ë§ -->
                    <div class="glass-card p-4 mb-6">
                        <div class="flex gap-4 items-center">
                            <div class="flex-1">
                                <input type="text" id="babySearch" placeholder="ë² ì´ë¹„ ID, ë¶€ëª¨ëª…, ëª¨í”„ë¡œ ê²€ìƒ‰..." 
                                       class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                       oninput="filterBabies()">
                            </div>
                            <div>
                                <select id="babyStatusFilter" class="p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" onchange="filterBabies()">
                                    <option value="">ì „ì²´ ìƒíƒœ</option>
                                    <option value="ë² ì´ë¹„">ë² ì´ë¹„</option>
                                    <option value="í™œì„±">ì„±ì²´</option>
                                </select>
                            </div>
                            <div>
                                <select id="babyAgeFilter" class="p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" onchange="filterBabies()">
                                    <option value="">ì „ì²´ ì—°ë ¹</option>
                                    <option value="0-30">1ê°œì›” ë¯¸ë§Œ</option>
                                    <option value="30-90">1-3ê°œì›”</option>
                                    <option value="90-180">3-6ê°œì›”</option>
                                    <option value="180+">6ê°œì›” ì´ìƒ</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div id="babyListContainer">
                        ${listHTML}
                    </div>
                </div>
            `;
            openModal();
        }
        
        // ë² ì´ë¹„ í•„í„°ë§ ë° ê²€ìƒ‰ í•¨ìˆ˜
        function filterBabies() {
            const searchTerm = document.getElementById('babySearch').value.toLowerCase();
            const statusFilter = document.getElementById('babyStatusFilter').value;
            const ageFilter = document.getElementById('babyAgeFilter').value;
            
            let filteredBabies = babies.filter(baby => {
                // ê²€ìƒ‰ì–´ í•„í„°ë§
                const matchesSearch = !searchTerm || 
                    (baby.name && baby.name.toLowerCase().includes(searchTerm)) ||
                    baby.babyId.toLowerCase().includes(searchTerm) ||
                    baby.fatherName.toLowerCase().includes(searchTerm) ||
                    baby.motherName.toLowerCase().includes(searchTerm) ||
                    (baby.morph && baby.morph.toLowerCase().includes(searchTerm));
                
                // ìƒíƒœ í•„í„°ë§
                const matchesStatus = !statusFilter || baby.status === statusFilter;
                
                // ì—°ë ¹ í•„í„°ë§
                let matchesAge = true;
                if (ageFilter) {
                    const age = Math.floor((new Date() - new Date(baby.hatchDate)) / (1000 * 60 * 60 * 24));
                    if (ageFilter === '0-30') matchesAge = age < 30;
                    else if (ageFilter === '30-90') matchesAge = age >= 30 && age < 90;
                    else if (ageFilter === '90-180') matchesAge = age >= 90 && age < 180;
                    else if (ageFilter === '180+') matchesAge = age >= 180;
                }
                
                return matchesSearch && matchesStatus && matchesAge;
            });
            
            // í•„í„°ë§ëœ ê²°ê³¼ë¡œ ëª©ë¡ ì—…ë°ì´íŠ¸
            updateBabyList(filteredBabies);
        }
        
        // ë² ì´ë¹„ ëª©ë¡ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateBabyList(babiesToShow) {
            const container = document.getElementById('babyListContainer');
            
            if (babiesToShow.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-search text-6xl text-gray-300 mb-4"></i>
                        <p class="text-gray-500 text-lg">ê²€ìƒ‰ ì¡°ê±´ì— ë§ëŠ” ë² ì´ë¹„ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                        <button onclick="clearBabyFilters()" class="btn btn-primary mt-4">
                            <i class="fas fa-times"></i> í•„í„° ì´ˆê¸°í™”
                        </button>
                    </div>
                `;
                return;
            }
            
            const listHTML = `
                <div class="grid gap-4">
                    ${babiesToShow.map(baby => {
                        const age = Math.floor((new Date() - new Date(baby.hatchDate)) / (1000 * 60 * 60 * 24));
                        const growthProgress = calculateGrowthProgress(baby);
                        
                        return `
                            <div class="glass-card p-4 hover:bg-white/50 transition-colors">
                                <div class="flex gap-4">
                                    <!-- ë² ì´ë¹„ ì´ë¯¸ì§€ -->
                                    <div class="flex-shrink-0">
                                        ${baby.imageData ? 
                                            `<img src="${baby.imageData}" alt="${baby.babyId}" class="w-20 h-20 object-cover rounded-lg border-2 border-gray-200">` :
                                            `<div class="w-20 h-20 bg-gray-100 rounded-lg border-2 border-gray-200 flex items-center justify-center">
                                                <i class="fas fa-camera text-gray-400 text-lg mx-auto"></i>
                                            </div>`
                                        }
                                    </div>
                                    
                                    <!-- ë² ì´ë¹„ ì •ë³´ -->
                                    <div class="flex-1">
                                        <h4 class="font-semibold text-lg">${baby.name || baby.babyId}</h4>
                                        <div class="text-sm text-gray-600 mt-1">
                                            <span class="mr-4">ğŸ‘¨ ${baby.fatherName} Ã— ğŸ‘© ${baby.motherName}</span>
                                            <span class="text-purple-600 font-medium">${baby.morph || 'TBD'}</span>
                                        </div>
                                        ${baby.name ? `<div class="text-xs text-gray-500">ID: ${baby.babyId}</div>` : ''}
                                        <div class="text-sm text-gray-500 mt-1">
                                            ğŸ¥š í•´ì¹­: ${baby.hatchDate} (${age}ì¼ì°¨)
                                            ${baby.weight ? ` â€¢ âš–ï¸ ${baby.weight}g` : ' â€¢ âš–ï¸ ë¯¸ê¸°ë¡'}
                                        </div>
                                        ${baby.notes ? `<p class="text-sm text-gray-600 mt-1">${baby.notes}</p>` : ''}
                                        
                                        <!-- ì„±ì¥ ì§„í–‰ë¥  -->
                                        <div class="mt-2">
                                            <div class="flex items-center gap-2 mb-1">
                                                <span class="text-xs text-gray-500">ì„±ì¥ ê¸°ë¡:</span>
                                                <span class="text-xs font-medium text-blue-600">${growthProgress.recorded}/${growthProgress.total}</span>
                                            </div>
                                            <div class="w-full bg-gray-200 rounded-full h-2">
                                                <div class="bg-blue-500 h-2 rounded-full" style="width: ${(growthProgress.recorded / growthProgress.total) * 100}%"></div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- ìƒíƒœ ë° ì•¡ì…˜ -->
                                    <div class="text-right flex-shrink-0">
                                        <span class="inline-block px-2 py-1 bg-pink-100 text-pink-800 text-xs rounded-full mb-2">
                                            ${baby.status}
                                        </span>
                                        <div class="flex flex-col gap-1">
                                            <button onclick="showBabyDetails('${baby.id}')" 
                                                    class="text-xs text-purple-600 hover:text-purple-800 px-2 py-1 rounded">
                                                ìƒì„¸ë³´ê¸°
                                            </button>
                                            <button onclick="showBabyGrowthModal('${baby.id}')" 
                                                    class="text-xs text-green-600 hover:text-green-800 px-2 py-1 rounded">
                                                ì„±ì¥ê¸°ë¡
                                            </button>
                                            <button onclick="promoteToF2('${baby.id}')" 
                                                    class="text-xs text-blue-600 hover:text-blue-800 px-2 py-1 rounded">
                                                F2 ìŠ¹ê²©
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
            
            container.innerHTML = listHTML;
        }
        
        // ì„±ì¥ ì§„í–‰ë¥  ê³„ì‚° í•¨ìˆ˜ (ì²´ì¤‘ ê¸°ë°˜)
        function calculateGrowthProgress(baby) {
            const weightMilestones = [
                { stage: '1g', weight: 1 },
                { stage: '5g', weight: 5 },
                { stage: '10g', weight: 10 },
                { stage: '15g', weight: 15 },
                { stage: '20g', weight: 20 },
                { stage: '25g', weight: 25 },
                { stage: '30g', weight: 30 },
                { stage: '35g', weight: 35 }
            ];
            
            // í˜„ì¬ ì²´ì¤‘ íŒŒì•… (ê°€ì¥ ìµœê·¼ ê¸°ë¡)
            let currentWeight = 0;
            if (baby.growthRecords && baby.growthRecords.length > 0) {
                const latestRecord = baby.growthRecords
                    .filter(r => r.weight && parseFloat(r.weight) > 0)
                    .sort((a, b) => new Date(b.date) - new Date(a.date))[0];
                currentWeight = latestRecord ? parseFloat(latestRecord.weight) : 0;
            }
            
            const availableMilestones = weightMilestones.filter(m => currentWeight >= m.weight);
            const recordedMilestones = availableMilestones.filter(m => 
                baby.growthRecords.some(r => r.milestone === m.stage)
            );
            
            return {
                total: Math.max(availableMilestones.length, 1), // ìµœì†Œ 1ê°œ
                recorded: recordedMilestones.length
            };
        }
        
        // í•„í„° ì´ˆê¸°í™” í•¨ìˆ˜
        function clearBabyFilters() {
            document.getElementById('babySearch').value = '';
            document.getElementById('babyStatusFilter').value = '';
            document.getElementById('babyAgeFilter').value = '';
            updateBabyList(babies);
        }
        
        // ë² ì´ë¹„ë¥¼ ì„±ì²´ë¡œ ìŠ¹ê²©
        function promoteToF2(babyId) {
            const baby = babies.find(b => b.id === babyId);
            if (!baby) return;
            
            // ì„±ë³„ì´ ë¯¸êµ¬ë¶„ì¸ ê²½ìš° ì„±ë³„ì„ ë¨¼ì € í™•ì¸
            if (!baby.gender || baby.gender === 'ë¯¸êµ¬ë¶„') {
                const genderChoice = confirm(`${baby.name || baby.babyId}ì˜ ì„±ë³„ì„ ë¨¼ì € í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.\n\ní™•ì¸ì„ ëˆ„ë¥´ë©´ ìˆ˜ì»·, ì·¨ì†Œë¥¼ ëˆ„ë¥´ë©´ ì•”ì»·ìœ¼ë¡œ ì„¤ì •ë©ë‹ˆë‹¤.`);
                baby.gender = genderChoice ? 'ìˆ˜ì»·' : 'ì•”ì»·';
                saveData();
                showToast(`ì„±ë³„ì´ "${baby.gender}"ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'info');
            }
            
            if (confirm(`${baby.name || baby.babyId}ë¥¼ F2 ì„¸ëŒ€ë¡œ ìŠ¹ê²©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì„±ë³„: ${baby.gender}\nì„±ì²´ ê°œì²´ë¡œ ë“±ë¡ë˜ì–´ ë²ˆì‹ì— ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`)) {
                // ë² ì´ë¹„ë¥¼ F2 ì„±ì²´ ë°°ì—´ë¡œ ì´ë™
                const newF2Adult = {
                    id: baby.id,
                    name: baby.name || baby.babyId,
                    gender: baby.gender, // ë² ì´ë¹„ì˜ í™•ì •ëœ ì„±ë³„ ì‚¬ìš©
                    generation: 'F2',
                    morph: baby.morph || 'TBD',
                    weight: baby.weight || '',
                    birthDate: baby.hatchDate,
                    date: baby.hatchDate, // í˜¸í™˜ì„±ì„ ìœ„í•œ date í•„ë“œë„ ì¶”ê°€
                    notes: `${baby.fatherName} Ã— ${baby.motherName}ì—ì„œ F2 ìŠ¹ê²©. ${baby.notes || ''}`,
                    status: 'í™œì„±',
                    imageData: baby.imageData,
                    createdAt: baby.createdAt,
                    updatedAt: new Date().toISOString(),
                    promotedAt: new Date().toISOString(),
                    growthRecords: baby.growthRecords || []
                };
                
                animals.push(newF2Adult);
                babies.splice(babies.findIndex(b => b.id === babyId), 1);
                
                saveData();
                showBabyListModal(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                showToast(`${baby.name || baby.babyId}ê°€ F2 ${baby.gender}ë¡œ ìŠ¹ê²©ë˜ì—ˆìŠµë‹ˆë‹¤! ì´ì œ ë²ˆì‹ì— ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`, 'success');
            }
        }
        
        // ë² ì´ë¹„ ì„±ì¥ ê¸°ë¡ ëª¨ë‹¬
        function showBabyGrowthModal(babyId) {
            const baby = babies.find(b => b.id === babyId);
            if (!baby) return;
            
            const modalContent = document.getElementById('modalContent');
            const age = Math.floor((new Date() - new Date(baby.hatchDate)) / (1000 * 60 * 60 * 24));
            
            // ì²´ì¤‘ ê¸°ë°˜ ì„±ì¥ ë§ˆì¼ìŠ¤í†¤ ì •ì˜
            const milestones = [
                { stage: 'hatch', name: 'í•´ì¹­', weight: 0, icon: 'fas fa-egg', color: 'yellow' },
                { stage: '1g', name: '1g ë‹¬ì„±', weight: 1, icon: 'fas fa-seedling', color: 'green' },
                { stage: '5g', name: '5g ë‹¬ì„±', weight: 5, icon: 'fas fa-leaf', color: 'green' },
                { stage: '10g', name: '10g ë‹¬ì„±', weight: 10, icon: 'fas fa-tree', color: 'emerald' },
                { stage: '15g', name: '15g ë‹¬ì„±', weight: 15, icon: 'fas fa-crown', color: 'blue' },
                { stage: '20g', name: '20g ë‹¬ì„±', weight: 20, icon: 'fas fa-star', color: 'purple' },
                { stage: '25g', name: '25g ë‹¬ì„±', weight: 25, icon: 'fas fa-trophy', color: 'orange' },
                { stage: '30g', name: '30g ë‹¬ì„±', weight: 30, icon: 'fas fa-medal', color: 'red' },
                { stage: '35g', name: '35g+ ë‹¬ì„±', weight: 35, icon: 'fas fa-gem', color: 'pink' }
            ];
            
            // í˜„ì¬ ì²´ì¤‘ íŒŒì•…
            let currentWeight = 0;
            if (baby.growthRecords && baby.growthRecords.length > 0) {
                const latestRecord = baby.growthRecords
                    .filter(r => r.weight && parseFloat(r.weight) > 0)
                    .sort((a, b) => new Date(b.date) - new Date(a.date))[0];
                currentWeight = latestRecord ? parseFloat(latestRecord.weight) : 0;
            }
            
            let milestonesHTML = '';
            milestones.forEach(milestone => {
                const record = baby.growthRecords.find(r => r.milestone === milestone.stage);
                const isAvailable = milestone.stage === 'hatch' || currentWeight >= milestone.weight;
                
                milestonesHTML += `
                    <div class="glass-card p-4 ${isAvailable ? 'cursor-pointer hover:bg-blue-50' : 'opacity-50'}" 
                         ${isAvailable ? `onclick="showGrowthRecordForm('${babyId}', '${milestone.stage}')"` : ''}>
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 rounded-full ${record ? 'bg-green-100' : 'bg-gray-100'} flex items-center justify-center">
                                <i class="${milestone.icon} ${record ? 'text-green-600' : 'text-gray-400'}"></i>
                            </div>
                            <div class="flex-1">
                                <h4 class="font-semibold">${milestone.name}</h4>
                                ${record ? 
                                    `<p class="text-sm text-green-600">âœ“ ê¸°ë¡ë¨ (${record.date}) ${record.weight ? record.weight + 'g' : ''}</p>` : 
                                    `<p class="text-sm text-gray-500">${isAvailable ? 'ê¸°ë¡ ì¶”ê°€ ê°€ëŠ¥' : `í˜„ì¬ ì²´ì¤‘ ${currentWeight}g (${milestone.weight}g í•„ìš”)`}</p>`
                                }
                            </div>
                            ${record && record.image ? 
                                `<img src="${record.image}" class="w-16 h-16 object-cover rounded-lg border">` : 
                                `<div class="w-16 h-16 bg-gray-100 rounded-lg border flex items-center justify-center">
                                    <i class="fas fa-camera text-gray-400"></i>
                                </div>`
                            }
                        </div>
                        ${record && record.notes ? `<p class="text-sm text-gray-600 mt-2 ml-15">${record.notes}</p>` : ''}
                        ${record && record.weight ? `<p class="text-sm text-blue-600 mt-1 ml-15">ì²´ì¤‘: ${record.weight}g</p>` : ''}
                    </div>
                `;
            });
            
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold flex items-center gap-2">
                            <i class="fas fa-chart-line text-green-500"></i>
                            ${baby.babyId} ì„±ì¥ ê¸°ë¡
                        </h2>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 text-2xl">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div class="glass-card p-4 mb-6">
                        <div class="flex items-center gap-4">
                            ${baby.imageData ? 
                                `<img src="${baby.imageData}" class="w-20 h-20 object-cover rounded-lg border-2">` :
                                `<div class="w-20 h-20 bg-gray-100 rounded-lg border-2 flex items-center justify-center">
                                    <i class="fas fa-camera text-gray-400 text-xl"></i>
                                </div>`
                            }
                            <div>
                                <h3 class="text-xl font-semibold">${baby.babyId}</h3>
                                <p class="text-gray-600">${baby.fatherName} Ã— ${baby.motherName}</p>
                                <p class="text-sm text-gray-500">í•´ì¹­: ${baby.hatchDate} (${age}ì¼)</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <h3 class="text-lg font-semibold mb-4">ì„±ì¥ ë§ˆì¼ìŠ¤í†¤</h3>
                        ${milestonesHTML}
                    </div>
                </div>
            `;
            
            openModal();
        }
        
        // ì„±ì¥ ê¸°ë¡ ì…ë ¥ í¼
        function showGrowthRecordForm(babyId, milestone) {
            const baby = babies.find(b => b.id === babyId);
            if (!baby) return;
            
            const existingRecord = baby.growthRecords.find(r => r.milestone === milestone);
            const modalContent = document.getElementById('modalContent');
            
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold flex items-center gap-2">
                            <i class="fas fa-plus-circle text-blue-500"></i>
                            ${milestone} ì„±ì¥ ê¸°ë¡ ${existingRecord ? 'ìˆ˜ì •' : 'ì¶”ê°€'}
                        </h2>
                        <button onclick="showBabyGrowthModal('${babyId}')" class="text-gray-400 hover:text-gray-600 text-2xl">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                    </div>
                    
                    <form onsubmit="saveGrowthRecord(event, '${babyId}', '${milestone}')" class="space-y-6">
                        <!-- ê¸°ë³¸ ì •ë³´ -->
                        <div class="glass-card p-6">
                            <h3 class="text-lg font-semibold mb-4">ê¸°ë¡ ì •ë³´</h3>
                            <div class="grid grid-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">ê¸°ë¡ ë‚ ì§œ *</label>
                                    <input type="date" id="recordDate" class="input-field" required
                                           value="${existingRecord ? existingRecord.date : new Date().toISOString().split('T')[0]}">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">ì²´ì¤‘ (g)</label>
                                    <input type="number" id="recordWeight" class="input-field" step="0.1"
                                           value="${existingRecord ? existingRecord.weight || '' : ''}"
                                           placeholder="ì˜ˆ: 5.2">
                                </div>
                            </div>
                        </div>
                        
                        <!-- ì„±ì¥ ì´ë¯¸ì§€ -->
                        <div class="glass-card p-6">
                            <h3 class="text-lg font-semibold mb-4">ì„±ì¥ ì‚¬ì§„</h3>
                            <div class="image-upload-area" onclick="document.getElementById('growthImageInput').click()">
                                <input type="file" id="growthImageInput" accept="image/*" style="display:none" onchange="previewGrowthImage(this)">
                                <div id="growthImagePreview" style="${existingRecord && existingRecord.image ? 'display:block' : 'display:none'}">
                                    <img id="growthPreviewImg" class="preview-image" 
                                         src="${existingRecord && existingRecord.image ? existingRecord.image : ''}">
                                    <button type="button" onclick="removeGrowthImage()" class="remove-image-btn">
                                        <i class="fas fa-trash"></i> ì´ë¯¸ì§€ ì‚­ì œ
                                    </button>
                                </div>
                                <div id="growthImageUploader" style="${existingRecord && existingRecord.image ? 'display:none' : 'display:block'}">
                                    <i class="fas fa-camera text-4xl text-gray-400 mb-2"></i>
                                    <p class="text-gray-600 font-medium">ì„±ì¥ ì‚¬ì§„ ì¶”ê°€</p>
                                    <p class="text-sm text-gray-500 mt-1">${milestone} ë‹¨ê³„ ì‚¬ì§„ì„ ë“±ë¡í•´ì£¼ì„¸ìš”</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ë©”ëª¨ -->
                        <div class="glass-card p-6">
                            <h3 class="text-lg font-semibold mb-4">ì„±ì¥ ë©”ëª¨</h3>
                            <textarea id="recordNotes" class="input-field" rows="4"
                                      placeholder="ì„±ì¥ ìƒíƒœ, í–‰ë™ ë³€í™”, íŠ¹ì´ì‚¬í•­ ë“±ì„ ê¸°ë¡í•´ì£¼ì„¸ìš”...">${existingRecord ? existingRecord.notes || '' : ''}</textarea>
                        </div>
                        
                        <!-- ë²„íŠ¼ -->
                        <div class="flex gap-3">
                            <button type="button" onclick="showBabyGrowthModal('${babyId}')" class="btn btn-secondary flex-1">
                                ì·¨ì†Œ
                            </button>
                            <button type="submit" class="btn btn-primary flex-1">
                                <i class="fas fa-save"></i> ${existingRecord ? 'ìˆ˜ì •' : 'ì €ì¥'}
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            openModal();
        }
        
        // ì„±ì¥ ê¸°ë¡ ì €ì¥
        async function saveGrowthRecord(event, babyId, milestone) {
            event.preventDefault();
            
            const baby = babies.find(b => b.id === babyId);
            if (!baby) return;
            
            const date = document.getElementById('recordDate').value;
            const weight = document.getElementById('recordWeight').value;
            const notes = document.getElementById('recordNotes').value;
            const imageInput = document.getElementById('growthImageInput');
            
            // ì´ë¯¸ì§€ ì²˜ë¦¬
            let imageData = null;
            if (imageInput.files && imageInput.files[0]) {
                try {
                    showToast('ì´ë¯¸ì§€ ì²˜ë¦¬ ì¤‘...', 'info');
                    imageData = await compressImage(imageInput.files[0]);
                } catch (error) {
                    console.error('ì´ë¯¸ì§€ ì²˜ë¦¬ ì‹¤íŒ¨:', error);
                    // ê¸°ì¡´ ì´ë¯¸ì§€ ìœ ì§€
                    const existingRecord = baby.growthRecords.find(r => r.milestone === milestone);
                    imageData = existingRecord ? existingRecord.image : null;
                }
            } else {
                // ìƒˆ ì´ë¯¸ì§€ê°€ ì—†ìœ¼ë©´ ê¸°ì¡´ ì´ë¯¸ì§€ ìœ ì§€
                const existingRecord = baby.growthRecords.find(r => r.milestone === milestone);
                imageData = existingRecord ? existingRecord.image : null;
            }
            
            // ê¸°ì¡´ ê¸°ë¡ ì°¾ê¸°
            const recordIndex = baby.growthRecords.findIndex(r => r.milestone === milestone);
            
            const newRecord = {
                date: date,
                weight: weight || null,
                notes: notes || '',
                milestone: milestone,
                image: imageData,
                createdAt: new Date().toISOString()
            };
            
            if (recordIndex >= 0) {
                // ê¸°ì¡´ ê¸°ë¡ ìˆ˜ì •
                baby.growthRecords[recordIndex] = { ...baby.growthRecords[recordIndex], ...newRecord };
            } else {
                // ìƒˆ ê¸°ë¡ ì¶”ê°€
                baby.growthRecords.push(newRecord);
            }
            
            saveData();
            showBabyGrowthModal(babyId);
            showToast(`${milestone} ì„±ì¥ ê¸°ë¡ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');
        }
        
        // ì„±ì¥ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° í•¨ìˆ˜
        function previewGrowthImage(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('growthPreviewImg').src = e.target.result;
                    document.getElementById('growthImagePreview').style.display = 'block';
                    document.getElementById('growthImageUploader').style.display = 'none';
                };
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        // ì„±ì¥ ì´ë¯¸ì§€ ì œê±° í•¨ìˆ˜
        function removeGrowthImage() {
            document.getElementById('growthImageInput').value = '';
            document.getElementById('growthImagePreview').style.display = 'none';
            document.getElementById('growthImageUploader').style.display = 'block';
        }
        
        // ë¶€ëª¨ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateParentPreview(parentType) {
            const selectId = parentType === 'father' ? 'babyFather' : 'babyMother';
            const previewId = parentType === 'father' ? 'fatherPreview' : 'motherPreview';
            const imageId = parentType === 'father' ? 'fatherImage' : 'motherImage';
            const infoId = parentType === 'father' ? 'fatherInfo' : 'motherInfo';
            
            const selectedId = document.getElementById(selectId).value;
            const previewDiv = document.getElementById(previewId);
            const imageDiv = document.getElementById(imageId);
            const infoDiv = document.getElementById(infoId);
            
            if (!selectedId) {
                previewDiv.classList.add('hidden');
                return;
            }
            
            const parent = animals.find(a => a.id === selectedId);
            if (!parent) return;
            
            // ì´ë¯¸ì§€ í‘œì‹œ
            if (parent.imageData) {
                imageDiv.innerHTML = `<img src="${parent.imageData}" class="w-12 h-12 object-cover rounded-lg">`;
            } else {
                const icon = parentType === 'father' ? 'fa-male' : 'fa-female';
                const color = parentType === 'father' ? 'blue' : 'pink';
                imageDiv.innerHTML = `<i class="fas ${icon} text-${color}-500"></i>`;
            }
            
            // ì •ë³´ í‘œì‹œ
            const birthYear = parent.birthDate ? new Date(parent.birthDate).getFullYear() : (parent.date ? new Date(parent.date).getFullYear() : '?');
            const age = parent.birthDate ? Math.floor((new Date() - new Date(parent.birthDate)) / (1000 * 60 * 60 * 24 * 365.25)) : '?';
            
            infoDiv.innerHTML = `
                <div class="font-semibold text-gray-800">${parent.name}</div>
                <div class="text-gray-600">${parent.morph || 'Normal'} | ${parent.generation || 'F1'}</div>
                <div class="text-gray-500">${birthYear}ë…„ìƒ (${age}ì„¸) | ${parent.weight ? parent.weight + 'g' : 'ì²´ì¤‘ ë¯¸ê¸°ë¡'}</div>
            `;
            
            previewDiv.classList.remove('hidden');
            
            // ë¶€ëª¨ ì •ë³´ê°€ ë³€ê²½ë˜ë©´ ë² ì´ë¹„ IDë„ ì—…ë°ì´íŠ¸
            setTimeout(updateBabyIds, 100);
            
            // ì˜ˆìƒ ëª¨í”„ ì—…ë°ì´íŠ¸
            updateExpectedMorph();
        }
        
        // ì˜ˆìƒ ëª¨í”„ ê³„ì‚° í•¨ìˆ˜
        function updateExpectedMorph() {
            const fatherId = document.getElementById('babyFather').value;
            const motherId = document.getElementById('babyMother').value;
            const expectedDiv = document.getElementById('expectedMorphPreview');
            const morphSpan = document.getElementById('expectedMorph');
            
            if (!fatherId || !motherId) {
                expectedDiv.classList.add('hidden');
                return;
            }
            
            const father = animals.find(a => a.id === fatherId);
            const mother = animals.find(a => a.id === motherId);
            
            if (!father || !mother) return;
            
            const fatherMorph = father.morph || 'Normal';
            const motherMorph = mother.morph || 'Normal';
            
            // ê°„ë‹¨í•œ ëª¨í”„ ì¡°í•© ì˜ˆì¸¡
            let expectedMorph = '';
            
            if (fatherMorph === motherMorph) {
                expectedMorph = fatherMorph;
            } else if (fatherMorph === 'Normal') {
                expectedMorph = `${motherMorph} (Het)`;
            } else if (motherMorph === 'Normal') {
                expectedMorph = `${fatherMorph} (Het)`;
            } else {
                expectedMorph = `${fatherMorph} x ${motherMorph}`;
            }
            
            morphSpan.textContent = expectedMorph;
            
            // ì˜ˆìƒ ëª¨í”„ë¥¼ ë² ì´ë¹„ ëª¨í”„ í•„ë“œì— ìë™ ì…ë ¥
            const babyMorphField = document.getElementById('babyMorph');
            if (babyMorphField && !babyMorphField.value) {
                babyMorphField.value = expectedMorph;
            }
            
            expectedDiv.classList.remove('hidden');
        }
        
        // ì¸ê¸° ëª¨í”„ í‘œì‹œ í•¨ìˆ˜
        function showPopularMorphs() {
            const popularDiv = document.getElementById('popularMorphs');
            const suggestionsDiv = document.getElementById('morphSuggestions');
            
            popularDiv.classList.remove('hidden');
            suggestionsDiv.classList.add('hidden');
        }
        
        // ëª¨í”„ ì„ íƒ í•¨ìˆ˜
        function selectMorph(morphName) {
            document.getElementById('animalMorph').value = morphName;
            document.getElementById('popularMorphs').classList.add('hidden');
            document.getElementById('morphSuggestions').classList.add('hidden');
            
            // ìë™ìœ¼ë¡œ ID ìƒì„± ì œì•ˆ
            showToast(`ëª¨í”„ "${morphName}" ì„ íƒë¨! ìë™ìƒì„± ë²„íŠ¼ì„ ëˆŒëŸ¬ IDë¥¼ ìƒì„±í•˜ì„¸ìš”.`, 'info');
        }
        
        // ëª¨í”„ ìë™ì™„ì„± ì œì•ˆ í‘œì‹œ
        function showMorphSuggestions(inputValue) {
            const suggestionsDiv = document.getElementById('morphSuggestions');
            const popularDiv = document.getElementById('popularMorphs');
            
            if (!inputValue.trim()) {
                suggestionsDiv.classList.add('hidden');
                popularDiv.classList.remove('hidden');
                return;
            }
            
            popularDiv.classList.add('hidden');
            
            // ê¸°ì¡´ ëª¨í”„ë“¤ê³¼ ë§¤ì¹­
            const allMorphs = [
                ...Object.keys(morphCodes),
                // ê¸°ì¡´ ê°œì²´ë“¤ì˜ ëª¨í”„ë„ ì¶”ê°€
                ...new Set(animals.map(a => a.morph).filter(Boolean))
            ];
            
            const matches = allMorphs.filter(morph => 
                morph.toLowerCase().includes(inputValue.toLowerCase())
            ).slice(0, 8); // ìµœëŒ€ 8ê°œê¹Œì§€
            
            if (matches.length === 0) {
                suggestionsDiv.classList.add('hidden');
                return;
            }
            
            let suggestionsHTML = '';
            matches.forEach(morph => {
                const morphCode = getMorphCode(morph);
                suggestionsHTML += `
                    <div onclick="selectMorph('${morph}')" class="px-3 py-2 hover:bg-gray-100 cursor-pointer flex justify-between items-center">
                        <span>${morph}</span>
                        <span class="text-xs text-gray-500">${morphCode}</span>
                    </div>
                `;
            });
            
            suggestionsDiv.innerHTML = suggestionsHTML;
            suggestionsDiv.classList.remove('hidden');
        }
        
        // í´ë¦­ ì™¸ë¶€ ì˜ì—­ ì‹œ ìë™ì™„ì„± ìˆ¨ê¸°ê¸°
        document.addEventListener('click', function(e) {
            const morphInput = document.getElementById('animalMorph');
            const suggestionsDiv = document.getElementById('morphSuggestions');
            const popularDiv = document.getElementById('popularMorphs');
            
            // DOM ìš”ì†Œê°€ ì¡´ì¬í•˜ê³  í´ë¦­ëœ ìš”ì†Œê°€ ë‚´ë¶€ì— ìˆì§€ ì•Šì€ ê²½ìš°ì—ë§Œ ìˆ¨ê¸°ê¸°
            if (morphInput && suggestionsDiv && popularDiv) {
                if (!morphInput.contains(e.target) && 
                    !suggestionsDiv.contains(e.target) && 
                    !popularDiv.contains(e.target)) {
                    suggestionsDiv.classList.add('hidden');
                    popularDiv.classList.add('hidden');
                }
            }
        });
        
        // ëª¨í”„ ê³„ì‚°ê¸° ëª¨ë‹¬ (ê¸°ë³¸ êµ¬ì¡°)
        function showMorphCalculatorModal() {
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold flex items-center gap-2">
                            <i class="fas fa-calculator text-purple-500"></i>
                            ëª¨í”„ ê³„ì‚°ê¸°
                        </h2>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 text-2xl">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="text-center py-12">
                        <i class="fas fa-hammer text-6xl text-gray-300 mb-4"></i>
                        <p class="text-gray-500 text-lg">ëª¨í”„ ê³„ì‚°ê¸° ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤</p>
                    </div>
                </div>
            `;
            openModal();
        }
        
        // ëŒ€ëŸ‰ ê°€ì ¸ì˜¤ê¸° ëª¨ë‹¬ (ê¸°ë³¸ êµ¬ì¡°)
        function showBulkImportModal() {
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold flex items-center gap-2">
                            <i class="fas fa-file-import text-blue-500"></i>
                            ëŒ€ëŸ‰ ê°€ì ¸ì˜¤ê¸°
                        </h2>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 text-2xl">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="text-center py-12">
                        <i class="fas fa-hammer text-6xl text-gray-300 mb-4"></i>
                        <p class="text-gray-500 text-lg">ëŒ€ëŸ‰ ê°€ì ¸ì˜¤ê¸° ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤</p>
                    </div>
                </div>
            `;
            openModal();
        }
        
        // ë””ë²„ê¹… í•¨ìˆ˜
        function debugData() {
            console.log('ğŸ”§ === ë””ë²„ê¹… ì •ë³´ ===');
            console.log('í˜„ì¬ babies ë°°ì—´:', babies);
            console.log('babies ë°°ì—´ ê¸¸ì´:', babies.length);
            
            // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ í™•ì¸
            const localBabies = localStorage.getItem('babies');
            const localGeckoBabies = localStorage.getItem('geckoBabies');
            
            console.log('localStorage - babies:', localBabies ? JSON.parse(localBabies) : 'null');
            console.log('localStorage - geckoBabies:', localGeckoBabies ? JSON.parse(localGeckoBabies) : 'null');
            
            // í†µê³„
            updateStatistics();
            
            // ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
            const babyCount = babies.length;
            const localCount = localBabies ? JSON.parse(localBabies).length : 0;
            
            alert(`ğŸ”§ ë””ë²„ê¹… ì •ë³´:
            
ë©”ëª¨ë¦¬ ë² ì´ë¹„: ${babyCount}ë§ˆë¦¬
ì €ì¥ëœ ë² ì´ë¹„: ${localCount}ë§ˆë¦¬
ë™ë¬¼ ìˆ˜: ${animals.length}ë§ˆë¦¬

ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”!`);
        }
        
        // í† ìŠ¤íŠ¸ ì•Œë¦¼
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 px-6 py-4 rounded-lg shadow-lg z-50 transition-all duration-300 transform translate-x-full`;
            
            const colors = {
                success: 'bg-green-500 text-white',
                error: 'bg-red-500 text-white',
                warning: 'bg-yellow-500 text-white',
                info: 'bg-blue-500 text-white'
            };
            
            toast.className += ` ${colors[type] || colors.info}`;
            toast.innerHTML = `
                <div class="flex items-center gap-2">
                    <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'times' : 'info'}-circle"></i>
                    ${message}
                </div>
            `;
            
            document.body.appendChild(toast);
            
            // ì• ë‹ˆë©”ì´ì…˜
            setTimeout(() => toast.classList.remove('translate-x-full'), 100);
            setTimeout(() => {
                toast.classList.add('translate-x-full');
                setTimeout(() => document.body.removeChild(toast), 300);
            }, 3000);
        }
    </script>
</body>
</html>